<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Vagrant工具使用指南, Escape Escpae&#39;s Python Linux Bug Linnux运维之路 Python成长笔记 Web进击之旅 Bug解决之道 文所未闻 音乐墙 关于我">
    <meta name="description" content="听摇滚,但不偏颇;也挺古典,但不安逸">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Vagrant工具使用指南 | Escape</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Escape" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Escape</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Escape</div>
        <div class="logo-desc">
            
            听摇滚,但不偏颇;也挺古典,但不安逸
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/EscapeLife" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/EscapeLife" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/images/use-vagrant-tool-tourist.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Vagrant工具使用指南</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Tools/">
                                <span class="chip bg-color">Tools</span>
                            </a>
                        
                            <a href="/tags/Vagrant/">
                                <span class="chip bg-color">Vagrant</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Tools%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/" class="post-category">
                                Tools工具分享
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-12-13
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-05-27
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    26 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p><strong>Vagrant 工具：我终于回来啦！</strong></p>
</blockquote>
<p><code>Vagrant</code> 是一款用于构建及配置虚拟开发环境的软件，基于 <code>Ruby</code> 语言, 主要以命令行的方式运行。主要使用 <code>Oracle</code> 的开源 <code>VirtualBox</code> 作为虚拟化系统，与 <code>Chef</code>，<code>Salt</code>，<code>Puppet</code> 等环境配置管理软件搭配一起使用，可以实行快速虚拟开发环境的构建。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/cli">官方命令手册</a></li>
<li><a target="_blank" rel="noopener" href="https://app.vagrantup.com/boxes/search">官方盒子搜索地址</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/providers/virtualbox/configuration">官方常用配置示例说明</a></li>
</ul>
<p><img src="../images/use-vagrant-tool-tourist.jpg" alt="Vagrant工具使用教程"></p>
<hr>
<h2 id="1-工具介绍"><a href="#1-工具介绍" class="headerlink" title="1. 工具介绍"></a>1. 工具介绍</h2><blockquote>
<p><strong>Linux: Docker；MacOS: Vagrant</strong></p>
</blockquote>
<p><img src="../images/use-vagrant-tool-tourist-01.png" alt="Vagrant工具使用教程 - 工具介绍"></p>
<ul>
<li><strong>[1] 解决痛点</strong></li>
</ul>
<p>如果我们本机使用的是 <code>Windows</code> 或 <code>MacOS</code> 的操作系统，但需要学习 <code>Linux</code> 操作系统的话，一般情况下都是通过安装虚拟机来完成。而有了 <code>Vagrant</code> 工具的话，我们就可以通过编写一个 <code>Vagrantfile</code> 的配置文件来控制虚拟机的启动、虚拟机网络环境的配置、虚拟机与主机间的文件共享等。</p>
<p>这就意味着，当你需要在多台机器间同步开发时，只需要同步 <code>Vagrantfile</code> 的配置即可，就可以保证各台机器拥有一致的开发环境。咳咳咳，当然我们这里还可以选择使用 <code>Docker</code> 工具，但是其在 <code>Windows</code> 或 <code>MacOS</code> 的操作系统上面，发挥不出来性能，很鸡肋！</p>
<p>与此同时，因为 <code>Vagrant</code> 使用 <code>Vagrantfile</code> 配置文件来启动和管理机器的，所以当我们有需求的时候，可以在网上下载别人已经编写好的配置文件，而不用我们自己从零开始编写了。然后运行<code>vagrant up</code> 命令，<code>Vagrant</code> 就会自动下载虚拟机镜像，自动加载镜像并配置虚拟机，然后生成一个即开即用的学习环境。</p>
<ul>
<li><strong>[2] 区别介绍</strong></li>
</ul>
<p>这里我们主要说下 <code>Vagrant</code> 工具和 <code>Docker</code> 工具的异同之处，在介绍之后，我们可以根据自己的实际情况进行选择和使用。</p>
<p>相似之处是 <code>Vagrant</code> 和 <code>Docker</code> 都是虚拟化技术。<code>Vagrant</code> 是基于 <code>Virtualbox</code> 的虚拟机来构建你的开发环境，而 <code>Docker</code> 则是基于 <code>LXC</code> 的轻量级容器虚拟技术。虚拟机之于容器虚拟技术相当于进程和线程。虚拟机内可以包含很多容器，正如一个进程中可以包含很多线程。虚拟机重，容器虚拟技术轻。</p>
<p>说白了 <code>Vagrant</code> 就是一个普普通通的装了一个 <code>Linux</code> 的 <code>VirtualBox</code> 虚拟机，配以 <code>Vagrant</code> 团队为之开发的一系列套件，辅助完成诸如安装初始化、文件同步、<code>ssh</code>、部署环境升级、功能插件安装等等一些列问题的开发环境部署套件。也没什么好神秘的。</p>
<ul>
<li><strong>[3] 不足之处</strong></li>
</ul>
<p>因为国内没有非常好的 <code>Vagrant</code> 资源提供商，所以 <code>Vagrant</code> 在国内基本没有办法正常使用(直接使用官方地址的话)。如果需要使用的话，要么自己提前下载到本地或者配置国内的各大源代理(<a target="_blank" rel="noopener" href="http://www.vagrantbox.es/">Vagrantbox.es</a>)，然后再使用。否则的话，慢的想去死的心都有。</p>
<hr>
<h2 id="2-安装方式"><a href="#2-安装方式" class="headerlink" title="2. 安装方式"></a>2. 安装方式</h2><blockquote>
<p><strong>安装方式非常的简单！</strong></p>
</blockquote>
<ul>
<li>官网为我们提供好了多个操作系统的不同版本，我们只需要在其对应 <a target="_blank" rel="noopener" href="https://www.vagrantup.com/downloads">官方下载地址</a> 上面进行下载和安装即可，开始使用了。</li>
</ul>
<p><img src="../images/use-vagrant-tool-tourist-02.png" alt="Vagrant工具使用教程 - 安装方式"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 证明安装正常</span>
$ vagrant --help
Usage: vagrant <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>command<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>args<span class="token operator">></span><span class="token punctuation">]</span>
    -h, --help                       Print this help.

Common commands:
     autocomplete    manages autocomplete installation on host
     box             manages boxes: installation, removal, etc.
     cloud           manages everything related to Vagrant Cloud
     destroy         stops and deletes all traces of the vagrant machine
     global-status   outputs status Vagrant environments <span class="token keyword">for</span> this user
     halt            stops the vagrant machine
     <span class="token function">help</span>            shows the <span class="token function">help</span> <span class="token keyword">for</span> a subcommand
     init            initializes a new Vagrant environment by creating a Vagrantfile
     login
     package         packages a running vagrant environment into a box
     plugin          manages plugins: install, uninstall, update, etc.
     port            displays information about guest port mappings
     powershell      connects to machine via powershell remoting
     provision       provisions the vagrant machine
     push            deploys code <span class="token keyword">in</span> this environment to a configured destination
     rdp             connects to machine via RDP
     reload          restarts vagrant machine, loads new Vagrantfile configuration
     resume          resume a suspended vagrant machine
     snapshot        manages snapshots: saving, restoring, etc.
     <span class="token function">ssh</span>             connects to machine via SSH
     ssh-config      outputs OpenSSH valid configuration to connect to the machine
     status          outputs status of the vagrant machine
     <span class="token function">suspend</span>         suspends the machine
     up              starts and provisions the vagrant environment
     upload          upload to machine via communicator
     validate        validates the Vagrantfile
     version         prints current and latest Vagrant version
     winrm           executes commands on a machine via WinRM
     winrm-config    outputs WinRM configuration to connect to the machine

For <span class="token function">help</span> on any individual <span class="token function">command</span> run <span class="token variable"><span class="token variable">`</span>vagrant COMMAND -h<span class="token variable">`</span></span>
Additional subcommands are available, but are either <span class="token function">more</span> advanced
or not commonly used. To see all subcommands, run the <span class="token function">command</span>
<span class="token variable"><span class="token variable">`</span>vagrant list-commands<span class="token variable">`</span></span><span class="token keyword">.</span>
        --<span class="token punctuation">[</span>no-<span class="token punctuation">]</span>color                 Enable or disable color output
        --machine-readable           Enable machine readable output
    -v, --version                    Display Vagrant version
        --debug                      Enable debug output
        --timestamp                  Enable timestamps on log output
        --debug-timestamp            Enable debug output with timestamps
        --no-tty                     Enable non-interactive output
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 命令自动补全</span>
$ vagrant autocomplete <span class="token function">install</span>
Autocomplete installed at paths:
- /Users/escape/.zshrc
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="3-简单使用"><a href="#3-简单使用" class="headerlink" title="3. 简单使用"></a>3. 简单使用</h2><blockquote>
<p><strong>本节主要介绍 Vagrant 工具的命令行使用方式！</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/cli">官方命令手册</a></li>
</ul>
</blockquote>
<p><code>Vagrant</code> 以二进制包的形式发布，当然我们也可以从源代码编译，适用于所有支持的平台和体系结构。</p>
<ul>
<li><strong>[1] 启动和运行</strong></li>
</ul>
<p>配置任何 <code>Vagrant</code> 项目的第一步是创建一个 <code>Vagrantfile</code>。运行以下两个命令后，将在 <code>VirtualBox</code> 中拥有一个完全运行的虚拟机，该虚拟机运行 <code>64</code> 位 <code>Ubuntu 18.04 LTS</code>。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 常见目录</span>
$ <span class="token function">mkdir</span> vagrant_demo<span class="token punctuation">;</span> <span class="token function">cd</span> vagrant_demo

<span class="token comment" spellcheck="true"># 初始化</span>
$ vagrant init hashicorp/bionic64

<span class="token comment" spellcheck="true"># 启动虚拟机</span>
$ vagrant up

<span class="token comment" spellcheck="true"># 查看状态</span>
$ vagrant status
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>[2] 停止和暂停</strong></li>
</ul>
<p>启动虚拟机之后，我们可以通过如下命令来管理虚拟机的状态。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 停止虚拟机</span>
$ vagrant halt

<span class="token comment" spellcheck="true"># 暂停虚拟机</span>
$ vagrant <span class="token function">suspend</span>

<span class="token comment" spellcheck="true"># 恢复虚拟机</span>
$ vagrant resume

<span class="token comment" spellcheck="true"># 重启虚拟机</span>
$ vagrant reload
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>[3] 远程和销毁</strong></li>
</ul>
<p>然后，可以使用 <code>vagrant ssh</code> 连接到这台机器上。当我们使用完毕的时候，就可以通过如下命令来销毁虚拟机。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 远程连接</span>
$ vagrant <span class="token function">ssh</span>

<span class="token comment" spellcheck="true"># 退出连接</span>
$ <span class="token keyword">exit</span>
$ <span class="token function">logout</span>
$ CTRL+D

<span class="token comment" spellcheck="true"># 销毁虚拟机</span>
$ vagrant destroy
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>[4] 自定义打包</strong></li>
</ul>
<p>官方网站上面提供的 <code>Vagrant</code> 虚拟机如果无法满足我们的需求的话，通常我们也是不用自己重头开始建立虚拟机的。我们可以在基础镜像的基础上面，安装、配置、部署我们所需的内容之后，然后将其打包成为一个新的虚拟机。这样的话，我们就可以在后续使用的时候，直接使用我们打包好的虚拟机。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 打包之前清理网络</span>
<span class="token comment" spellcheck="true"># 目的是为了使用新包时网络启动问题</span>
$ vagrant <span class="token function">ssh</span>
$ <span class="token function">rm</span> -rf /etc/udev/rules.d/70-persistent-net.rules

<span class="token comment" spellcheck="true"># 打包虚拟机</span>
<span class="token comment" spellcheck="true"># 完成之后会生成一个package.box的文件</span>
$ vagrant package

<span class="token comment" spellcheck="true"># 将新的虚拟机添加到列表中</span>
$ vagrant add escape/bionic64 package.box

<span class="token comment" spellcheck="true"># 删除多余文件</span>
$ <span class="token function">rm</span> package.box

<span class="token comment" spellcheck="true"># 使用新的Box初始化项目</span>
$ vagrant init escape/bionic64
$ vagrant up
$ vagrant <span class="token function">ssh</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>[5] 虚拟机快照</strong></li>
</ul>
<p>快照的含义：对某一个特定文件系统在某一个特定时间内的一个具有只读属性的镜像。当你需要重复的返回到某一系统状态，又不想创建多个虚拟机的时候，就可以使用快照功能。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 获取帮助信息</span>
$ vagrant snapshot --help

<span class="token comment" spellcheck="true"># 存储快照</span>
$ vagrant snapshot save save_point_1
<span class="token operator">==</span><span class="token operator">></span> default: Snapshotting the machine as <span class="token string">'save_point_1'</span><span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Snapshot saved<span class="token operator">!</span> You can restore the snapshot at any <span class="token function">time</span> by

<span class="token comment" spellcheck="true"># 恢复快照</span>
$ vagrant snapshot restore save_point_1
<span class="token operator">==</span><span class="token operator">></span> default: Forcing <span class="token function">shutdown</span> of VM<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Restoring the snapshot <span class="token string">'save_point_1'</span><span class="token punctuation">..</span>.

<span class="token comment" spellcheck="true"># 列出快照</span>
$ vagrant snapshot list
<span class="token operator">==</span><span class="token operator">></span> default:
save_point_1

<span class="token comment" spellcheck="true"># 删除快照</span>
$ vagrant snapshot delete save_point_1
<span class="token operator">==</span><span class="token operator">></span> default: Deleting the snapshot <span class="token string">'save_point_1'</span><span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Snapshot deleted<span class="token operator">!</span>

<span class="token comment" spellcheck="true"># 存储快照并将其推入快照堆栈中</span>
$ vagrant snapshot push
<span class="token operator">==</span><span class="token operator">></span> default: Snapshotting the machine as <span class="token string">'push_1608705591_3915'</span><span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Snapshot saved<span class="token operator">!</span> You can restore the snapshot at any <span class="token function">time</span> by

<span class="token comment" spellcheck="true"># 将弹出快照堆栈中并恢复快照</span>
$ vagrant snapshot pop
<span class="token operator">==</span><span class="token operator">></span> default: Forcing <span class="token function">shutdown</span> of VM<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Restoring the snapshot <span class="token string">'push_1608705591_3915'</span><span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Deleting the snapshot <span class="token string">'push_1608705591_3915'</span><span class="token punctuation">..</span>.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="4-使用进阶"><a href="#4-使用进阶" class="headerlink" title="4. 使用进阶"></a>4. 使用进阶</h2><blockquote>
<p><strong>主要介绍 Box 命令的概念和使用！</strong></p>
</blockquote>
<ul>
<li><p>与从头构建虚拟机不同，<code>Vagrant</code> 使用基本映像快速克隆虚拟机。在 <code>Vagrant</code> 中，这些基本映像称为 <code>Box</code>。<code>Box</code> 其实就是某种操作系统的镜像文件，你也可以将其理解为是虚拟机的本身，我们可以添加需要的 <code>Box</code>，也可以管理和删除对应 <code>Box</code>。</p>
</li>
<li><p>如果已经添加了所需的 <code>Box</code> 的话，就可以在启动项目的时候，可以指定使用那个 <code>Box</code>。而对于 <code>Box</code> 而言，我们可以自己来定义和创建，也可以使用网上其他人已经编辑好的 <code>Box</code>，当然，我们一般都是选择后者，除非是我们没有找到对应的 <code>Box</code> 才会自动手动来做。</p>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">➜ vagrant box --help
Usage: vagrant box <span class="token operator">&lt;</span>subcommand<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>args<span class="token operator">></span><span class="token punctuation">]</span>

Available subcommands:
     add
     list
     outdated
     prune
     remove
     repackage
     update

For <span class="token function">help</span> on any individual subcommand run <span class="token variable"><span class="token variable">`</span>vagrant box <span class="token operator">&lt;</span>subcommand<span class="token operator">></span> -h<span class="token variable">`</span></span>
        --<span class="token punctuation">[</span>no-<span class="token punctuation">]</span>color                 Enable or disable color output
        --machine-readable           Enable machine readable output
    -v, --version                    Display Vagrant version
        --debug                      Enable debug output
        --timestamp                  Enable timestamps on log output
        --debug-timestamp            Enable debug output with timestamps
        --no-tty                     Enable non-interactive output
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>我们可以通过访问其 <a target="_blank" rel="noopener" href="https://app.vagrantup.com/boxes/search">官方地址</a> 进行下载，但是因为国内网络的问题，在没有代理的情况下还是非常慢的。所以，我们可以在添加 <code>Box</code> 的时候，复制其下载地址，通过下载工具进行下载。</li>
</ul>
<p><img src="../images/use-vagrant-tool-tourist-03.png" alt="Vagrant工具使用教程 - 工具使用"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 添加Box(需要选择适配的虚拟机类型)</span>
$ vagrant box add hashicorp/bionic64

<span class="token comment" spellcheck="true"># 列出所有Box</span>
$ vagrant box list
hashicorp/bionic64 <span class="token punctuation">(</span>virtualbox, 1.0.282<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 删除指定Box</span>
$ vagrant box remove hashicorp/bionic64

<span class="token comment" spellcheck="true"># 更新指定Box</span>
$ vagrant box update hashicorp/bionic64

<span class="token comment" spellcheck="true"># 打包指定Box</span>
$ vagrant box repackage hashicorp/bionic64

<span class="token comment" spellcheck="true"># 使用Box初始化项目</span>
<span class="token comment" spellcheck="true"># 初始化时将上述下载好的Box复制到虚拟机指定的目录下面</span>
$ vagrant init hashicorp/bionic64
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>因为网速比较慢的缘故，我们可以通过执行 <code>vagrant box add</code> 命令添加 <code>Box</code> 的时候，找到对应的下载地址，然后通过下载工具进行下载，然后再进行导入这样的操作，会好一些。</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 通过Motrix工具下载后重命名</span>
<span class="token comment" spellcheck="true"># https://vagrantcloud.com/jpiel/boxes/ubuntu18.04/versions/2019.06.03.0/providers/virtualbox.box</span>
$ <span class="token function">mv</span> xxxxxx virtualbox.box

<span class="token comment" spellcheck="true"># 导入Box文件到系统</span>
$ vagrant box add --name jpiel/ubuntu18.04 virtualbox.box

<span class="token comment" spellcheck="true"># 为了方便的话也可以直接跟URL地址</span>
$ vagrant box add --name jpiel/ubuntu18.04 https://vagrantcloud.com/xxx/virtualbox.box

<span class="token comment" spellcheck="true"># 查看Box列表</span>
$ vagrant box list
jpiel/ubuntu18.04 <span class="token punctuation">(</span>virtualbox, 0<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>然后，正常启动，即可。</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">➜ vagrant up
Bringing machine <span class="token string">'default'</span> up with <span class="token string">'virtualbox'</span> provider<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Checking <span class="token keyword">if</span> box <span class="token string">'hashicorp/bionic64'</span> version <span class="token string">'1.0.282'</span> is up to date<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Clearing any previously <span class="token keyword">set</span> forwarded ports<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Clearing any previously <span class="token keyword">set</span> network interfaces<span class="token punctuation">..</span>.
    <span class="token comment" spellcheck="true"># 配置网络</span>
<span class="token operator">==</span><span class="token operator">></span> default: Preparing network interfaces based on configuration<span class="token punctuation">..</span>.
    default: Adapter 1: nat
<span class="token operator">==</span><span class="token operator">></span> default: Forwarding ports<span class="token punctuation">..</span>.
    default: 22 <span class="token punctuation">(</span>guest<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> 2222 <span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token punctuation">(</span>adapter 1<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 启动虚拟机</span>
<span class="token operator">==</span><span class="token operator">></span> default: Booting VM<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Waiting <span class="token keyword">for</span> machine to boot. This may take a few minutes<span class="token punctuation">..</span>.
    default: SSH address: 127.0.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
<span class="token operator">==</span><span class="token operator">></span> default: Machine booted and ready<span class="token operator">!</span>
<span class="token operator">==</span><span class="token operator">></span> default: Checking <span class="token keyword">for</span> guest additions <span class="token keyword">in</span> VM<span class="token punctuation">..</span>.
    default: The guest additions on this VM <span class="token keyword">do</span> not match the installed version of
    default: VirtualBox<span class="token operator">!</span> In <span class="token function">most</span> cases this is fine, but <span class="token keyword">in</span> rare cases it can
    default: prevent things such as shared folders from working properly. If you see
    default: shared folder errors, please <span class="token function">make</span> sure the guest additions within the
    default: virtual machine match the version of VirtualBox you have installed on
    default: your host and reload your VM.
    default:
    default: Guest Additions Version: 6.0.10
    default: VirtualBox Version: 6.1
    <span class="token comment" spellcheck="true"># 挂载和映射本地目录</span>
<span class="token operator">==</span><span class="token operator">></span> default: Mounting shared folders<span class="token punctuation">..</span>.
    default: /vagrant <span class="token operator">=</span><span class="token operator">></span> /Users/escape/Vagrant
<span class="token operator">==</span><span class="token operator">></span> default: Machine already provisioned. Run <span class="token variable"><span class="token variable">`</span>vagrant provision<span class="token variable">`</span></span> or use the <span class="token variable"><span class="token variable">`</span>--provision<span class="token variable">`</span></span>
<span class="token operator">==</span><span class="token operator">></span> default: flag to force provisioning. Provisioners marked to run always will still run.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="5-相关配置"><a href="#5-相关配置" class="headerlink" title="5. 相关配置"></a>5. 相关配置</h2><blockquote>
<p><strong>介绍 Vagrantfile 配置文件的相关常用配置！</strong></p>
</blockquote>
<ul>
<li><p><strong>相关插件对应文档 - Docs</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/vagrantfile/machine_settings">config.vm</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/vagrantfile/ssh_settings">config.ssh</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/vagrantfile/winrm_settings">config.winrm</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/vagrantfile/winssh_settings">config.winssh</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/vagrantfile/vagrant_settings">config.vagrant</a></li>
</ul>
</li>
<li><p><strong>配置文件查找顺序</strong></p>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">/home/escape/projects/foo/Vagrantfile
/home/escape/projects/Vagrantfile
/home/escape/Vagrantfile
/home/Vagrantfile
/Vagrantfile
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>完整示例配置文件 - Vagrantfile</strong></li>
</ul>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># -*- mode: ruby -*-</span>
<span class="token comment" spellcheck="true"># vi: set ft=ruby :</span>

<span class="token comment" spellcheck="true"># All Vagrant configuration is done below. The "2" in Vagrant.configure</span>
<span class="token comment" spellcheck="true"># configures the configuration version (we support older styles for</span>
<span class="token comment" spellcheck="true"># backwards compatibility). Please don't change it unless you know what</span>
<span class="token comment" spellcheck="true"># you're doing.</span>
Vagrant.configure("2") do <span class="token punctuation">|</span>config<span class="token punctuation">|</span>
  <span class="token comment" spellcheck="true"># The most common configuration options are documented and commented below.</span>
  <span class="token comment" spellcheck="true"># For a complete reference, please see the online documentation at</span>
  <span class="token comment" spellcheck="true"># https://docs.vagrantup.com.</span>

  <span class="token comment" spellcheck="true"># Every Vagrant development environment requires a box. You can search for</span>
  <span class="token comment" spellcheck="true"># boxes at https://vagrantcloud.com/search.</span>
  config.vm.box = "hashicorp/bionic64"

  <span class="token comment" spellcheck="true"># Disable automatic box update checking. If you disable this, then</span>
  <span class="token comment" spellcheck="true"># boxes will only be checked for updates when the user runs</span>
  <span class="token comment" spellcheck="true"># `vagrant box outdated`. This is not recommended.</span>
  <span class="token comment" spellcheck="true"># config.vm.box_check_update = false</span>

  <span class="token comment" spellcheck="true"># Create a forwarded port mapping which allows access to a specific port</span>
  <span class="token comment" spellcheck="true"># within the machine from a port on the host machine. In the example below,</span>
  <span class="token comment" spellcheck="true"># accessing "localhost:8080" will access port 80 on the guest machine.</span>
  <span class="token comment" spellcheck="true"># NOTE: This will enable public access to the opened port</span>
  <span class="token comment" spellcheck="true"># config.vm.network "forwarded_port", guest: 80, host: 8080</span>

  <span class="token comment" spellcheck="true"># Create a forwarded port mapping which allows access to a specific port</span>
  <span class="token comment" spellcheck="true"># within the machine from a port on the host machine and only allow access</span>
  <span class="token comment" spellcheck="true"># via 127.0.0.1 to disable public access</span>
  <span class="token comment" spellcheck="true"># config.vm.network "forwarded_port", guest: 80, host: 8080, host_ip: "127.0.0.1"</span>

  <span class="token comment" spellcheck="true"># Create a private network, which allows host-only access to the machine</span>
  <span class="token comment" spellcheck="true"># using a specific IP.</span>
  <span class="token comment" spellcheck="true"># config.vm.network "private_network", ip: "192.168.33.10"</span>

  <span class="token comment" spellcheck="true"># Create a public network, which generally matched to bridged network.</span>
  <span class="token comment" spellcheck="true"># Bridged networks make the machine appear as another physical device on</span>
  <span class="token comment" spellcheck="true"># your network.</span>
  <span class="token comment" spellcheck="true"># config.vm.network "public_network"</span>

  <span class="token comment" spellcheck="true"># Share an additional folder to the guest VM. The first argument is</span>
  <span class="token comment" spellcheck="true"># the path on the host to the actual folder. The second argument is</span>
  <span class="token comment" spellcheck="true"># the path on the guest to mount the folder. And the optional third</span>
  <span class="token comment" spellcheck="true"># argument is a set of non-required options.</span>
  <span class="token comment" spellcheck="true"># config.vm.synced_folder "../data", "/vagrant_data"</span>

  <span class="token comment" spellcheck="true"># Provider-specific configuration so you can fine-tune various</span>
  <span class="token comment" spellcheck="true"># backing providers for Vagrant. These expose provider-specific options.</span>
  <span class="token comment" spellcheck="true"># Example for VirtualBox:</span>
  <span class="token comment" spellcheck="true">#</span>
  <span class="token comment" spellcheck="true"># config.vm.provider "virtualbox" do |vb|</span>
  <span class="token comment" spellcheck="true">#   # Display the VirtualBox GUI when booting the machine</span>
  <span class="token comment" spellcheck="true">#   vb.gui = true</span>
  <span class="token comment" spellcheck="true">#</span>
  <span class="token comment" spellcheck="true">#   # Customize the amount of memory on the VM:</span>
  <span class="token comment" spellcheck="true">#   vb.memory = "1024"</span>
  <span class="token comment" spellcheck="true"># end</span>
  <span class="token comment" spellcheck="true">#</span>
  <span class="token comment" spellcheck="true"># View the documentation for the provider you are using for more</span>
  <span class="token comment" spellcheck="true"># information on available options.</span>

  <span class="token comment" spellcheck="true"># Enable provisioning with a shell script. Additional provisioners such as</span>
  <span class="token comment" spellcheck="true"># Ansible, Chef, Docker, Puppet and Salt are also available. Please see the</span>
  <span class="token comment" spellcheck="true"># documentation for more information about their specific syntax and use.</span>
  <span class="token comment" spellcheck="true"># config.vm.provision "shell", inline: &lt;&lt;-SHELL</span>
  <span class="token comment" spellcheck="true">#   apt-get update</span>
  <span class="token comment" spellcheck="true">#   apt-get install -y apache2</span>
  <span class="token comment" spellcheck="true"># SHELL</span>
end
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<ul>
<li><strong>[1] 配置共享目录</strong></li>
</ul>
<p>我们可以在启动的时候看到，目录会将我们本地的一个目录映射和挂载到 <code>vagrant</code> 创建的虚拟机中去，如果我们需要改变或者挂载其他目录时，可以修改配置文件来完成。</p>
<p><img src="../images/use-vagrant-tool-tourist-04.png" alt="Vagrant工具使用教程 - 配置共享目录"></p>
<pre class="line-numbers language-ruby"><code class="language-ruby">  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder <span class="token string">"../data"</span><span class="token punctuation">,</span> <span class="token string">"/vagrant_data"</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder <span class="token string">"../site"</span><span class="token punctuation">,</span> <span class="token string">"/nginx_web_site"</span><span class="token punctuation">,</span>
    create<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span> owner<span class="token punctuation">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span> group<span class="token punctuation">:</span> <span class="token string">"root"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr>
<p>如果我们在虚拟机上面安装和配置了一个 <code>Nginx</code> 的 <code>Web</code> 服务器，此时需要在我们本机打开虚拟机对应的网站，或者提供给整个网络的其他设备上面也可以访问的话，这就需要我们配置虚拟机网络了。在 <code>vagrant</code> 上面提供了，三种网络的配置方式，分别是私有网络、公有网络和端口转发。</p>
<p><strong>端口转发</strong>，顾名思义，就是将虚拟机中的端口端口映射到本地上，比如将虚拟机中的 <code>80</code> 端口，转发到本机的 <code>8080</code> 端口上，这时就可以通过访问本机的 <code>8080</code> 端口来访问虚拟机中的 <code>Web</code> 服务了。</p>
<ul>
<li><strong><code>guest</code> 为虚拟机的端口；<code>host</code> 为宿主的端口</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.network <span class="token string">"forwarded_port"</span>, guest: 80, host: 8080

  config.vm.network <span class="token string">"forwarded_port"</span>, guest: 2003, host: 12003, protocol: <span class="token string">"tcp"</span>
  config.vm.network <span class="token string">"forwarded_port"</span>, guest: 2003, host: 12003, protocol: <span class="token string">"udp"</span>

  config.vm.network <span class="token string">"forwarded_port"</span>, guest: 80, host: 8080, auto_correct: <span class="token boolean">true</span>

  config.vm.usable_port_range <span class="token operator">=</span> 8000<span class="token punctuation">..</span>8999
end
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>[2] 私有网络 - host-only</strong></li>
</ul>
<p><strong>私有网络</strong>，就是给虚拟机在配置文件中手动指定一个 <code>IP</code> 地址，通过配置的这个 <code>IP</code> 地址，我们本机和虚拟机进行通讯。需要注意的时候，只能在我们这台电脑进行访问。</p>
<p><img src="../images/use-vagrant-tool-tourist-05.png" alt="Vagrant工具使用教程 - 私有网络"></p>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  <span class="token comment" spellcheck="true"># DHCP</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">"dhcp"</span>

  <span class="token comment" spellcheck="true"># Static IP</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.33.10"</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.33.10"</span><span class="token punctuation">,</span> auto_config<span class="token punctuation">:</span> <span class="token keyword">false</span>

  <span class="token comment" spellcheck="true"># IPv6</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"fde4:8dba:82e1::c4"</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"fde4:8dba:82e1::c4"</span><span class="token punctuation">,</span> netmask<span class="token punctuation">:</span> <span class="token string">"96"</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>[3] 公共网络 - bridged</strong></li>
</ul>
<p><strong>公有网络</strong>，会把虚拟机配置成一台可以在同一网络里面访问的设备，即我们局域网中所有的服务器都可以与虚拟机进行通讯和互联。需要注意的是，我们需要登录虚拟机来查看路由器给其分配的 <code>IP</code> 地址。</p>
<p><img src="../images/use-vagrant-tool-tourist-06.png" alt="Vagrant工具使用教程 - 公共网络"></p>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  <span class="token comment" spellcheck="true"># DHCP</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"public_network"</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"public_network"</span><span class="token punctuation">,</span> auto_config<span class="token punctuation">:</span> <span class="token keyword">false</span>

  <span class="token comment" spellcheck="true"># Static IP</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"public_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.0.17"</span>

  <span class="token comment" spellcheck="true"># Default Network Interface</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"public_network"</span><span class="token punctuation">,</span> bridge<span class="token punctuation">:</span> <span class="token string">"en1: Wi-Fi (AirPort)"</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token comment" spellcheck="true"># Disable Auto-Configuration</span>

<span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"public_network"</span><span class="token punctuation">,</span> auto_config<span class="token punctuation">:</span> <span class="token keyword">false</span>

  <span class="token comment" spellcheck="true"># manual ip</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">"shell"</span><span class="token punctuation">,</span>
    run<span class="token punctuation">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>
    inline<span class="token punctuation">:</span> <span class="token string">"ifconfig eth1 192.168.0.17 netmask 255.255.255.0 up"</span>

  <span class="token comment" spellcheck="true"># manual ipv6</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">"shell"</span><span class="token punctuation">,</span>
    run<span class="token punctuation">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>
    inline<span class="token punctuation">:</span> <span class="token string">"ifconfig eth1 inet6 add fc00::17/7"</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token comment" spellcheck="true"># Default Router</span>

<span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"public_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.0.17"</span>

  <span class="token comment" spellcheck="true"># default router</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">"shell"</span><span class="token punctuation">,</span>
    run<span class="token punctuation">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>
    inline<span class="token punctuation">:</span> <span class="token string">"route add default gw 192.168.0.1"</span>

  <span class="token comment" spellcheck="true"># default router ipv6</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">"shell"</span><span class="token punctuation">,</span>
    run<span class="token punctuation">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>
    inline<span class="token punctuation">:</span> <span class="token string">"route -A inet6 add default gw fc00::1 eth1"</span>

  <span class="token comment" spellcheck="true"># delete default gw on eth0</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">"shell"</span><span class="token punctuation">,</span>
    run<span class="token punctuation">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>
    inline<span class="token punctuation">:</span> <span class="token string">"eval `route -n | awk '{ if ($8 ==\"eth0\" &amp;&amp; $2 != \"0.0.0.0\") print \"route del default gw \" $2; }'`"</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<p>有时，我们的实验环境或者项目不仅仅需要一台服务，而是需要多个服务器上分别部署不同的服务，进行协同工作，比如部署一个最小的 <code>K8S</code> 集群(三台服务)。当然，<code>Vagrant</code> 也是支持，我们在配置文件中进行多主机的配置，比如配置网络、共享目录、主机名等等。</p>
<ul>
<li><strong>[4] 多主机配置</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 使用新的Box初始化项目</span>
$ <span class="token function">mkdir</span> k8s-demo<span class="token punctuation">;</span> <span class="token function">cd</span> k8s-demo
$ vagrant init hashicorp/bionic64
$ vim Vagrantfile
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="../images/use-vagrant-tool-tourist-07.png" alt="Vagrant工具使用教程 - 多主机配置"></p>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>

  <span class="token comment" spellcheck="true"># 定义主机通用配置 - 使用同一个Box启动</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">"hashicorp/bionic64"</span>

  <span class="token comment" spellcheck="true"># 指定具体版本；不自动更新；可选参数</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box_version <span class="token operator">=</span> <span class="token string">"1.0.282"</span>
  <span class="token comment" spellcheck="true"># 可指定具体的URL项目地址；可选参数</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box_url <span class="token operator">=</span> <span class="token string">"https://vagrantcloud.com/hashicorp/bionic64"</span>

  <span class="token comment" spellcheck="true"># 可指定预先执行的脚本；可选参数</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token symbol">:shell</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token string">"bootstrap.sh"</span>
  node<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">"shell"</span><span class="token punctuation">,</span> inline<span class="token punctuation">:</span> <span class="token string">"echo hello from escape."</span>
  <span class="token comment" spellcheck="true"># 可配置端口转发；可选参数</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token symbol">:forwarded_port</span><span class="token punctuation">,</span> guest<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> host<span class="token punctuation">:</span> <span class="token number">4567</span>

  <span class="token comment" spellcheck="true"># 定义dev主机</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"dev"</span> <span class="token keyword">do</span> <span class="token operator">|</span>development<span class="token operator">|</span>
    <span class="token comment" spellcheck="true"># 配置私有网络 - 不能和本机局域网重复</span>
    dev<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.10"</span>
    <span class="token comment" spellcheck="true"># 配置主机名</span>
    dev<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"escape-dev"</span>
    <span class="token comment" spellcheck="true"># 配置共享目录 - 可以让多台主机分别使用其自己的目录</span>
    config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder <span class="token string">"dev"</span><span class="token punctuation">,</span> <span class="token string">"/vagrant_data"</span>
  <span class="token keyword">end</span>

  <span class="token comment" spellcheck="true"># 定义prod主机</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"prod"</span> <span class="token keyword">do</span> <span class="token operator">|</span>production<span class="token operator">|</span>
    prod<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.20"</span>
    dev<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"escape-prod"</span>
    config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder <span class="token string">"prod"</span><span class="token punctuation">,</span> <span class="token string">"/vagrant_data"</span>
  <span class="token keyword">end</span>

<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 启动全部或一台</span>
$ vagrant up
$ vagrant up dev
$ vagrant up prod

<span class="token comment" spellcheck="true"># 连接其中的一台</span>
$ vagrant <span class="token function">ssh</span> dev
$ vagrant <span class="token function">ssh</span> prod
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="6-常用插件"><a href="#6-常用插件" class="headerlink" title="6. 常用插件"></a>6. 常用插件</h2><blockquote>
<p><strong>这里介绍其常用的插件的功能和使用方式！</strong></p>
</blockquote>
<ul>
<li><p><strong>官方插件对应地址 - Plugins</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://vagrant-lists.github.io/">Vagrant listings</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hashicorp/vagrant/wiki/Available-Vagrant-Plugins">Available Vagrant Plugins</a></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">➜ vagrant plugin --help
Usage: vagrant plugin <span class="token operator">&lt;</span>command<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>args<span class="token operator">></span><span class="token punctuation">]</span>

Available subcommands:
     expunge
     <span class="token function">install</span>
     license
     list
     repair
     uninstall
     update

For <span class="token function">help</span> on any individual <span class="token function">command</span> run <span class="token variable"><span class="token variable">`</span>vagrant plugin COMMAND -h<span class="token variable">`</span></span>
        --<span class="token punctuation">[</span>no-<span class="token punctuation">]</span>color                 Enable or disable color output
        --machine-readable           Enable machine readable output
    -v, --version                    Display Vagrant version
        --debug                      Enable debug output
        --timestamp                  Enable timestamps on log output
        --debug-timestamp            Enable debug output with timestamps
        --no-tty                     Enable non-interactive output
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<ul>
<li><strong>[1] 主机名管理插件 - <a target="_blank" rel="noopener" href="https://github.com/devopsgroup-io/vagrant-hostmanager">vagrant-hostmanager</a></strong></li>
</ul>
<p>可以使多台主机使用主机名通信</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装插件</span>
$ vagrant plugin <span class="token function">install</span> vagrant-hostmanager

<span class="token comment" spellcheck="true"># 更新主机和虚拟机的hosts文件</span>
$ vagrant hostmanager

<span class="token comment" spellcheck="true"># 现在可以使用主机名连接虚拟机</span>
$ vagrant <span class="token function">ssh</span> node1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">"centos/7"</span>

  <span class="token comment" spellcheck="true"># 启用hostmanager插件</span>
  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token keyword">true</span>
  <span class="token comment" spellcheck="true"># 表示更新主机上的hosts文件</span>
  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>manage_host <span class="token operator">=</span> <span class="token keyword">true</span>
  <span class="token comment" spellcheck="true"># 表示更新虚拟机上的hosts文件</span>
  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>manage_guest <span class="token operator">=</span> <span class="token keyword">true</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"node1"</span> <span class="token keyword">do</span> <span class="token operator">|</span>node1<span class="token operator">|</span>
    node1<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.10"</span>
    node1<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"node1"</span>
  <span class="token keyword">end</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"node2"</span> <span class="token keyword">do</span> <span class="token operator">|</span>node2<span class="token operator">|</span>
    node2<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.20"</span>
    node2<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"node2"</span>
  <span class="token keyword">end</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"node3"</span> <span class="token keyword">do</span> <span class="token operator">|</span>node3<span class="token operator">|</span>
    node3<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.30"</span>
    node3<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"node3"</span>
  <span class="token keyword">end</span>

<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<ul>
<li><strong>[2] 更新虚拟机插件 - <a target="_blank" rel="noopener" href="https://github.com/dotless-de/vagrant-vbguest">vagrant-vbguest</a></strong></li>
</ul>
<p>有些 <code>Virualbox</code> 类型的 <code>Box</code> 无法设置共享目录，这是因为 <code>Box</code> 里面没有安装对应的插件导致的。使用 <code>vbguest</code> 插件即可解决此问题。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装插件</span>
$ vagrant plugin <span class="token function">install</span> vagrant-vbguest

<span class="token comment" spellcheck="true"># 查看虚拟机是否安装了此插件</span>
$ vagrant vbguest --status

<span class="token comment" spellcheck="true"># 为虚拟机安装此插件</span>
$ vagrant vbguest --do <span class="token function">install</span>
$ vagrant vbguest --do <span class="token function">install</span> node1
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">"centos/7"</span>

  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token keyword">true</span>
  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>manage_host <span class="token operator">=</span> <span class="token keyword">true</span>
  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>manage_guest <span class="token operator">=</span> <span class="token keyword">true</span>

  <span class="token comment" spellcheck="true"># 禁用vbguest自动更新机制</span>
  config<span class="token punctuation">.</span>vbguest<span class="token punctuation">.</span>auto_update <span class="token operator">=</span> <span class="token keyword">false</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"node1"</span> <span class="token keyword">do</span> <span class="token operator">|</span>node1<span class="token operator">|</span>
    node1<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.10"</span>
    node1<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"node1"</span>
  <span class="token keyword">end</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"node2"</span> <span class="token keyword">do</span> <span class="token operator">|</span>node2<span class="token operator">|</span>
    node2<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.20"</span>
    node2<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"node2"</span>
  <span class="token keyword">end</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"node3"</span> <span class="token keyword">do</span> <span class="token operator">|</span>node3<span class="token operator">|</span>
    node3<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.30"</span>
    node3<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"node3"</span>
  <span class="token keyword">end</span>

<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<ul>
<li><strong>[3] NFS 共享目录插件 - <a target="_blank" rel="noopener" href="https://github.com/gael-ian/vagrant-bindfs">vagrant-bindfs</a></strong></li>
</ul>
<p><code>Vagrant</code> 支持多种类型的主机与虚拟机之间的共享目录，如果我们使用的是 <code>Virualbox</code> 类型的 <code>Box</code> 的话，默认使用的就是其自带的类型，这种文件系统的性能比较慢。</p>
<p>如果需要提升性能的话，可以使用 <code>NFS</code> 类型来完成共享目录，但是在启动的时候会有权限相关的问题，这时就可以使用 <code>bindfs</code> 查看来解决此问题了。解决的方式就是通过，创建一个中间层来完成主机和虚拟机的文件共享。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装插件</span>
$ vagrant plugin <span class="token function">install</span> vagrant-bindfs
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token comment" spellcheck="true"># NFS</span>

<span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">"centos/7"</span>

  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token keyword">true</span>
  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>manage_host <span class="token operator">=</span> <span class="token keyword">true</span>
  config<span class="token punctuation">.</span>hostmanager<span class="token punctuation">.</span>manage_guest <span class="token operator">=</span> <span class="token keyword">true</span>
  config<span class="token punctuation">.</span>vbguest<span class="token punctuation">.</span>auto_update <span class="token operator">=</span> <span class="token keyword">false</span>

  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>define <span class="token string">"node1"</span> <span class="token keyword">do</span> <span class="token operator">|</span>node1<span class="token operator">|</span>
    node1<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>network <span class="token string">"private_network"</span><span class="token punctuation">,</span> ip<span class="token punctuation">:</span> <span class="token string">"192.168.30.10"</span>
    node1<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>hostname <span class="token operator">=</span> <span class="token string">"node1"</span>
    <span class="token comment" spellcheck="true"># 这里的"/mnt/app_data"就是中间层，用来连接主机和虚拟机</span>
    node1<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder <span class="token string">"./app"</span><span class="token punctuation">,</span> <span class="token string">"/mnt/app_data"</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">"nfs"</span>
    node1<span class="token punctuation">.</span>bindfs<span class="token punctuation">.</span>bind_floder <span class="token string">"/mnt/app_data"</span><span class="token punctuation">,</span> <span class="token string">"/app"</span><span class="token punctuation">,</span>
      force_user<span class="token punctuation">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span> force_group<span class="token punctuation">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span> o<span class="token punctuation">:</span> <span class="token string">"nonempty"</span>
  <span class="token keyword">end</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-ruby"><code class="language-ruby"><span class="token comment" spellcheck="true"># Rsync</span>

<span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder <span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"/vagrant"</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">"rsync"</span><span class="token punctuation">,</span>
    rsync__exclude<span class="token punctuation">:</span> <span class="token string">".git/"</span>
<span class="token keyword">end</span>

<span class="token constant">Vagrant</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>synced_folder <span class="token string">"bin"</span><span class="token punctuation">,</span> <span class="token string">"/usr/local/bin"</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">"rsync"</span><span class="token punctuation">,</span>
    rsync__exclude<span class="token punctuation">:</span> <span class="token string">".git/"</span><span class="token punctuation">,</span>
    rsync__args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"--verbose"</span><span class="token punctuation">,</span> <span class="token string">"--rsync-path='sudo rsync'"</span><span class="token punctuation">,</span> <span class="token string">"--archive"</span><span class="token punctuation">,</span> <span class="token string">"--delete"</span><span class="token punctuation">,</span> <span class="token string">"-z"</span><span class="token punctuation">]</span>
<span class="token keyword">end</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<ul>
<li><strong>[4] 共享环境 - <a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs/cli/share">vagrant-share</a></strong><ul>
<li>需要事先安装 <code>ngrok</code> 工具，登录并授权码</li>
</ul>
</li>
</ul>
<p>现在已经有了一个正在运行的 <code>Web</code> 服务器，并可以在本机进行访问。但是，除了提供一个开发环境之外，<code>Vagrant</code> 还使得在这些环境中共享和协作变得容易，我们可以使用 <code>Share</code> 这个插件来完成。<code>Vagrant Share</code> 是一个插件，可以让您将您的 <code>Vagrant</code> 环境分享给世界上任何有互联网连接的人。它会给你一个 <code>URL</code>，可以从世界上任何连接到互联网的设备直接路由到你的环境。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装插件</span>
$ vagrant plugin <span class="token function">install</span> vagrant-share
Installing the <span class="token string">'vagrant-share'</span> plugin. This can take a few minutes<span class="token punctuation">..</span>.
Fetching vagrant-share-1.1.10.gem
Installed the plugin <span class="token string">'vagrant-share (1.1.10)'</span><span class="token operator">!</span>

<span class="token comment" spellcheck="true"># ngrok设置授权码</span>
<span class="token comment" spellcheck="true"># $ ./ngrok authtoken xxxxxx</span>
Authtoken saved to configuration file: /Users/escape/.ngrok2/ngrok.yml
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 分享 - HTTP Sharing</span>
$ vagrant share
<span class="token operator">==</span><span class="token operator">></span> default: Detecting network information <span class="token keyword">for</span> machine<span class="token punctuation">..</span>.
default: Local machine address: 192.168.84.130
default: Local HTTP port: 9999
default: Local HTTPS port: disabled
<span class="token operator">==</span><span class="token operator">></span> default: Creating Vagrant Share session<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: HTTP URL: http://b1fb1f3f.ngrok.io

<span class="token comment" spellcheck="true"># 连接</span>
$ vagrant connect http://b1fb1f3f.ngrok.io

<span class="token comment" spellcheck="true"># 终止</span>
$ ^C
<span class="token operator">==</span><span class="token operator">></span> default: Halting Vagrant share<span class="token operator">!</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果你想让同事访问你的 <code>SSH</code>，以便对 <code>ops</code> 问题进行故障排除，那么简单的 <code>SSH</code> 共享是非常有用的。此外，<code>SSH</code> 共享在默认情况下是禁用的，要启用 <code>SSH</code> 共享，只需在调用 <code>vagrant share</code> 时提供 <code>--ssh</code> 标志。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 分享 - SSH Sharing</span>
$ vagrant share --ssh
<span class="token operator">==</span><span class="token operator">></span> default: Detecting network information <span class="token keyword">for</span> machine<span class="token punctuation">..</span>.
default: Local machine address: 192.168.84.130
<span class="token operator">==</span><span class="token operator">></span> default: Generating new SSH key<span class="token punctuation">..</span>.
default: Please enter a password to encrypt the key:
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token operator">==</span><span class="token operator">></span> share:   vagrant connect --ssh bazaar_wolf:sultan_oasis

<span class="token comment" spellcheck="true"># 连接</span>
$ vagrant connect --ssh bazaar_wolf:sultan_oasis
Loading share <span class="token string">'bazaar_wolf:sultan_oasis'</span><span class="token punctuation">..</span>.

<span class="token comment" spellcheck="true"># 终止</span>
$ ^C
<span class="token operator">==</span><span class="token operator">></span> default: Halting Vagrant share<span class="token operator">!</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<ul>
<li><strong>[5] docker-compose 支持 - <a target="_blank" rel="noopener" href="https://github.com/leighmcculloch/vagrant-docker-compose">vagrant-docker-compose</a></strong></li>
</ul>
<p>安装该插件之后，可以在启动的时候执行 <code>docker-compose</code> 命令来启动对应容器服务。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># To install docker and docker-compose</span>
Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.box <span class="token operator">=</span> <span class="token string">"ubuntu/bionic64"</span>

  config.vm.provision :docker
  config.vm.provision :docker_compose
end
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># To install and run docker-compose on vagrant up</span>
<span class="token comment" spellcheck="true"># Equivalent to running: docker-compose -f [yml] up -d</span>
Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.box <span class="token operator">=</span> <span class="token string">"ubuntu/bionic64"</span>

  config.vm.provision :docker
  config.vm.provision :docker_compose, yml: <span class="token string">"/vagrant/docker-compose.yml"</span>, run: <span class="token string">"always"</span>
end
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># To install and run docker-compose, with multiple files, on vagrant up</span>
<span class="token comment" spellcheck="true"># Equivalent to running: docker-compose -f [yml-0] -f [yml-1] ... up -d</span>
Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.box <span class="token operator">=</span> <span class="token string">"ubuntu/bionic64"</span>

  config.vm.provision :docker
  config.vm.provision :docker_compose,
    yml: <span class="token punctuation">[</span>
      <span class="token string">"/vagrant/docker-compose-base.yml"</span>,
      <span class="token string">"/vagrant/docker-compose.yml"</span>,
      <span class="token punctuation">..</span>.
    <span class="token punctuation">]</span>,
    run: <span class="token string">"always"</span>
end
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="7-参考链接"><a href="#7-参考链接" class="headerlink" title="7. 参考链接"></a>7. 参考链接</h2><blockquote>
<p><strong>送人玫瑰，手有余香！</strong></p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/intro">Vagrant 官方网站</a></li>
<li><a target="_blank" rel="noopener" href="https://www.vagrantup.com/docs">Vagrant 使用文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/32324376">Vagrant 和 Docker 的使用场景和区别?</a></li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Escape</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.escapelife.site/posts/a0a9699e.html">https://www.escapelife.site/posts/a0a9699e.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Escape</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Tools/">
                                    <span class="chip bg-color">Tools</span>
                                </a>
                            
                                <a href="/tags/Vagrant/">
                                    <span class="chip bg-color">Vagrant</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/420bf773.html">
                    <div class="card-image">
                        
                        <img src="/images/learn-emmet-plugin-use.jpg" class="responsive-img" alt="学习Emmet插件的使用">
                        
                        <span class="card-title">学习Emmet插件的使用</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-12-16
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Web%E8%BF%9B%E5%87%BB%E4%B9%8B%E6%97%85/" class="post-category">
                                    Web进击之旅
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Frontend/">
                        <span class="chip bg-color">Frontend</span>
                    </a>
                    
                    <a href="/tags/Emmet/">
                        <span class="chip bg-color">Emmet</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/422306b7.html">
                    <div class="card-image">
                        
                        <img src="/images/clone-github-private-repo.png" class="responsive-img" alt="GitHub获取私有仓库">
                        
                        <span class="card-title">GitHub获取私有仓库</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-12-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux%E8%BF%90%E7%BB%B4%E4%B9%8B%E8%B7%AF/" class="post-category">
                                    Linux运维之路
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                    <a href="/tags/GitHub/">
                        <span class="chip bg-color">GitHub</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="764454432"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='none'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2017-2022</span>
            
            <span id="year">2017</span>
            <a href="/about" target="_blank">Escape</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">1163.4k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2017";
                        var startMonth = "2";
                        var startDate = "14";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/EscapeLife" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:wenpanhappy@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
