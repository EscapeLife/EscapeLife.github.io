<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="CentOS系统启动流程, Escape Escpae&#39;s Python Linux Bug Linnux运维之路 Python成长笔记 Web进击之旅 Bug解决之道 文所未闻 音乐墙 关于我">
    <meta name="description" content="听摇滚,但不偏颇;也挺古典,但不安逸">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>CentOS系统启动流程 | Escape</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Escape</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Escape</div>
        <div class="logo-desc">
            
            听摇滚,但不偏颇;也挺古典,但不安逸
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/EscapeLife" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/EscapeLife" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/images/system-startup-process.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CentOS系统启动流程</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Linux/">
                                <span class="chip bg-color">Linux</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Linux入门基础/" class="post-category">
                                Linux入门基础
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2017-12-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-12-08
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    9.2k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    37 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>我们学习<code>Linux</code>系统，首先必须要了解其启动的流程顺序。这样当我们遇到系统无法启动的时候就能快速定位出问题的原因，以及如何更好、更快的解决该问题。所以，基础很重要的。</p>
</blockquote>
<p><img src="/images/system-startup-process.png" alt="CentOS系统启动流程"></p>
<hr>
<h2 id="1-系统启动流程"><a href="#1-系统启动流程" class="headerlink" title="1. 系统启动流程"></a>1. 系统启动流程</h2><p><img src="/images/system-startup-process-10.png" alt="CentOS系统启动流程 - 系统启动流程"></p>
<h3 id="1-1-BIOS"><a href="#1-1-BIOS" class="headerlink" title="1.1 BIOS"></a>1.1 BIOS</h3><blockquote>
<p><strong>BIOS：</strong>在 PC 启动的过程中，BIOS 担负着初始化硬件，检测硬件功能，以及引导操作系统的责任。</p>
</blockquote>
<ul>
<li><strong>BIOS 历史</strong><ul>
<li>在早期，BIOS 程序存放于一个断电后内容不会丢失的只读内存中，系统过电或被重置时，处理器第一条指令的地址会被定位到 BIOS 的内存中，让初始化程序开始运行。</li>
<li>英特尔公司从 2000 年开始，发明了可扩展固件接口（Extensible Firmware Interface），用以规范 BIOS 的开发。而支持 EFI 规范的 BIOS 也被称为 EFI BIOS。之后为了推广 EFI，业界多家著名公司共同成立了统一可扩展固件接口论坛（UEFI Forum），英特尔公司将 EFI 1.1 规范贡献给业界，用以制订新的国际标准 UEFI 规范。</li>
</ul>
</li>
<li><strong>BIOS 的功能</strong><ul>
<li>当电脑的电源打开，BIOS 就会由主板上的闪存（flash memory）运行，并将芯片组和内存子系统初始化。BIOS 会把自己从闪存中，解压缩到系统的主存并且从那边开始运行。</li>
<li>PC 的 BIOS 代码也包含诊断功能，以保证某些重要硬件组件，像是键盘、磁盘设备、输出输入端口等等，可以正常运作且正确地初始化。现代的 BIOS 可以让用户选择由哪个设备启动电脑，如光盘驱动器、硬盘、软盘、USB U 盘等等</li>
</ul>
</li>
<li><strong>BIOS 固件</strong><ul>
<li>由于 BIOS 与硬件系统集成在一起（将 BIOS 程序指令刻录在 IC 中），所以有时候也被称为固件。</li>
<li>在大约 1990 年 BIOS 是保存在 ROM（只读内存）中而无法被修改。因为 BIOS 的大小和复杂程度随时间不断增加，而且硬件的更新速度加快，令 BIOS 也必须不断更新以支持新硬件，于是 BIOS 就改为存储在 EEPROM 或者闪存中，让用户可以轻易更新 BIOS。然而，不适当的运行或是终止 BIOS 更新可能导致电脑或是设备无法使用。</li>
<li>为了避免 BIOS 损坏，有些新的主板有备份的 BIOS（“双 BIOS”主板）。有些 BIOS 有“启动区块”，属于只读内存的一部分，一开始就会被运行且无法被更新。这个程序会在运行 BIOS 前，验证 BIOS 其他部分是否正确无误（经由检查码，凑杂码等等）。如果启动区块侦测到主要的 BIOS 已损坏，通常会自动由软盘驱动器启动电脑，让用户可以修复或更新 BIOS。一部分主板会在确定 BIOS 已损坏后自动搜索软盘驱动器看看有没有完整的 BIOS 文件。此时用户可以放入存储 BIOS 文件的软盘（例如由网上下载的更新版 BIOS 文件，或是自行备份的 BIOS 文件）。</li>
</ul>
</li>
<li><strong>BIOS 与 CMOS 的联系和区别 - 联系</strong><ul>
<li>CMOS 是计算机上另一个重要的存储器，BIOS 程序的设置结果就保存在 CMOS 中。而且，在 BIOS 程序引导计算机启动后，计算机需要载入 CMOS 中的用户信息和常规设置后才能正常使用。</li>
</ul>
</li>
<li><strong>BIOS 与 CMOS 的联系和区别 - 区别</strong><ul>
<li>BIOS 是存储在唯读记忆体（EEPROM），而 CMOS 为随机存储器（RAM）。</li>
<li>BIOS 中存储的是程序，而 CMOS 中存储的是普通信息。</li>
<li>EEPROM 即是我们常用的 U 盘和各类存储卡，因此可以更新 BIOS，其内容亦能在断电后保存。</li>
<li>CMOS RAM 的内容在断电会消失。所以，把主板的电池拆出，便可重置其内容，拆出电池也会重置时间。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="1-1-1-硬件自检"><a href="#1-1-1-硬件自检" class="headerlink" title="1.1.1 硬件自检"></a>1.1.1 硬件自检</h4><p>BIOS 程序首先检查，计算机硬件能否满足运行的基本条件，这叫做”<strong>硬件自检</strong>“（Power-On Self-Test），缩写为<code>POST</code>。如果硬件出现问题，主板会发出不同含义的蜂鸣，启动中止。如果没有问题，屏幕就会显示出 CPU、内存、硬盘等信息。</p>
<p><img src="/images/system-startup-process-11.png" alt="CentOS系统启动流程 - 硬件自检"></p>
<hr>
<h4 id="1-1-2-启动顺序"><a href="#1-1-2-启动顺序" class="headerlink" title="1.1.2 启动顺序"></a>1.1.2 启动顺序</h4><p>硬件自检完成后，BIOS 把控制权转交给下一阶段的启动程序。这时，BIOS 需要知道，”下一阶段的启动程序”具体存放在哪一个设备。也就是说，BIOS 需要有一个外部储存设备的排序，排在前面的设备就是优先转交控制权的设备。这种排序叫做”<strong>启动顺序</strong>“（<code>Boot Sequence</code>）。打开 BIOS 的操作界面，里面有一项就是”设定启动顺序”</p>
<p><img src="/images/system-startup-process-12.png" alt="CentOS系统启动流程 - 启动顺序"></p>
<hr>
<h3 id="1-2-主引导记录"><a href="#1-2-主引导记录" class="headerlink" title="1.2 主引导记录"></a>1.2 主引导记录</h3><p><strong>主引导记录</strong>(<code>Master Boot Record</code>)又叫做主引导扇区，是计算机开机后访问硬盘时所必须要读取的首个扇区，它在硬盘上的三维地址为（柱面，磁头，扇区）＝（0，0，1）。</p>
<ul>
<li><strong>主引导记录意义</strong><ul>
<li>主引导扇区记录着硬盘本身的相关信息以及硬盘各个分区的大小及位置信息，是数据信息的重要入口。如果它受到破坏，硬盘上的基本数据结构信息将会丢失，需要用繁琐的方式试探性的重建数据结构信息后才可能重新访问原先的数据。</li>
<li>主引导扇区内的信息可以通过任何一种基于某种操作系统的分区工具软件写入，但和某种操作系统没有特定的关系，即只要创建了有效的主引导记录就可以引导任意一种操作系统（操作系统是创建在高级格式化的硬盘分区之上，是和一定的文件系统相联系的）。</li>
</ul>
</li>
<li><strong>主引导记录大小</strong><ul>
<li>对于硬盘而言，一个扇区可能的字节数为 128×2n（n=0,1,2,3）。大多情况下，取 n=2，即一个扇区（sector）的大小为 512 字节。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="1-2-1-主引导记录的组成"><a href="#1-2-1-主引导记录的组成" class="headerlink" title="1.2.1 主引导记录的组成"></a>1.2.1 主引导记录的组成</h4><p><strong>启动代码</strong></p>
<ul>
<li>第 1-446 字节</li>
<li>调用操作系统的机器码</li>
<li>硬盘引导程序的主要作用是检查分区表是否正确并且在系统硬件完成自检以后将控制权交给硬盘上的引导程序（如 GNU GRUB）。它不依赖任何操作系统，而且启动代码也是可以改变的，从而能够实现多系统引导。</li>
</ul>
<p><strong>硬盘分区表</strong></p>
<ul>
<li>第 447-510 字节</li>
<li>分区表信息</li>
<li>硬盘分区表占据主引导扇区的 64 个字节，可以对四个分区的信息进行描述，其中每个分区的信息占据 16 个字节。</li>
</ul>
<p><strong>结束标志字</strong></p>
<ul>
<li>第 511-512 字节</li>
<li>主引导记录签名</li>
<li>结束标志字 55，AA 最后两个字节，是检验主引导记录是否有效的标志。</li>
</ul>
<p><img src="/images/system-startup-process-13.png" alt="CentOS系统启动流程 - 硬件自检"></p>
<hr>
<h4 id="1-2-2-分区表剖析"><a href="#1-2-2-分区表剖析" class="headerlink" title="1.2.2 分区表剖析"></a>1.2.2 分区表剖析</h4><p><img src="/images/system-startup-process-14.png" alt="CentOS系统启动流程 - 硬件自检"></p>
<p><strong>一个例子：</strong>如果某一分区在硬盘分区表的信息如下</p>
<pre class="line-numbers language-bash"><code class="language-bash">80 01 01 00 0B FE BF FC 3F 00 00 00 7E 86 BB 00<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>“<code>80</code>“是一个分区的激活标志，表示系统可引导</li>
<li>“<code>01 01 00</code>“表示分区开始的磁头号为 1，开始的扇区号为 1，开始的柱面号为 0</li>
<li>“<code>0B</code>“表示分区的系统类型是 FAT32，其他比较常用的有 04（FAT16）、07（NTFS）</li>
<li>“<code>FE BF FC</code>“表示分区结束的磁头号为 254，分区结束的扇区号为 63、分区结束的柱面号为 764</li>
<li>“<code>3F 00 00 00</code>“表示首扇区的相对扇区号为 63（小端序）</li>
<li>“<code>7E 86 BB 00</code>“表示总扇区数为 12289662（小端序）</li>
</ul>
<hr>
<h4 id="1-2-3-主引导扇区的读取流程"><a href="#1-2-3-主引导扇区的读取流程" class="headerlink" title="1.2.3 主引导扇区的读取流程"></a>1.2.3 主引导扇区的读取流程</h4><p><strong>系统开机或者重启</strong></p>
<ul>
<li>(1) BIOS 加电自检，BIOS 执行内存地址为<code>FFFF:0000H</code>处的跳转指令，跳转到固化在 ROM 中的自检程序处，对系统硬件（包括内存）进行检查。</li>
<li>(2) 读取主引导记录（MBR）。当 BIOS 检查到硬件正常并与 CMOS 中的设置相符后，按照 CMOS 中对启动设备的设置顺序检测可用的启动设备。BIOS 将相应启动设备的第一个扇区（也就是 MBR 扇区）读入内存地址为<code>0000:7C00H</code>处。</li>
<li>(3) 检查<code>0000:7CFEH</code>-<code>0000:7CFFH</code>（MBR 的结束标志位）是否等于<code>55AA</code>H，若不等于则转去尝试其他启动设备，如果没有启动设备满足要求则显示”<code>NO ROM BASIC</code>“然后死机。</li>
<li>(4) 当检测到有启动设备满足要求后，BIOS 将控制权交给相应启动设备。启动设备的 MBR 将自己复制到<code>0000:0600H</code>处，然后继续执行。</li>
<li>(5) 根据 MBR 中的引导代码启动引导程序。</li>
</ul>
<hr>
<h4 id="1-2-4-MBR-分区表与-GPT-分区表"><a href="#1-2-4-MBR-分区表与-GPT-分区表" class="headerlink" title="1.2.4 MBR 分区表与 GPT 分区表"></a>1.2.4 MBR 分区表与 GPT 分区表</h4><p><strong>全局唯一标识分区表</strong></p>
<ul>
<li><code>GUID Partition Table</code>，缩写为 GPT，是一个实体硬盘的分区表的结构布局的标准。它是可扩展固件接口（EFI）标准的一部分，被用于替代 BIOS 系统中的一<strong>32bits</strong>来存储逻辑块地址和大小信息的主引导记录（MBR）分区表。</li>
<li>对于那些扇区为<strong>512 字节</strong>的磁盘，MBR 分区表不支持容量大于<strong>2.2TB</strong>的分区。一些硬盘制造商注意到这个局限性，并且将他们的容量较大的磁盘升级到<strong>4KB</strong>的扇区，这意味着 MBR 的有效容量上限提升到<strong>16 TiB</strong>。 这个看似“正确的”解决方案，在临时地降低人们对改进磁盘分配表的需求的同时，也给市场带来关于在有较大的块（block）的设备上从 BIOS 启动时，如何最佳的划分磁盘分区的困惑。</li>
<li>GPT 分配<strong>64bits</strong>给逻辑块地址，因而使得最大分区大小在 264-1 个扇区成为可能。对于每个扇区大小为<strong>512 字节</strong>的磁盘，那意味着可以有<strong>9.4ZB</strong>或<strong>8 ZiB</strong>个 512 字节或<strong>18,446,744,073,709,551,615</strong>（264-1）个扇区 ×512（29）字节每扇区）。</li>
</ul>
<p><img src="/images/system-startup-process-15.png" alt="CentOS系统启动流程 - 硬件自检"></p>
<p><strong>GPT 的特点</strong></p>
<ul>
<li>GPT 硬盘中，分区表的位置信息储存在 GPT 头中。但出于兼容性考虑，硬盘的第一个扇区仍然用作 MBR，之后才是 GPT 头。</li>
<li>跟现代的 MBR 一样，GPT 也使用逻辑区块地址（LBA）替换了早期的 CHS 寻址方式。传统 MBR 信息存储于 LBA 0，GPT 头存储于 LBA 1，接下来才是分区表本身。</li>
</ul>
<blockquote>
<p><a href="https://zh.wikipedia.org/wiki/GUID%E7%A3%81%E7%A2%9F%E5%88%86%E5%89%B2%E8%A1%A8" target="_blank" rel="noopener">点击这里，查看更多关于 GPT 的内容</a></p>
</blockquote>
<hr>
<h3 id="1-3-硬盘启动"><a href="#1-3-硬盘启动" class="headerlink" title="1.3 硬盘启动"></a>1.3 硬盘启动</h3><p><strong>此后，计算机的控制权就要转交给硬盘的某个分区了，这里又分成三种情况。</strong></p>
<h4 id="1-3-1-卷引导记录"><a href="#1-3-1-卷引导记录" class="headerlink" title="1.3.1 卷引导记录"></a>1.3.1 卷引导记录</h4><ul>
<li>上一节提到，四个主分区里面，只有一个是激活的。计算机会读取激活分区的第一个扇区，叫做”<strong>卷引导记录</strong>“（<code>Volume boot record</code>，缩写为 VBR）。</li>
<li>“<strong>卷引导记录</strong>“的主要作用是，告诉计算机，操作系统在这个分区里的位置。然后，计算机就会加载操作系统了。</li>
</ul>
<h4 id="1-3-2-扩展分区和逻辑分区"><a href="#1-3-2-扩展分区和逻辑分区" class="headerlink" title="1.3.2 扩展分区和逻辑分区"></a>1.3.2 扩展分区和逻辑分区</h4><ul>
<li>随着硬盘越来越大，四个主分区已经不够了，需要更多的分区。但是，分区表只有四项，因此规定有且仅有一个区可以被定义成”<strong>扩展分区</strong>“（<code>Extended partition</code>）。</li>
<li>所谓”扩展分区”，就是指这个区里面又分成多个区。这种分区里面的分区，就叫做”<strong>逻辑分区</strong>“（<code>logical partition</code>）。</li>
<li>计算机先读取扩展分区的第一个扇区，叫做”<strong>扩展引导记录</strong>“（<code>Extended boot record</code>，缩写为 EBR）。它里面也包含一张 64 字节的分区表，但是最多只有两项（也就是两个逻辑分区）。</li>
<li>计算机接着读取第二个逻辑分区的第一个扇区，再从里面的分区表中找到第三个逻辑分区的位置，以此类推，直到某个逻辑分区的分区表只包含它自身为止（即<strong>只有一个分区项</strong>）。因此，扩展分区可以包含无数个逻辑分区。</li>
<li>但是，似乎<strong>很少</strong>通过这种方式启动操作系统。如果操作系统确实安装在扩展分区，一般采用下一种方式启动。</li>
</ul>
<h4 id="1-3-3-启动管理器"><a href="#1-3-3-启动管理器" class="headerlink" title="1.3.3 启动管理器"></a>1.3.3 启动管理器</h4><ul>
<li>在这种情况下，计算机读取”<strong>主引导记录</strong>“前面 446 字节的机器码之后，不再把控制权转交给某一个分区，而是运行事先安装的”<strong>启动管理器</strong>“（boot loader），由用户选择启动哪一个操作系统。</li>
<li>Linux 环境中，目前最流行的启动管理器是<code>grub</code>。</li>
</ul>
<p><img src="/images/system-startup-process-16.png" alt="CentOS系统启动流程 - 硬件自检"></p>
<h3 id="1-4-操作系统"><a href="#1-4-操作系统" class="headerlink" title="1.4 操作系统"></a>1.4 操作系统</h3><p><strong>此后，控制权转交给操作系统后，操作系统的内核首先被载入内存。</strong></p>
<h4 id="1-4-1-加载内核"><a href="#1-4-1-加载内核" class="headerlink" title="1.4.1 加载内核"></a>1.4.1 加载内核</h4><p>操作系统接管硬件以后，首先读入 /boot 目录下的内核文件。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ll /boot/</span>
总用量 102681
drwxr-xr-x. 3 root root     1024 12月 20 2011 efi
drwxr-xr-x. 2 root root     1024 4月  12 13:27 grub
-rw-r--r--  1 root root   108876 4月  24 2013 config-2.6.32-358.6.1.el6.i686
-rw-r--r--  1 root root   111791 3月  23 09:05 config-2.6.32-573.22.1.el6.i686
-rw-r--r--  1 root root 13996046 4月  30 2013 initramfs-2.6.32-358.6.1.el6.i686.img
-rw-------  1 root root 22567149 4月  12 13:27 initramfs-2.6.32-573.22.1.el6.i686.img
-rw-r--r--  1 root root   182362 4月  24 2013 symvers-2.6.32-358.6.1.el6.i686.gz
-rw-r--r--  1 root root   202279 3月  23 09:05 symvers-2.6.32-573.22.1.el6.i686.gz
-rw-r--r--  1 root root  1898658 4月  24 2013 System.map-2.6.32-358.6.1.el6.i686
-rw-r--r--  1 root root  2035811 3月  23 09:05 System.map-2.6.32-573.22.1.el6.i686
-rwxr-xr-x  1 root root  3918176 4月  24 2013 vmlinuz-2.6.32-358.6.1.el6.i686
-rwxr-xr-x  1 root root  4087808 3月  23 09:05 vmlinuz-2.6.32-573.22.1.el6.i686<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h4 id="1-4-2-启动初始化进程"><a href="#1-4-2-启动初始化进程" class="headerlink" title="1.4.2 启动初始化进程"></a>1.4.2 启动初始化进程</h4><ul>
<li>内核文件加载以后，就开始运行第一个程序 <code>/sbin/init</code>，它的作用是初始化系统环境。</li>
<li>由于 <code>init</code> 是第一个运行的程序，它的进程编号就是 <code>1</code>。其他所有进程都从它衍生，都是它的子进程。</li>
</ul>
<hr>
<h4 id="1-4-3-确定运行级别"><a href="#1-4-3-确定运行级别" class="headerlink" title="1.4.3 确定运行级别"></a>1.4.3 确定运行级别</h4><ul>
<li><code>init</code>进程的一大任务，就是去运行这些开机启动的程序。</li>
<li>Linux 允许为不同的场合，分配不同的开机启动程序，这就叫做”<strong>运行级别</strong>“（<code>runlevel</code>）。也就是说，启动时根据”运行级别”，确定要运行哪些程序。</li>
<li>Linux 预置<strong>七种运行级别</strong>（0-6）。一般来说，0 是关机，1 是单用户模式（也就是维护模式），6 是重启。运行级别 2-5，各个发行版不太一样。</li>
<li><code>init</code>进程首先读取文件 <code>/etc/inittab</code>，它是运行级别的设置文件。</li>
<li>对应运行级别有对应不同的目录，在目录中可以看到，除了第一个文件 README 以外，其他文件名都是”字母<strong>S</strong>+两位数字+程序名”的形式。字母 S 表示 Start，也就是启动的意思（启动脚本的运行参数为 start），如果这个位置是字母<strong>K</strong>，就代表 Kill（关闭），即如果从其他运行级别切换过来，需要关闭的程序（启动脚本的运行参数为 stop）。后面的两位数字表示处理顺序，数字越小越早处理，所以第一个启动的程序是 motd，然后是 rpcbing、nfs……数字相同时，则按照程序名的字母顺序启动，所以 rsyslog 会先于 sudo 启动。</li>
<li>这个目录里的所有文件（除了 README），就是启动时要加载的程序。如果想增加或删除某些程序，不建议手动修改 /etc/rcN.d 目录，最好是用一些专门命令进行管理。</li>
</ul>
<hr>
<h4 id="1-4-4-加载开机启动程序"><a href="#1-4-4-加载开机启动程序" class="headerlink" title="1.4.4 加载开机启动程序"></a>1.4.4 加载开机启动程序</h4><ul>
<li>七种预设的”运行级别”各自有一个目录，存放需要开机启动的程序。不难想到，如果多个”运行级别”需要启动同一个程序，那么这个程序的启动脚本，就会在每一个目录里都有一个拷贝。这样会造成管理上的困扰：<strong>如果要修改启动脚本，岂不是每个目录都要改一遍？</strong></li>
<li>Linux 的解决办法，就是七个 <code>/etc/rcN.d</code> 目录里列出的程序，都设为<strong>链接</strong>文件，指向另外一个目录 <code>/etc/init.d</code>，真正的启动脚本都统一放在这个目录中。<code>init</code> 进程逐一加载开机启动程序，其实就是运行这个目录里的启动脚本。</li>
</ul>
<hr>
<h4 id="1-4-5-用户登录"><a href="#1-4-5-用户登录" class="headerlink" title="1.4.5 用户登录"></a>1.4.5 用户登录</h4><p><strong>开机启动程序加载完毕以后，就要让用户登录了。一般来说，用户的登录方式有三种。</strong></p>
<ul>
<li><strong>命令行登录</strong><ul>
<li><code>init</code> 进程调用 <code>getty</code> 程序（意为 get teletype），让用户输入用户名和密码。输入完成后，再调用 <code>login</code> 程序，核对密码，系统会再多运行一个身份核对程序 <code>/etc/pam.d/login</code>。如果密码正确，就从文件 <code>/etc/passwd</code> 读取该用户指定的 <code>shell</code>，然后启动这个 <code>shell</code>。</li>
</ul>
</li>
<li><strong><code>ssh</code>登录</strong><ul>
<li>这时系统调用 <code>sshd</code> 程序，系统会再运行 <code>/etc/pam.d/ssh</code>，取代 <code>getty</code> 和 <code>login</code>，然后启动 <code>shell</code>。</li>
</ul>
</li>
<li><strong>图形界面登录</strong><ul>
<li><code>init</code>进程调用显示管理器，<code>Gnome</code> 图形界面对应的显示管理器为<code>gdm</code>（GNOME Display Manager），然后用户输入用户名和密码。如果密码正确，就读取 <code>/etc/gdm3/Xsession</code>，启动用户的会话。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="1-4-6-进入-login-shell"><a href="#1-4-6-进入-login-shell" class="headerlink" title="1.4.6 进入 login shell"></a>1.4.6 进入 login shell</h4><p><strong>登录到系统之后，对应的 shell（Bash），它会读入一系列的配置文件。上一步的三种情况，在这一步的处理，也存在差异。</strong></p>
<ul>
<li><strong>命令行登录</strong><ul>
<li>首先读入 <code>/etc/profile</code>，这是对所有用户都有效的配置；然后依次寻找下面三个文件，这是针对当前用户的配置。</li>
<li>需要注意的是，这三个文件只要有一个存在，就不再读入后面的文件了。比如，要是 <code>~/.bash_profile</code> 存在，就不会再读入后面两个文件了。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">~/.bash_profile
~/.bash_login
~/.profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong><code>ssh</code>登录</strong><ul>
<li>与第一种情况完全相同。</li>
</ul>
</li>
<li><strong>图形界面登录</strong><ul>
<li>只加载  <code>/etc/profile</code>  和  <code>~/.profile</code>。也就是说，<code>~/.bash_profile</code>  不管有没有，都不会运行。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="1-4-7-打开-non-login-shell"><a href="#1-4-7-打开-non-login-shell" class="headerlink" title="1.4.7 打开  non-login shell"></a>1.4.7 打开  non-login shell</h4><p>上一步完成以后，Linux 的启动过程就算结束了，用户已经可以看到命令行提示符或者图形界面了。但是，为了内容的完整，必须再介绍一下这一步。用户进入操作系统以后，常常会再<strong>手动开启一个 shell</strong>。这个 shell 就叫做  <code>non-login shell</code>，意思是它不同于登录时出现的那个 shell，不读取<code>/etc/profile</code>和<code>.profile</code>等配置文件。</p>
<p><strong>non-login shell 的重要性</strong>，不仅在于它是用户最常接触的那个 shell，还在于它会读入用户自己的 bash 配置文件  <code>~/.bashrc</code>。大多数时候，我们对于 bash 的定制，都是写在这个文件里面的。</p>
<ul>
<li>CentOS 已经考虑到这个问题了，请打开文件  <code>~/.profile</code>，可以看到下面的代码。</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat ~/.profile</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -n <span class="token string">"<span class="token variable">$BASH_VERSION</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">"<span class="token variable">$HOME</span>/.bashrc"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token keyword">.</span> <span class="token string">"<span class="token variable">$HOME</span>/.bashrc"</span>
  <span class="token keyword">fi</span>
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>上面代码先判断变量  <code>$BASH_VERSION</code>  是否有值，然后判断主目录下是否存在  <code>.bashrc</code>  文件，如果存在就运行该文件。第三行开头的那个点，是<code>source</code>命令的简写形式，表示运行某个文件，写成”<code>source ~/.bashrc</code>“也是可以的。</p>
</li>
<li><p>因此，只要运行<code>～/.profile</code>文件，<code>～/.bashrc</code>文件就会连带运行。但是上一节的第一种情况提到过，如果存在<code>～/.bash_profile</code>文件，那么有可能不会运行<code>～/.profile</code>文件。解决这个问题很简单，把下面代码写入<code>.bash_profile</code>就行了。</p>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># vim .bash_profile</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> -f ~/.profile <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token keyword">.</span> ~/.profile
<span class="token keyword">fi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>这样一来，不管是哪种情况，<code>.bashrc</code>都会执行，用户的设置可以放心地都写入这个文件了。</p>
</li>
<li><p>Bash 的设置之所以如此繁琐，是由于历史原因造成的。早期的时候，计算机运行速度很慢，载入配置文件需要很长时间，Bash 的作者只好把配置文件分成了几个部分，阶段性载入。系统的通用设置放在  <code>/etc/profile</code>，用户个人的、需要被所有子进程继承的设置放在<code>.profile</code>，不需要被继承的设置放在<code>.bashrc</code>。</p>
</li>
<li><p>顺便提一下，除了 Linux 以外， Mac OS X 使用的 shell 也是 Bash。但是，它只加载<code>.bash_profile</code>，然后在<code>.bash_profile</code>里面调用<code>.bashrc</code>。而且，不管是<code>ssh</code>登录，还是在图形界面里启动<code>shell</code>窗口，都是如此。</p>
</li>
</ul>
<hr>
<h2 id="2-系统基础知识"><a href="#2-系统基础知识" class="headerlink" title="2. 系统基础知识"></a>2. 系统基础知识</h2><p><strong>超简洁 Linux 机构</strong></p>
<ul>
<li><code>Linux = kernel + rootfs</code></li>
</ul>
<p><strong>内核设计流派</strong></p>
<ul>
<li>单内核设计：<ul>
<li>典型操作系统：<code>Linux</code></li>
<li>把所有功能集成于同一个程序，各种功能使用进程来实现</li>
</ul>
</li>
<li>微内核设计：<ul>
<li>典型操作系统：<code>Windows</code>、Solaris</li>
<li>每种功能使用一个单独子系统实现</li>
</ul>
</li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%86%85%E6%A0%B8" target="_blank" rel="noopener">点击这里，查看更多关内核的信息</a></li>
</ul>
<p><strong>Linux 内核特点</strong></p>
<ul>
<li>支持模块化 <code>.ko</code></li>
<li>支持模块的动态装载和卸载</li>
</ul>
<p><strong>Linux 内核的组成部分</strong></p>
<ul>
<li>核心文件<ul>
<li><code>/boot/vmlinuz-VERSION-release</code></li>
<li>内核也被做成了<code>rpm</code>包，这里的<code>release</code>表示 rpm 的版本号</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ll -h /boot/vmlinuz-2.6.32-573.22.1.el6.i686</span>
-rwxr-xr-x 1 root root 3.9M 3月  23 09:05 /boot/vmlinuz-2.6.32-573.22.1.el6.i686<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 发现内核是压缩存放的(bz2格式)，大约4M左右大小</span>
<span class="token comment" spellcheck="true"># file /boot/vmlinuz-2.6.32-573.22.1.el6.i686</span>
/boot/vmlinuz-2.6.32-573.22.1.el6.i686: Linux kernel x86 boot executable bzImage, version 2.6.32-573.22.1.el6.i686 <span class="token punctuation">(</span>mockb, RO-rootFS, swap_dev 0x3, Normal VGA<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>ramdisk</code><ul>
<li><strong>CentOS 5</strong> ==&gt; <code>/boot/initrd-VERSION-release.img</code></li>
<li><strong>CentOS 6</strong> ==&gt; <code>/boot/initramfs-VERSION-release.img</code></li>
</ul>
</li>
</ul>
<p><img src="/images/system-startup-process-1.png" alt="CentOS系统启动流程"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ll -h /boot/initramfs-2.6.32-573.22.1.el6.i686.img</span>
-rw------- 1 root root 22M 4月  12 13:27 /boot/initramfs-2.6.32-573.22.1.el6.i686.img<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>模块文件<ul>
<li><code>/lib/modules/VERSION-release</code></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 模块文件会以内核文件的 VERSION-release 号作为目录存放，其中各个模块之间存在依赖关系</span>
<span class="token comment" spellcheck="true"># ls /lib/modules/2.6.32-573.22.1.el6.i686/</span>
build              modules.block    modules.ieee1394map  modules.ofmap     modules.symbols      vdso
extra              modules.ccwmap   modules.inputmap     modules.order     modules.symbols.bin  weak-updates
kernel             modules.dep      modules.isapnpmap    modules.pcimap    modules.usbmap
modules.alias      modules.dep.bin  modules.modesetting  modules.seriomap  <span class="token function">source</span>
modules.alias.bin  modules.drm      modules.networking   modules.softdep   updates<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 内核的真正存在位置</span>
<span class="token comment" spellcheck="true"># ll /lib/modules/2.6.32-573.22.1.el6.i686/kernel/</span>
总用量 32
drwxr-xr-x  3 root root 4096 4月  12 13:23 arch     <span class="token comment" spellcheck="true"># 架构</span>
drwxr-xr-x  3 root root 4096 4月  12 13:23 crypto   <span class="token comment" spellcheck="true"># 加密解密</span>
drwxr-xr-x 60 root root 4096 4月  12 13:23 drivers  <span class="token comment" spellcheck="true"># 驱动</span>
drwxr-xr-x 29 root root 4096 4月  12 13:23 fs       <span class="token comment" spellcheck="true"># 文件系统</span>
drwxr-xr-x  3 root root 4096 4月  12 13:23 kernel   <span class="token comment" spellcheck="true"># Kernel自己核心功能</span>
drwxr-xr-x  6 root root 4096 4月  12 13:23 lib      <span class="token comment" spellcheck="true"># 库</span>
drwxr-xr-x 28 root root 4096 4月  12 13:23 net      <span class="token comment" spellcheck="true"># 网络子系统</span>
drwxr-xr-x  9 root root 4096 4月  12 13:23 sound    <span class="token comment" spellcheck="true"># 声音子系统</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 我们虚拟机中使用的网卡驱动就是 e1000</span>
<span class="token comment" spellcheck="true"># ll /lib/modules/2.6.32-573.22.1.el6.i686/kernel/drivers/net/e1000</span>
总用量 160
-rwxr--r-- 1 root root 163388 3月  23 09:45 e1000.ko<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="3-系统启动流程"><a href="#3-系统启动流程" class="headerlink" title="3. 系统启动流程"></a>3. 系统启动流程</h2><blockquote>
<p><strong><code>系统初始化：</code></strong></p>
</blockquote>
<ul>
<li><strong>POST ==&gt; BootSequence(BIOS) ==&gt; Bootloader(MBR) ==&gt; kernel(ramdisk) ==&gt; rootfs(只读) ==&gt; init</strong></li>
</ul>
<blockquote>
<p><strong><code>用户空间初始化：</code></strong></p>
</blockquote>
<ul>
<li><strong>/sbin/init ==&gt; (/etc/inittab) ==&gt; 设置默认运行级别 ==&gt; 运行系统初始脚本、完成系统初始化 ==&gt; 关闭对应下需要关闭的服务，启动需要启动服务 ==&gt; 设置登录终端</strong></li>
</ul>
<blockquote>
<p><strong><code>CentOS 6启动流程：</code></strong></p>
</blockquote>
<ul>
<li><strong>POST ==&gt; Boot Sequence(BIOS) ==&gt; Boot Loader (MBR) ==&gt; Kernel(ramdisk) ==&gt; rootfs ==&gt; switchroot ==&gt; /sbin/init ==&gt;(/etc/inittab, /etc/init/*.conf) ==&gt; 设定默认运行级别 ==&gt; 系统初始化脚本 ==&gt; 关闭或启动对应级别下的服务 ==&gt; 启动终端</strong></li>
</ul>
<p><img src="/images/system-startup-process-2.png" alt="CentOS系统启动流程"></p>
<p><img src="/images/system-startup-process-9.jpg" alt="CentOS系统启动流程"></p>
<hr>
<h3 id="3-1-POST"><a href="#3-1-POST" class="headerlink" title="3.1 POST"></a>3.1 POST</h3><ul>
<li>当我们按下开机的电源后，主板上的芯片组会首先向 CPU 发出一个 reset 指令，之后待芯片组检测到电源供电稳定后便撤去 reset 指令，CPU 就会跳转到 BIOS 中的启动代码位置; BIOS 首先要检测关键设备（如内显、显卡等）是否正常，这个过程就称为 POST（加电后自检）。</li>
<li>POST 完成后 BIOS 会调用其它代码来进行完整的硬件检测。</li>
</ul>
<hr>
<h3 id="3-2-BOOT-Sequence"><a href="#3-2-BOOT-Sequence" class="headerlink" title="3.2 BOOT Sequence"></a>3.2 BOOT Sequence</h3><ul>
<li>按次序查找各引导设备，第一个有引导程序的设备即为本次启动用到设备。</li>
</ul>
<hr>
<h3 id="3-3-MBR"><a href="#3-3-MBR" class="headerlink" title="3.3 MBR"></a>3.3 MBR</h3><ul>
<li>446bytes: 引导加载程序（<code>boot loader)</code></li>
<li>64bytes: 分区表</li>
<li>2bytes: 有效性标记</li>
</ul>
<hr>
<h3 id="3-4-Boot-Loader"><a href="#3-4-Boot-Loader" class="headerlink" title="3.4 Boot Loader"></a>3.4 Boot Loader</h3><ul>
<li>提供一个菜单，允许用户选择要启动系统或不同的内核版本；把用户选定的内核装载到内存中的特定空间中，解压、展开，并把系统控制权移交给内核。</li>
<li><strong>Boot Loader 分类</strong><ul>
<li>windows<ul>
<li><code>ntloader</code></li>
</ul>
</li>
<li>Linux<ul>
<li><code>LILO</code>：LInux LOader</li>
<li><code>GRUB</code>: GRand Uniform Bootloader<ul>
<li>GRUB 0.X: GRUB Legacy</li>
<li>GRUB 1.x: GRUB2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 这是CentOS6中的grub版本，而在7中使用用C语言完全进行重写的grub</span>
<span class="token comment" spellcheck="true"># rpm -q grub</span>
grub-0.97-94.el6_7.1.i686<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="3-5-GRUB"><a href="#3-5-GRUB" class="headerlink" title="3.5 GRUB"></a>3.5 GRUB</h3><p><img src="/images/system-startup-process-3.png" alt="CentOS系统启动流程"></p>
<ul>
<li><code>1st stage</code><ul>
<li>第 1 阶段很容易就能加载，因为就在 boot loader 当中，用来帮助我们找到第二阶段的存放位置。</li>
<li>MBR 分区中的 boot loader 只有 256 字节，这显然并不能直接驱动我们的内核，其实 MBR 中的 boot loader 只是 Grub Legacy 的 stage1（第一阶段），可以引导到存在 Grub Legacy 分区</li>
</ul>
</li>
<li><code>1_5 stage</code><ul>
<li>第 1_5 阶段，用来加载第二阶段的文件系统驱动。</li>
<li>stage1 并不知道 Grub Legacy 所在分区的驱动，所以在 MBR 后的扇区中有着一些常用的文件系统驱动可供 stage1 引导至 stage2 中。</li>
<li>在系统安装之后就确定了，应该使用<code>/boot/grub/</code>中的那个 1_5 阶段文件系统驱动。</li>
</ul>
</li>
<li><code>2nd stage</code><br>第 2 阶段才是真正的加载内核的过程。</li>
</ul>
<p><strong>1st stage</strong></p>
<p><img src="/images/system-startup-process-4.png" alt="CentOS系统启动流程"></p>
<p><strong>2nd stage</strong></p>
<p><img src="/images/system-startup-process-5.png" alt="CentOS系统启动流程"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ll /boot/grub/</span>
总用量 273
-rw-r--r--. 1 root root     64 12月 20 2011 device.map
-rw-r--r--. 1 root root  13392 12月 20 2011 e2fs_stage1_5
-rw-r--r--. 1 root root  12632 12月 20 2011 fat_stage1_5
-rw-r--r--. 1 root root  11760 12月 20 2011 ffs_stage1_5
-rw-------  1 root root   2311 4月  12 13:27 grub.conf
-rw-r--r--. 1 root root  11768 12月 20 2011 iso9660_stage1_5
-rw-r--r--. 1 root root  13280 12月 20 2011 jfs_stage1_5
lrwxrwxrwx. 1 root root     11 12月 20 2011 menu.lst -<span class="token operator">></span> ./grub.conf
-rw-r--r--. 1 root root  11968 12月 20 2011 minix_stage1_5
-rw-r--r--. 1 root root  14424 12月 20 2011 reiserfs_stage1_5
-rw-r--r--  1 root root   1341 11月 15 2010 splash.xpm.gz
-rw-r--r--. 1 root root    512 12月 20 2011 stage1
-rw-r--r--. 1 root root 125744 12月 20 2011 stage2
-rw-r--r--. 1 root root  12036 12月 20 2011 ufs2_stage1_5
-rw-r--r--. 1 root root  11376 12月 20 2011 vstafs_stage1_5
-rw-r--r--. 1 root root  13976 12月 20 2011 xfs_stage1_5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="3-6-Kernel"><a href="#3-6-Kernel" class="headerlink" title="3.6 Kernel"></a>3.6 Kernel</h3><ul>
<li><p><strong>自身初始化</strong></p>
<ul>
<li>探测可识别到的所有硬件设备</li>
<li>加载硬件驱动程序（有可能会借助于<code>ramdisk</code>加载驱动）</li>
<li>以只读方式挂载根文件系统</li>
<li>运行用户空间的第一个应用程序：<code>/sbin/init</code></li>
</ul>
</li>
<li><p><strong>init 程序的类型</strong></p>
<ul>
<li>CentOS 5<ul>
<li><strong>SysV</strong>：init</li>
<li>配置文件：<code>/etc/inittab</code></li>
<li>初始化操作都是借助于脚本来启动服务，所以在启动的时候会有大量的创建和关闭进程操作，并且服务之间有依赖关系。</li>
</ul>
</li>
<li>CentOS 6<ul>
<li><strong>Upstart</strong>：init</li>
<li>配置文件：<code>/etc/inittab</code>, <code>/etc/init/*.conf</code></li>
<li>Ubuntu 研发的</li>
<li>兼容 CentOS 5</li>
<li>借助于 D-Bus，使进程基于总线方式的，不用系统完成启动就可以使依赖的程序启动，解决了无法之间的依赖问题。但是，还是通过脚本来启动服务。</li>
</ul>
</li>
<li>CentOS 7<ul>
<li><strong>Systemd</strong>：</li>
<li>配置文件：<code>/usr/lib/systemd/system</code>, <code>/etc/systemd/system</code></li>
<li>参考 Mac OSX 的系统启动做的</li>
<li>Systemd 能够自己来启动服务，而不需要使用 bash。</li>
<li>在系统初始化的时候，不真正的启动进程而是在第一次使用的时候才启动。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>ramdisk</strong><br>内核中的特性之一：<strong>使用缓冲和缓存来回事对磁盘上的文件访问</strong></p>
<ul>
<li><code>ramdisk</code> ==&gt; <code>ramfs</code></li>
<li>CentOS 5 ==&gt; initrd ==&gt; <code>ramdisk</code><ul>
<li>工具程序：mkinitrd</li>
</ul>
</li>
<li>CentOS 6 ==&gt; initramfs ==&gt; <code>ramfs</code><ul>
<li>工具程序：mkinitrd, dracut</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/system-startup-process-6.png" alt="CentOS系统启动流程"></p>
<p><img src="/images/system-startup-process-7.png" alt="CentOS系统启动流程"></p>
<hr>
<h3 id="3-7-sbin-init"><a href="#3-7-sbin-init" class="headerlink" title="3.7 /sbin/init"></a>3.7 <strong>/sbin/init</strong></h3><p><strong>CentOS 5</strong></p>
<ul>
<li><p><strong>运行级别</strong>：为了系统的运行或维护等应用目的而设定；<br>7 个级别(0-6)</p>
<ul>
<li><code>0</code>：关机</li>
<li><code>1</code>：单用户模式(root, 无须登录), <code>single</code>, 维护模式；</li>
<li><code>2</code>: 多用户模式，会启动网络功能，但不会启动 NFS；维护模式；</li>
<li><code>3</code>：多用户模式，正常模式；文本界面；</li>
<li><code>4</code>：预留级别；可同 3 级别；</li>
<li><code>5</code>：多用户模式，正常模式；图形界面；</li>
<li><code>6</code>：重启</li>
</ul>
</li>
<li><p>默认级别：<code>3</code>, <code>5</code></p>
</li>
<li><p>切换级别：<code>init #</code></p>
</li>
<li><p>查看级别</p>
<ul>
<li><code>runlevel</code></li>
<li><code>who -r</code></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># N表示上次的级别为空，3表示本次启动级别</span>
<span class="token comment" spellcheck="true"># runlevel</span>
N 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>配置文件</strong>：<code>/etc/inittab</code><ul>
<li>格式：<code>id:runlevel:action:process</code></li>
<li>每一行定义一种 action 以及与之对应的 process</li>
<li><code>action</code><ul>
<li><code>wait</code>: 切换至此级别运行一次</li>
<li><code>respawn</code>：此 process 终止，就重新启动之</li>
<li><code>initdefault</code>：设定默认运行级别，process 省略</li>
<li><code>sysinit</code>：设定系统初始化方式，此处一般为指定<code>/etc/rc.d/rc.sysinit</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat /etc/inittab</span>
<span class="token comment" spellcheck="true"># id可以随意指定，只要不重复就可以；3表示默认启动3级别</span>
id:3:initdefault:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在上述脚本运行之后，紧接着CentOS 5/6中运行rc.sysinit这个系统初始化脚本</span>
<span class="token comment" spellcheck="true"># 可以使用 cat /etc/rc.d/rc.sysinit来查看详细内容。</span>

si::sysinit:/etc/rc.d/rc.sysinit

/etc/rc.d/rc.sysinit: 系统初始化脚本
<span class="token punctuation">(</span>1<span class="token punctuation">)</span> 设置主机名
<span class="token punctuation">(</span>2<span class="token punctuation">)</span> 设置欢迎信息
<span class="token punctuation">(</span>3<span class="token punctuation">)</span> 激活udev和selinux
<span class="token punctuation">(</span>4<span class="token punctuation">)</span> 挂载/etc/fstab文件中定义的文件系统
<span class="token punctuation">(</span>5<span class="token punctuation">)</span> 检测根文件系统，并以读写方式重新挂载根文件系统
<span class="token punctuation">(</span>6<span class="token punctuation">)</span> 设置系统时钟
<span class="token punctuation">(</span>7<span class="token punctuation">)</span> 激活swap设备
<span class="token punctuation">(</span>8<span class="token punctuation">)</span> 根据/etc/sysctl.conf文件设置内核参数
<span class="token punctuation">(</span>9<span class="token punctuation">)</span> 激活lvm及software raid设备
<span class="token punctuation">(</span>10<span class="token punctuation">)</span> 加载额外设备的驱动程序
<span class="token punctuation">(</span>11<span class="token punctuation">)</span> 清理操作<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 之后将执行下列对于级别运行脚本，rc 其实是一个脚本，后面是传入的参数</span>
<span class="token comment" spellcheck="true"># 可以通过使用 cat /etc/rc.d/rc 查看</span>
<span class="token comment" spellcheck="true"># rc 0 --> 意味着读取/etc/rc.d/rc0.d/</span>
l0:0:wait:/etc/rc.d/rc 0
l1:1:wait:/etc/rc.d/rc 1
<span class="token punctuation">..</span>.
l6:6:wait:/etc/rc.d/rc 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>/etc/rc.d/rcX.d/中文件内容</strong><ul>
<li><code>K*</code> ==&gt; <code>K##*</code>：<ul>
<li>关闭指定服务；</li>
<li><code>##</code>运行次序；数字越小，越先运行；</li>
<li>数字越小的服务，通常为依赖到别的服务；</li>
</ul>
</li>
<li><code>S*</code> ==&gt; <code>S##</code>*：<ul>
<li>启动指定服务；</li>
<li><code>##</code>运行次序；数字越小，越先运行</li>
<li>数字越小的服务，通常为被依赖到的服务；</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 可以这么类似的理解为如下脚本</span>
<span class="token comment" spellcheck="true"># stop</span>
<span class="token keyword">for</span> Sserver <span class="token keyword">in</span> /etc/rc.d/rcX.d/K*<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token variable">$srv</span> stop
<span class="token keyword">done</span>
<span class="token comment" spellcheck="true"># start</span>
<span class="token keyword">for</span> Kserver <span class="token keyword">in</span> /etc/rc.d/rcX.d/S*<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token variable">$srv</span> start
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ls /etc/rc.d/</span>
init.d  rc  rc0.d  rc1.d  rc2.d  rc3.d  rc4.d  rc5.d  rc6.d  rc.local  rc.sysinit

<span class="token comment" spellcheck="true"># 全都是链接文件，它们将连接到 /etc/rc.d/init.d 目录下</span>
<span class="token comment" spellcheck="true"># ls rc3.d</span>
K10saslauthd    K89rdisc         S10network                S25blk-availability
S70xensystem    S99shadowsocks   S80postfix                S90crond
K15svnserve     K92ip6tables     S11auditd                 S25netfs
K50netconsole   K92iptables      S12rsyslog                S26udev-post
K87restorecond  S02lvm2-monitor  S14xe-linux-distribution  S55sshd
S99local

<span class="token comment" spellcheck="true"># 查看/etc/rc.d/init.d/network，我们发现# chkconfig: 2345 10 90用来指定其执行先后顺序</span>
<span class="token comment" spellcheck="true"># ‘-’表示在所有级别下都不为S，即在所以rcX.d目录下创建一个S开头的链接文件。10表示S，90表示K</span>
<span class="token comment" spellcheck="true"># cat /etc/rc.d/init.d/network</span>
<span class="token comment" spellcheck="true">#! /bin/bash</span>
<span class="token comment" spellcheck="true"># network       Bring up/down networking</span>
<span class="token comment" spellcheck="true"># chkconfig: 2345 10 90</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p><strong><code>chkconfig</code>命令</strong><br>查看服务在所有级别的启动或关闭设定情形：<br><code>chkconfig [--list] [name]</code></p>
<ul>
<li><p><strong>添加</strong>：<br>SysV 的服务脚本放置于<code>/etc/rc.d/init.d</code> (<code>/etc/init.d</code>)<br><code>chkconfig --add name</code></p>
</li>
<li><p><strong>删除</strong><br><code>chkconfig --del name</code></p>
</li>
<li><p><strong>修改指定的链接类型</strong><br><code>chkconfig [--level levels] name &lt;on|off|reset&gt;</code></p>
<ul>
<li><code>--level LLLL</code>: 指定要设置的级别，省略时表示 2345</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>注意：</strong>正常启动的 3 级别下，最后启动一个服务<code>S99local</code>没有链接至<code>/etc/rc.d/init.d</code>一个服务脚本，而是指向了<code>/etc/rc.d/rc.local</code>脚本。因此，不便或不需写为服务脚本放置于<code>/etc/rc.d/init.d/</code>目录，且又想开机时自动运行的命令，可直接放置于<code>/etc/rc.d/rc.local</code>文件中。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 不便使用chkconfig命令控制或不需写为服务脚本放置于`/etc/rc.d/init.d/`目录</span>
<span class="token comment" spellcheck="true"># 且又想开机时自动运行的命令，可直接放置于`/etc/rc.d/rc.local`文件中</span>
<span class="token comment" spellcheck="true"># ls -l /etc/rc.d/rc3.d/S99local</span>
lrwxrwxrwx 1 root root 11 4月  12 13:23 /etc/rc.d/rc3.d/S99local -<span class="token operator">></span> <span class="token punctuation">..</span>/rc.local

<span class="token comment" spellcheck="true"># ls -l /etc/rc.d/rc3.d/S12rsyslog</span>
lrwxrwxrwx 1 root root 17 4月  12 13:23 /etc/rc.d/rc3.d/S12rsyslog -<span class="token operator">></span> <span class="token punctuation">..</span>/init.d/rsyslog

<span class="token comment" spellcheck="true"># cat /etc/rc.d/rc.local</span>
<span class="token comment" spellcheck="true">#!/bin/sh</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># This script will be executed *after* all the other init scripts.</span>
<span class="token comment" spellcheck="true"># You can put your own initialization stuff in here if you don't</span>
<span class="token comment" spellcheck="true"># want to do the full Sys V style init stuff.</span>

<span class="token function">touch</span> /var/lock/subsys/local
<span class="token function">sleep</span> 3
sh /usr/local/mount.sh

<span class="token comment" spellcheck="true"># 编辑这两个文件的任意一个文件都是可以，因为为连接指向</span>
<span class="token comment" spellcheck="true"># ls -l /etc/rc.local</span>
lrwxrwxrwx 1 root root 13 4月  12 13:23 /etc/rc.local -<span class="token operator">></span> rc.d/rc.local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 测试添加一个测试服务</span>
<span class="token comment" spellcheck="true"># vim /etc/rc.d/init.d/testserver</span>

<span class="token comment" spellcheck="true"># cat /etc/rc.d/init.d/testserver</span>
<span class="token comment" spellcheck="true">#！/bin/bash</span>
<span class="token comment" spellcheck="true"># chkconfig: 345 78 23</span>
<span class="token keyword">echo</span> hello

<span class="token comment" spellcheck="true"># chmod a+x /etc/rc.d/init.d/testserver</span>
<span class="token comment" spellcheck="true"># chkconfig --add testserver</span>
<span class="token comment" spellcheck="true"># chkconfig --list testserver</span>

<span class="token comment" spellcheck="true"># ls -l /etc/rc.d/rc0.d/K23testserver</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>启动终端</strong><ul>
<li>默认启动 6 个虚拟终端提供登录</li>
<li>mingetty 会调用 login 程序</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">tty1:2345:respawn:/usr/sbin/mingetty tty1
tty2:2345:respawn:/usr/sbin/mingetty tty2
<span class="token punctuation">..</span>.
tty6:2345:respawn:/usr/sbin/mingetty tty6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>CentOS 6</strong></p>
<p><img src="/images/system-startup-process-8.png" alt="CentOS系统启动流程"></p>
<ul>
<li><p><code>CentOS 6</code>与<code>CentOS 5</code>的启动过程基本上差不多，只有用户初始化的时候，会使用到自己特定的 <code>init</code> 程序 <code>upstart</code> 来完成初始化用户空间。</p>
</li>
<li><p><code>init</code> 程序 <code>upstart</code> 的配置文件</p>
<ul>
<li><code>/etc/inittab</code></li>
<li><code>/etc/init/*.conf</code><br><strong>/etc/init/*.conf</strong>文件语法 遵循 <code>upstart</code> 配置文件语法格式</li>
</ul>
</li>
<li><p>CentOS 中的<code>/etc/inittab</code>用来设定运行级别的，而 CentOS 6 一般不会使用这个脚本来设定的，只是为了兼容 CentOS 5 而已。其真正的配置文件放在 <code>/etc/init/*.conf</code>，其中将各个任务划分成为不同的配置文件。</p>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ls /etc/init/</span>
control-alt-delete.conf
plymouth-shutdown.conf
rc.conf
rcS-sulogin.conf
start-ttys.conf
init-system-dbus.conf
prefdm.conf
rcS.conf
serial.conf
tty.conf
kexec-disable.conf
quit-plymouth.conf
rcS-emergency.conf
splash-manager.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat rc.conf</span>
<span class="token comment" spellcheck="true"># rc - System V runlevel compatibility</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># This task runs the old sysv-rc runlevel scripts.  It</span>
<span class="token comment" spellcheck="true"># is usually started by the telinit compatibility wrapper.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Do not edit this file directly. If you want to change the behaviour,</span>
<span class="token comment" spellcheck="true"># please create a file rc.override and put your changes there.</span>

start on runlevel <span class="token punctuation">[</span>0123456<span class="token punctuation">]</span>
stop on runlevel <span class="token punctuation">[</span><span class="token operator">!</span><span class="token variable">$RUNLEVEL</span><span class="token punctuation">]</span>
task

<span class="token function">export</span> RUNLEVEL
console output
<span class="token function">exec</span> /etc/rc.d/rc <span class="token variable">$RUNLEVEL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat tty.conf</span>
<span class="token comment" spellcheck="true"># tty - getty</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># This service maintains a getty on the specified device.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Do not edit this file directly. If you want to change the behaviour,</span>
<span class="token comment" spellcheck="true"># please create a file tty.override and put your changes there.</span>

stop on runlevel <span class="token punctuation">[</span>S016<span class="token punctuation">]</span>

respawn
instance <span class="token variable">$TTY</span>
<span class="token function">exec</span> /sbin/mingetty <span class="token variable">$TTY</span>
usage <span class="token string">'tty TTY=/dev/ttyX  - where X is console id'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="4-常见问题纪要"><a href="#4-常见问题纪要" class="headerlink" title="4. 常见问题纪要"></a>4. 常见问题纪要</h2><ul>
<li><strong>系统启动挂载</strong></li>
</ul>
<p>最近发现 <code>CentOS7</code> 的 <code>/etc/rc.d/rc.local</code> 不会开机执行，于是认真看了下 <code>/etc/rc.d/rc.local</code> 文件内容就发现了问题的原因了。于是，确认了下 <code>/etc/rc.d/rc.local</code> 的权限，发现默认是没有执行权限的。使用 <code>chmod +x /etc/rc.d/rc.local</code> 命令赋值可执行权限即可正常使用了。从提示信息，可以执行这种方式正在弃用的路上。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 这种方式正在弃用的路上</span>
$ <span class="token function">cat</span> /etc/rc.d/rc.local
<span class="token comment" spellcheck="true">#!/bin/bash</span>

<span class="token comment" spellcheck="true"># 这个文件是为了兼容性的问题而添加的</span>
<span class="token comment" spellcheck="true"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># 强烈建议创建自己的systemd服务或udev规则来在开机时运行脚本而不是使用这个文件</span>
<span class="token comment" spellcheck="true"># It is highly advisable to create own systemd services or udev rules</span>
<span class="token comment" spellcheck="true"># to run scripts during boot instead of using this file.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># 强烈建议创建自己的systemd服务或udev规则来在开机时运行脚本而不是使用这个文件</span>
<span class="token comment" spellcheck="true"># In contrast to previous versions due to parallel execution during boot</span>
<span class="token comment" spellcheck="true"># this script will NOT be run after all other services.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># 请记住，你必须执行“chmod +x /etc/rc.d/rc.local”来确保确保这个脚本在引导时执行</span>
<span class="token comment" spellcheck="true"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span>
<span class="token comment" spellcheck="true"># that this script will be executed during boot.</span>

<span class="token function">touch</span> /var/lock/subsys/local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 以firewalld.service文件为例说明</span>

<span class="token comment" spellcheck="true"># 在/usr/lib/systemd/system目录添加firewalld.service配置文件</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>firewalld - dynamic firewall daemon
Before<span class="token operator">=</span>network-pre.target
Wants<span class="token operator">=</span>network-pre.target
After<span class="token operator">=</span>dbus.service
After<span class="token operator">=</span>polkit.service
Conflicts<span class="token operator">=</span>iptables.service ip6tables.service ebtables.service ipset.service
Documentation<span class="token operator">=</span>man:firewalld<span class="token punctuation">(</span>1<span class="token punctuation">)</span>

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
EnvironmentFile<span class="token operator">=</span>-/etc/sysconfig/firewalld
ExecStart<span class="token operator">=</span>/usr/sbin/firewalld --nofork --nopid <span class="token variable">$FIREWALLD_ARGS</span>
ExecReload<span class="token operator">=</span>/bin/kill -HUP <span class="token variable">$MAINPID</span>
<span class="token comment" spellcheck="true"># supress to log debug and error output also to /var/log/messages</span>
StandardOutput<span class="token operator">=</span>null
StandardError<span class="token operator">=</span>null
Type<span class="token operator">=</span>dbus
BusName<span class="token operator">=</span>org.fedoraproject.FirewallD1
KillMode<span class="token operator">=</span>mixed

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi-user.target
Alias<span class="token operator">=</span>dbus-org.fedoraproject.FirewallD1.service

<span class="token comment" spellcheck="true"># 相关命令</span>
执行命令 <span class="token operator">=</span><span class="token operator">></span> <span class="token function">sudo</span> systemctl <span class="token function">enable</span> tomcat.service
启动服务 <span class="token operator">=</span><span class="token operator">></span> <span class="token function">sudo</span> systemctl start tomcat.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Escape</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://escapelife.github.io/posts/null.html">https://escapelife.github.io/posts/null.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Escape</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Linux/">
                                    <span class="chip bg-color">Linux</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/b615ede7.html">
                    <div class="card-image">
                        
                        <img src="/images/changes-root-password.png" class="responsive-img" alt="CentOS系统修改ROOT密码">
                        
                        <span class="card-title">CentOS系统修改ROOT密码</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2017-12-05
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux入门基础/" class="post-category">
                                    Linux入门基础
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/3acaa44c.html">
                    <div class="card-image">
                        
                        <img src="/images/linux-kernel-know.png" class="responsive-img" alt="Linux系统内核概述">
                        
                        <span class="card-title">Linux系统内核概述</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2017-11-22
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux入门基础/" class="post-category">
                                    Linux入门基础
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="764454432"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='none'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2017-2021</span>
            
            <span id="year">2017</span>
            <a href="/about" target="_blank">Escape</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">1058.9k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2017";
                    var startMonth = "2";
                    var startDate = "14";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/EscapeLife" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:wenpanhappy@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
