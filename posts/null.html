<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="CentOS系统启动流程, Escape Escpae&#39;s Python Linux Bug Linnux运维之路 Python成长笔记 Web进击之旅 Bug解决之道 文所未闻 音乐墙 关于我">
    <meta name="description" content="听摇滚,但不偏颇;也挺古典,但不安逸">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>CentOS系统启动流程 | Escape</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Escape</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Escape</div>
        <div class="logo-desc">
            
            听摇滚,但不偏颇;也挺古典,但不安逸
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/EscapeLife" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/EscapeLife" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/images/ramdisk.png')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CentOS系统启动流程</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Linux/">
                                <span class="chip bg-color">Linux</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Linux运维之路/" class="post-category">
                                Linux运维之路
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2017-12-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-05-14
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    4.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    18 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>我们学习<code>Linux</code>系统，首先必须要了解其启动的流程顺序。这样当我们遇到系统无法启动的时候就能快速定位出问题的原因，以及如何更好、更快的解决该问题。所以，基础很重要的。</p>
</blockquote>
<p><img src="/images/ramdisk.png" alt="CentOS系统启动流程"></p>
<hr>
<h2 id="1-系统基础知识"><a href="#1-系统基础知识" class="headerlink" title="1. 系统基础知识"></a>1. 系统基础知识</h2><p><strong>超简洁 Linux 机构</strong></p>
<ul>
<li><code>Linux = kernel + rootfs</code></li>
</ul>
<p><strong>内核设计流派</strong></p>
<ul>
<li>单内核设计：<ul>
<li>典型操作系统：<code>Linux</code></li>
<li>把所有功能集成于同一个程序，各种功能使用进程来实现</li>
</ul>
</li>
<li>微内核设计：<ul>
<li>典型操作系统：<code>Windows</code>、Solaris</li>
<li>每种功能使用一个单独子系统实现</li>
</ul>
</li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%86%85%E6%A0%B8" target="_blank" rel="noopener">点击这里，查看更多关内核的信息</a></li>
</ul>
<p><strong>Linux 内核特点</strong></p>
<ul>
<li>支持模块化 <code>.ko</code></li>
<li>支持模块的动态装载和卸载</li>
</ul>
<p><strong>Linux 内核的组成部分</strong></p>
<ul>
<li>核心文件<ul>
<li><code>/boot/vmlinuz-VERSION-release</code></li>
<li>内核也被做成了<code>rpm</code>包，这里的<code>release</code>表示 rpm 的版本号</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ll -h /boot/vmlinuz-2.6.32-573.22.1.el6.i686</span>
-rwxr-xr-x 1 root root 3.9M 3月  23 09:05 /boot/vmlinuz-2.6.32-573.22.1.el6.i686<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 发现内核是压缩存放的(bz2格式)，大约4M左右大小</span>
<span class="token comment" spellcheck="true"># file /boot/vmlinuz-2.6.32-573.22.1.el6.i686</span>
/boot/vmlinuz-2.6.32-573.22.1.el6.i686: Linux kernel x86 boot executable bzImage, version 2.6.32-573.22.1.el6.i686 <span class="token punctuation">(</span>mockb, RO-rootFS, swap_dev 0x3, Normal VGA<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>ramdisk</code><ul>
<li><strong>CentOS 5</strong> ==&gt; <code>/boot/initrd-VERSION-release.img</code></li>
<li><strong>CentOS 6</strong> ==&gt; <code>/boot/initramfs-VERSION-release.img</code></li>
</ul>
</li>
</ul>
<p><img src="/images/ramdisk1.png" alt="CentOS系统启动流程"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ll -h /boot/initramfs-2.6.32-573.22.1.el6.i686.img</span>
-rw------- 1 root root 22M 4月  12 13:27 /boot/initramfs-2.6.32-573.22.1.el6.i686.img<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>模块文件<ul>
<li><code>/lib/modules/VERSION-release</code></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 模块文件会以内核文件的 VERSION-release 号作为目录存放，其中各个模块之间存在依赖关系</span>
<span class="token comment" spellcheck="true"># ls /lib/modules/2.6.32-573.22.1.el6.i686/</span>
build              modules.block    modules.ieee1394map  modules.ofmap     modules.symbols      vdso
extra              modules.ccwmap   modules.inputmap     modules.order     modules.symbols.bin  weak-updates
kernel             modules.dep      modules.isapnpmap    modules.pcimap    modules.usbmap
modules.alias      modules.dep.bin  modules.modesetting  modules.seriomap  <span class="token function">source</span>
modules.alias.bin  modules.drm      modules.networking   modules.softdep   updates<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 内核的真正存在位置</span>
<span class="token comment" spellcheck="true"># ll /lib/modules/2.6.32-573.22.1.el6.i686/kernel/</span>
总用量 32
drwxr-xr-x  3 root root 4096 4月  12 13:23 arch     <span class="token comment" spellcheck="true"># 架构</span>
drwxr-xr-x  3 root root 4096 4月  12 13:23 crypto   <span class="token comment" spellcheck="true"># 加密解密</span>
drwxr-xr-x 60 root root 4096 4月  12 13:23 drivers  <span class="token comment" spellcheck="true"># 驱动</span>
drwxr-xr-x 29 root root 4096 4月  12 13:23 fs       <span class="token comment" spellcheck="true"># 文件系统</span>
drwxr-xr-x  3 root root 4096 4月  12 13:23 kernel   <span class="token comment" spellcheck="true"># Kernel自己核心功能</span>
drwxr-xr-x  6 root root 4096 4月  12 13:23 lib      <span class="token comment" spellcheck="true"># 库</span>
drwxr-xr-x 28 root root 4096 4月  12 13:23 net      <span class="token comment" spellcheck="true"># 网络子系统</span>
drwxr-xr-x  9 root root 4096 4月  12 13:23 sound    <span class="token comment" spellcheck="true"># 声音子系统</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 我们虚拟机中使用的网卡驱动就是 e1000</span>
<span class="token comment" spellcheck="true"># ll /lib/modules/2.6.32-573.22.1.el6.i686/kernel/drivers/net/e1000</span>
总用量 160
-rwxr--r-- 1 root root 163388 3月  23 09:45 e1000.ko<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="2-系统启动流程"><a href="#2-系统启动流程" class="headerlink" title="2. 系统启动流程"></a>2. 系统启动流程</h2><blockquote>
<p><strong><code>系统初始化：</code></strong></p>
</blockquote>
<ul>
<li><strong>POST ==&gt; BootSequence(BIOS) ==&gt; Bootloader(MBR) ==&gt; kernel(ramdisk) ==&gt; rootfs(只读) ==&gt; init</strong></li>
</ul>
<blockquote>
<p><strong><code>用户空间初始化：</code></strong></p>
</blockquote>
<ul>
<li><strong>/sbin/init ==&gt; (/etc/inittab) ==&gt; 设置默认运行级别 ==&gt; 运行系统初始脚本、完成系统初始化 ==&gt; 关闭对应下需要关闭的服务，启动需要启动服务 ==&gt; 设置登录终端</strong></li>
</ul>
<blockquote>
<p><strong><code>CentOS 6启动流程：</code></strong></p>
</blockquote>
<ul>
<li><strong>POST ==&gt; Boot Sequence(BIOS) ==&gt; Boot Loader (MBR) ==&gt; Kernel(ramdisk) ==&gt; rootfs ==&gt; switchroot ==&gt; /sbin/init ==&gt;(/etc/inittab, /etc/init/*.conf) ==&gt; 设定默认运行级别 ==&gt; 系统初始化脚本 ==&gt; 关闭或启动对应级别下的服务 ==&gt; 启动终端</strong></li>
</ul>
<p><img src="/images/ramdisk2.png" alt="CentOS系统启动流程"></p>
<p><img src="/images/ramdisk9.jpg" alt="CentOS系统启动流程"></p>
<hr>
<h3 id="2-1-POST"><a href="#2-1-POST" class="headerlink" title="2.1 POST"></a>2.1 POST</h3><ul>
<li>当我们按下开机的电源后，主板上的芯片组会首先向 CPU 发出一个 reset 指令，之后待芯片组检测到电源供电稳定后便撤去 reset 指令，CPU 就会跳转到 BIOS 中的启动代码位置; BIOS 首先要检测关键设备（如内显、显卡等）是否正常，这个过程就称为 POST（加电后自检）。</li>
<li>POST 完成后 BIOS 会调用其它代码来进行完整的硬件检测。</li>
</ul>
<hr>
<h3 id="2-2-BOOT-Sequence"><a href="#2-2-BOOT-Sequence" class="headerlink" title="2.2 BOOT Sequence"></a>2.2 BOOT Sequence</h3><ul>
<li>按次序查找各引导设备，第一个有引导程序的设备即为本次启动用到设备。</li>
</ul>
<hr>
<h3 id="2-3-MBR"><a href="#2-3-MBR" class="headerlink" title="2.3 MBR"></a>2.3 MBR</h3><ul>
<li>446bytes: 引导加载程序（<code>boot loader)</code></li>
<li>64bytes: 分区表</li>
<li>2bytes: 有效性标记</li>
</ul>
<hr>
<h3 id="2-4-Boot-Loader"><a href="#2-4-Boot-Loader" class="headerlink" title="2.4 Boot Loader"></a>2.4 Boot Loader</h3><ul>
<li>提供一个菜单，允许用户选择要启动系统或不同的内核版本；把用户选定的内核装载到内存中的特定空间中，解压、展开，并把系统控制权移交给内核。</li>
<li><strong>Boot Loader 分类</strong><ul>
<li>windows<ul>
<li><code>ntloader</code></li>
</ul>
</li>
<li>Linux<ul>
<li><code>LILO</code>：LInux LOader</li>
<li><code>GRUB</code>: GRand Uniform Bootloader<ul>
<li>GRUB 0.X: GRUB Legacy</li>
<li>GRUB 1.x: GRUB2</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 这是CentOS6中的grub版本，而在7中使用用C语言完全进行重写的grub</span>
<span class="token comment" spellcheck="true"># rpm -q grub</span>
grub-0.97-94.el6_7.1.i686<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="2-5-GRUB"><a href="#2-5-GRUB" class="headerlink" title="2.5 GRUB"></a>2.5 GRUB</h3><p><img src="/images/ramdisk3.png" alt="CentOS系统启动流程"></p>
<ul>
<li><code>1st stage</code><ul>
<li>第 1 阶段很容易就能加载，因为就在 boot loader 当中，用来帮助我们找到第二阶段的存放位置。</li>
<li>MBR 分区中的 boot loader 只有 256 字节，这显然并不能直接驱动我们的内核，其实 MBR 中的 boot loader 只是 Grub Legacy 的 stage1（第一阶段），可以引导到存在 Grub Legacy 分区</li>
</ul>
</li>
<li><code>1_5 stage</code><ul>
<li>第 1_5 阶段，用来加载第二阶段的文件系统驱动。</li>
<li>stage1 并不知道 Grub Legacy 所在分区的驱动，所以在 MBR 后的扇区中有着一些常用的文件系统驱动可供 stage1 引导至 stage2 中。</li>
<li>在系统安装之后就确定了，应该使用<code>/boot/grub/</code>中的那个 1_5 阶段文件系统驱动。</li>
</ul>
</li>
<li><code>2nd stage</code><br>第 2 阶段才是真正的加载内核的过程。</li>
</ul>
<p><strong>1st stage</strong></p>
<p><img src="/images/ramdisk4.png" alt="CentOS系统启动流程"></p>
<p><strong>2nd stage</strong></p>
<p><img src="/images/ramdisk5.png" alt="CentOS系统启动流程"></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ll /boot/grub/</span>
总用量 273
-rw-r--r--. 1 root root     64 12月 20 2011 device.map
-rw-r--r--. 1 root root  13392 12月 20 2011 e2fs_stage1_5
-rw-r--r--. 1 root root  12632 12月 20 2011 fat_stage1_5
-rw-r--r--. 1 root root  11760 12月 20 2011 ffs_stage1_5
-rw-------  1 root root   2311 4月  12 13:27 grub.conf
-rw-r--r--. 1 root root  11768 12月 20 2011 iso9660_stage1_5
-rw-r--r--. 1 root root  13280 12月 20 2011 jfs_stage1_5
lrwxrwxrwx. 1 root root     11 12月 20 2011 menu.lst -<span class="token operator">></span> ./grub.conf
-rw-r--r--. 1 root root  11968 12月 20 2011 minix_stage1_5
-rw-r--r--. 1 root root  14424 12月 20 2011 reiserfs_stage1_5
-rw-r--r--  1 root root   1341 11月 15 2010 splash.xpm.gz
-rw-r--r--. 1 root root    512 12月 20 2011 stage1
-rw-r--r--. 1 root root 125744 12月 20 2011 stage2
-rw-r--r--. 1 root root  12036 12月 20 2011 ufs2_stage1_5
-rw-r--r--. 1 root root  11376 12月 20 2011 vstafs_stage1_5
-rw-r--r--. 1 root root  13976 12月 20 2011 xfs_stage1_5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="2-6-Kernel"><a href="#2-6-Kernel" class="headerlink" title="2.6 Kernel"></a>2.6 Kernel</h3><ul>
<li><p><strong>自身初始化</strong></p>
<ul>
<li>探测可识别到的所有硬件设备</li>
<li>加载硬件驱动程序（有可能会借助于<code>ramdisk</code>加载驱动）</li>
<li>以只读方式挂载根文件系统</li>
<li>运行用户空间的第一个应用程序：<code>/sbin/init</code></li>
</ul>
</li>
<li><p><strong>init 程序的类型</strong></p>
<ul>
<li>CentOS 5<ul>
<li><strong>SysV</strong>：init</li>
<li>配置文件：<code>/etc/inittab</code></li>
<li>初始化操作都是借助于脚本来启动服务，所以在启动的时候会有大量的创建和关闭进程操作，并且服务之间有依赖关系。</li>
</ul>
</li>
<li>CentOS 6<ul>
<li><strong>Upstart</strong>：init</li>
<li>配置文件：<code>/etc/inittab</code>, <code>/etc/init/*.conf</code></li>
<li>Ubuntu 研发的</li>
<li>兼容 CentOS 5</li>
<li>借助于 D-Bus，使进程基于总线方式的，不用系统完成启动就可以使依赖的程序启动，解决了无法之间的依赖问题。但是，还是通过脚本来启动服务。</li>
</ul>
</li>
<li>CentOS 7<ul>
<li><strong>Systemd</strong>：</li>
<li>配置文件：<code>/usr/lib/systemd/system</code>, <code>/etc/systemd/system</code></li>
<li>参考 Mac OSX 的系统启动做的</li>
<li>Systemd 能够自己来启动服务，而不需要使用 bash。</li>
<li>在系统初始化的时候，不真正的启动进程而是在第一次使用的时候才启动。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>ramdisk</strong><br>内核中的特性之一：<strong>使用缓冲和缓存来回事对磁盘上的文件访问</strong></p>
<ul>
<li><code>ramdisk</code> ==&gt; <code>ramfs</code></li>
<li>CentOS 5 ==&gt; initrd ==&gt; <code>ramdisk</code><ul>
<li>工具程序：mkinitrd</li>
</ul>
</li>
<li>CentOS 6 ==&gt; initramfs ==&gt; <code>ramfs</code><ul>
<li>工具程序：mkinitrd, dracut</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/ramdisk6.png" alt="CentOS系统启动流程"></p>
<p><img src="/images/ramdisk7.png" alt="CentOS系统启动流程"></p>
<hr>
<h3 id="2-7-sbin-init"><a href="#2-7-sbin-init" class="headerlink" title="2.7 /sbin/init"></a>2.7 <strong>/sbin/init</strong></h3><p><strong>CentOS 5</strong></p>
<ul>
<li><p><strong>运行级别</strong>：为了系统的运行或维护等应用目的而设定；<br>7 个级别(0-6)</p>
<ul>
<li><code>0</code>：关机</li>
<li><code>1</code>：单用户模式(root, 无须登录), <code>single</code>, 维护模式；</li>
<li><code>2</code>: 多用户模式，会启动网络功能，但不会启动 NFS；维护模式；</li>
<li><code>3</code>：多用户模式，正常模式；文本界面；</li>
<li><code>4</code>：预留级别；可同 3 级别；</li>
<li><code>5</code>：多用户模式，正常模式；图形界面；</li>
<li><code>6</code>：重启</li>
</ul>
</li>
<li><p>默认级别：<code>3</code>, <code>5</code></p>
</li>
<li><p>切换级别：<code>init #</code></p>
</li>
<li><p>查看级别</p>
<ul>
<li><code>runlevel</code></li>
<li><code>who -r</code></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># N表示上次的级别为空，3表示本次启动级别</span>
<span class="token comment" spellcheck="true"># runlevel</span>
N 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>配置文件</strong>：<code>/etc/inittab</code><ul>
<li>格式：<code>id:runlevel:action:process</code></li>
<li>每一行定义一种 action 以及与之对应的 process</li>
<li><code>action</code><ul>
<li><code>wait</code>: 切换至此级别运行一次</li>
<li><code>respawn</code>：此 process 终止，就重新启动之</li>
<li><code>initdefault</code>：设定默认运行级别，process 省略</li>
<li><code>sysinit</code>：设定系统初始化方式，此处一般为指定<code>/etc/rc.d/rc.sysinit</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat /etc/inittab</span>
<span class="token comment" spellcheck="true"># id可以随意指定，只要不重复就可以；3表示默认启动3级别</span>
id:3:initdefault:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在上述脚本运行之后，紧接着CentOS 5/6中运行rc.sysinit这个系统初始化脚本</span>
<span class="token comment" spellcheck="true"># 可以使用 cat /etc/rc.d/rc.sysinit来查看详细内容。</span>

si::sysinit:/etc/rc.d/rc.sysinit

/etc/rc.d/rc.sysinit: 系统初始化脚本
<span class="token punctuation">(</span>1<span class="token punctuation">)</span> 设置主机名
<span class="token punctuation">(</span>2<span class="token punctuation">)</span> 设置欢迎信息
<span class="token punctuation">(</span>3<span class="token punctuation">)</span> 激活udev和selinux
<span class="token punctuation">(</span>4<span class="token punctuation">)</span> 挂载/etc/fstab文件中定义的文件系统
<span class="token punctuation">(</span>5<span class="token punctuation">)</span> 检测根文件系统，并以读写方式重新挂载根文件系统
<span class="token punctuation">(</span>6<span class="token punctuation">)</span> 设置系统时钟
<span class="token punctuation">(</span>7<span class="token punctuation">)</span> 激活swap设备
<span class="token punctuation">(</span>8<span class="token punctuation">)</span> 根据/etc/sysctl.conf文件设置内核参数
<span class="token punctuation">(</span>9<span class="token punctuation">)</span> 激活lvm及software raid设备
<span class="token punctuation">(</span>10<span class="token punctuation">)</span> 加载额外设备的驱动程序
<span class="token punctuation">(</span>11<span class="token punctuation">)</span> 清理操作<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 之后将执行下列对于级别运行脚本，rc 其实是一个脚本，后面是传入的参数</span>
<span class="token comment" spellcheck="true"># 可以通过使用 cat /etc/rc.d/rc 查看</span>
<span class="token comment" spellcheck="true"># rc 0 --> 意味着读取/etc/rc.d/rc0.d/</span>
l0:0:wait:/etc/rc.d/rc 0
l1:1:wait:/etc/rc.d/rc 1
<span class="token punctuation">..</span>.
l6:6:wait:/etc/rc.d/rc 6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>/etc/rc.d/rcX.d/中文件内容</strong><ul>
<li><code>K*</code> ==&gt; <code>K##*</code>：<ul>
<li>关闭指定服务；</li>
<li><code>##</code>运行次序；数字越小，越先运行；</li>
<li>数字越小的服务，通常为依赖到别的服务；</li>
</ul>
</li>
<li><code>S*</code> ==&gt; <code>S##</code>*：<ul>
<li>启动指定服务；</li>
<li><code>##</code>运行次序；数字越小，越先运行</li>
<li>数字越小的服务，通常为被依赖到的服务；</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 可以这么类似的理解为如下脚本</span>
<span class="token comment" spellcheck="true"># stop</span>
<span class="token keyword">for</span> Sserver <span class="token keyword">in</span> /etc/rc.d/rcX.d/K*<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token variable">$srv</span> stop
<span class="token keyword">done</span>
<span class="token comment" spellcheck="true"># start</span>
<span class="token keyword">for</span> Kserver <span class="token keyword">in</span> /etc/rc.d/rcX.d/S*<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token variable">$srv</span> start
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ls /etc/rc.d/</span>
init.d  rc  rc0.d  rc1.d  rc2.d  rc3.d  rc4.d  rc5.d  rc6.d  rc.local  rc.sysinit

<span class="token comment" spellcheck="true"># 全都是链接文件，它们将连接到 /etc/rc.d/init.d 目录下</span>
<span class="token comment" spellcheck="true"># ls rc3.d</span>
K10saslauthd    K89rdisc         S10network                S25blk-availability
S70xensystem    S99shadowsocks   S80postfix                S90crond
K15svnserve     K92ip6tables     S11auditd                 S25netfs
K50netconsole   K92iptables      S12rsyslog                S26udev-post
K87restorecond  S02lvm2-monitor  S14xe-linux-distribution  S55sshd
S99local

<span class="token comment" spellcheck="true"># 查看/etc/rc.d/init.d/network，我们发现# chkconfig: 2345 10 90用来指定其执行先后顺序</span>
<span class="token comment" spellcheck="true"># ‘-’表示在所有级别下都不为S，即在所以rcX.d目录下创建一个S开头的链接文件。10表示S，90表示K</span>
<span class="token comment" spellcheck="true"># cat /etc/rc.d/init.d/network</span>
<span class="token comment" spellcheck="true">#! /bin/bash</span>
<span class="token comment" spellcheck="true"># network       Bring up/down networking</span>
<span class="token comment" spellcheck="true"># chkconfig: 2345 10 90</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p><strong><code>chkconfig</code>命令</strong><br>查看服务在所有级别的启动或关闭设定情形：<br><code>chkconfig [--list] [name]</code></p>
<ul>
<li><p><strong>添加</strong>：<br>SysV 的服务脚本放置于<code>/etc/rc.d/init.d</code> (<code>/etc/init.d</code>)<br><code>chkconfig --add name</code></p>
</li>
<li><p><strong>删除</strong><br><code>chkconfig --del name</code></p>
</li>
<li><p><strong>修改指定的链接类型</strong><br><code>chkconfig [--level levels] name &lt;on|off|reset&gt;</code></p>
<ul>
<li><code>--level LLLL</code>: 指定要设置的级别，省略时表示 2345</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>注意：</strong>正常启动的 3 级别下，最后启动一个服务<code>S99local</code>没有链接至<code>/etc/rc.d/init.d</code>一个服务脚本，而是指向了<code>/etc/rc.d/rc.local</code>脚本。因此，不便或不需写为服务脚本放置于<code>/etc/rc.d/init.d/</code>目录，且又想开机时自动运行的命令，可直接放置于<code>/etc/rc.d/rc.local</code>文件中。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 不便使用chkconfig命令控制或不需写为服务脚本放置于`/etc/rc.d/init.d/`目录</span>
<span class="token comment" spellcheck="true"># 且又想开机时自动运行的命令，可直接放置于`/etc/rc.d/rc.local`文件中</span>
<span class="token comment" spellcheck="true"># ls -l /etc/rc.d/rc3.d/S99local</span>
lrwxrwxrwx 1 root root 11 4月  12 13:23 /etc/rc.d/rc3.d/S99local -<span class="token operator">></span> <span class="token punctuation">..</span>/rc.local

<span class="token comment" spellcheck="true"># ls -l /etc/rc.d/rc3.d/S12rsyslog</span>
lrwxrwxrwx 1 root root 17 4月  12 13:23 /etc/rc.d/rc3.d/S12rsyslog -<span class="token operator">></span> <span class="token punctuation">..</span>/init.d/rsyslog

<span class="token comment" spellcheck="true"># cat /etc/rc.d/rc.local</span>
<span class="token comment" spellcheck="true">#!/bin/sh</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># This script will be executed *after* all the other init scripts.</span>
<span class="token comment" spellcheck="true"># You can put your own initialization stuff in here if you don't</span>
<span class="token comment" spellcheck="true"># want to do the full Sys V style init stuff.</span>

<span class="token function">touch</span> /var/lock/subsys/local
<span class="token function">sleep</span> 3
sh /usr/local/mount.sh

<span class="token comment" spellcheck="true"># 编辑这两个文件的任意一个文件都是可以，因为为连接指向</span>
<span class="token comment" spellcheck="true"># ls -l /etc/rc.local</span>
lrwxrwxrwx 1 root root 13 4月  12 13:23 /etc/rc.local -<span class="token operator">></span> rc.d/rc.local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 测试添加一个测试服务</span>
<span class="token comment" spellcheck="true"># vim /etc/rc.d/init.d/testserver</span>

<span class="token comment" spellcheck="true"># cat /etc/rc.d/init.d/testserver</span>
<span class="token comment" spellcheck="true">#！/bin/bash</span>
<span class="token comment" spellcheck="true"># chkconfig: 345 78 23</span>
<span class="token keyword">echo</span> hello

<span class="token comment" spellcheck="true"># chmod a+x /etc/rc.d/init.d/testserver</span>
<span class="token comment" spellcheck="true"># chkconfig --add testserver</span>
<span class="token comment" spellcheck="true"># chkconfig --list testserver</span>

<span class="token comment" spellcheck="true"># ls -l /etc/rc.d/rc0.d/K23testserver</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>启动终端</strong><ul>
<li>默认启动 6 个虚拟终端提供登录</li>
<li>mingetty 会调用 login 程序</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">tty1:2345:respawn:/usr/sbin/mingetty tty1
tty2:2345:respawn:/usr/sbin/mingetty tty2
<span class="token punctuation">..</span>.
tty6:2345:respawn:/usr/sbin/mingetty tty6<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>CentOS 6</strong></p>
<p><img src="/images/ramdisk8.png" alt="CentOS系统启动流程"></p>
<ul>
<li><p><code>CentOS 6</code>与<code>CentOS 5</code>的启动过程基本上差不多，只有用户初始化的时候，会使用到自己特定的 <code>init</code> 程序 <code>upstart</code> 来完成初始化用户空间。</p>
</li>
<li><p><code>init</code> 程序 <code>upstart</code> 的配置文件</p>
<ul>
<li><code>/etc/inittab</code></li>
<li><code>/etc/init/*.conf</code><br><strong>/etc/init/*.conf</strong>文件语法 遵循 <code>upstart</code> 配置文件语法格式</li>
</ul>
</li>
<li><p>CentOS 中的<code>/etc/inittab</code>用来设定运行级别的，而 CentOS 6 一般不会使用这个脚本来设定的，只是为了兼容 CentOS 5 而已。其真正的配置文件放在 <code>/etc/init/*.conf</code>，其中将各个任务划分成为不同的配置文件。</p>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ls /etc/init/</span>
control-alt-delete.conf
plymouth-shutdown.conf
rc.conf
rcS-sulogin.conf
start-ttys.conf
init-system-dbus.conf
prefdm.conf
rcS.conf
serial.conf
tty.conf
kexec-disable.conf
quit-plymouth.conf
rcS-emergency.conf
splash-manager.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat rc.conf</span>
<span class="token comment" spellcheck="true"># rc - System V runlevel compatibility</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># This task runs the old sysv-rc runlevel scripts.  It</span>
<span class="token comment" spellcheck="true"># is usually started by the telinit compatibility wrapper.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Do not edit this file directly. If you want to change the behaviour,</span>
<span class="token comment" spellcheck="true"># please create a file rc.override and put your changes there.</span>

start on runlevel <span class="token punctuation">[</span>0123456<span class="token punctuation">]</span>
stop on runlevel <span class="token punctuation">[</span><span class="token operator">!</span><span class="token variable">$RUNLEVEL</span><span class="token punctuation">]</span>
task

<span class="token function">export</span> RUNLEVEL
console output
<span class="token function">exec</span> /etc/rc.d/rc <span class="token variable">$RUNLEVEL</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat tty.conf</span>
<span class="token comment" spellcheck="true"># tty - getty</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># This service maintains a getty on the specified device.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Do not edit this file directly. If you want to change the behaviour,</span>
<span class="token comment" spellcheck="true"># please create a file tty.override and put your changes there.</span>

stop on runlevel <span class="token punctuation">[</span>S016<span class="token punctuation">]</span>

respawn
instance <span class="token variable">$TTY</span>
<span class="token function">exec</span> /sbin/mingetty <span class="token variable">$TTY</span>
usage <span class="token string">'tty TTY=/dev/ttyX  - where X is console id'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="3-常见问题纪要"><a href="#3-常见问题纪要" class="headerlink" title="3. 常见问题纪要"></a>3. 常见问题纪要</h2><ul>
<li><strong>系统启动挂载</strong></li>
</ul>
<p>最近发现 <code>CentOS7</code> 的 <code>/etc/rc.d/rc.local</code> 不会开机执行，于是认真看了下 <code>/etc/rc.d/rc.local</code> 文件内容就发现了问题的原因了。于是，确认了下 <code>/etc/rc.d/rc.local</code> 的权限，发现默认是没有执行权限的。使用 <code>chmod +x /etc/rc.d/rc.local</code> 命令赋值可执行权限即可正常使用了。从提示信息，可以执行这种方式正在弃用的路上。</p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 这种方式正在弃用的路上</span>
$ <span class="token function">cat</span> /etc/rc.d/rc.local
<span class="token comment" spellcheck="true">#!/bin/bash</span>

<span class="token comment" spellcheck="true"># 这个文件是为了兼容性的问题而添加的</span>
<span class="token comment" spellcheck="true"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># 强烈建议创建自己的systemd服务或udev规则来在开机时运行脚本而不是使用这个文件</span>
<span class="token comment" spellcheck="true"># It is highly advisable to create own systemd services or udev rules</span>
<span class="token comment" spellcheck="true"># to run scripts during boot instead of using this file.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># 强烈建议创建自己的systemd服务或udev规则来在开机时运行脚本而不是使用这个文件</span>
<span class="token comment" spellcheck="true"># In contrast to previous versions due to parallel execution during boot</span>
<span class="token comment" spellcheck="true"># this script will NOT be run after all other services.</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># 请记住，你必须执行“chmod +x /etc/rc.d/rc.local”来确保确保这个脚本在引导时执行</span>
<span class="token comment" spellcheck="true"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span>
<span class="token comment" spellcheck="true"># that this script will be executed during boot.</span>

<span class="token function">touch</span> /var/lock/subsys/local<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 以firewalld.service文件为例说明</span>

<span class="token comment" spellcheck="true"># 在/usr/lib/systemd/system目录添加firewalld.service配置文件</span>
<span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>firewalld - dynamic firewall daemon
Before<span class="token operator">=</span>network-pre.target
Wants<span class="token operator">=</span>network-pre.target
After<span class="token operator">=</span>dbus.service
After<span class="token operator">=</span>polkit.service
Conflicts<span class="token operator">=</span>iptables.service ip6tables.service ebtables.service ipset.service
Documentation<span class="token operator">=</span>man:firewalld<span class="token punctuation">(</span>1<span class="token punctuation">)</span>

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
EnvironmentFile<span class="token operator">=</span>-/etc/sysconfig/firewalld
ExecStart<span class="token operator">=</span>/usr/sbin/firewalld --nofork --nopid <span class="token variable">$FIREWALLD_ARGS</span>
ExecReload<span class="token operator">=</span>/bin/kill -HUP <span class="token variable">$MAINPID</span>
<span class="token comment" spellcheck="true"># supress to log debug and error output also to /var/log/messages</span>
StandardOutput<span class="token operator">=</span>null
StandardError<span class="token operator">=</span>null
Type<span class="token operator">=</span>dbus
BusName<span class="token operator">=</span>org.fedoraproject.FirewallD1
KillMode<span class="token operator">=</span>mixed

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi-user.target
Alias<span class="token operator">=</span>dbus-org.fedoraproject.FirewallD1.service

<span class="token comment" spellcheck="true"># 相关命令</span>
执行命令 <span class="token operator">=</span><span class="token operator">></span> <span class="token function">sudo</span> systemctl <span class="token function">enable</span> tomcat.service
启动服务 <span class="token operator">=</span><span class="token operator">></span> <span class="token function">sudo</span> systemctl start tomcat.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Escape</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://escapelife.github.io/posts/null.html">https://escapelife.github.io/posts/null.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Escape</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Linux/">
                                    <span class="chip bg-color">Linux</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/b615ede7.html">
                    <div class="card-image">
                        
                        <img src="/images/root.png" class="responsive-img" alt="CentOS系统修改ROOT密码">
                        
                        <span class="card-title">CentOS系统修改ROOT密码</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2017-12-05
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux运维之路/" class="post-category">
                                    Linux运维之路
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/301a9a73.html">
                    <div class="card-image">
                        
                        <img src="/images/jobs.png" class="responsive-img" alt="Linux进程及作业管理">
                        
                        <span class="card-title">Linux进程及作业管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2017-11-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Linux运维之路/" class="post-category">
                                    Linux运维之路
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('3'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="764454432"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='none'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2017</span>
            <a href="/about" target="_blank">Escape</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">703.4k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2017";
                    var startMonth = "2";
                    var startDate = "14";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/EscapeLife" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:wenpanhappy@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
