<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="DNS域名解析服务配置, Escape Escpae&#39;s Python Linux Bug Linnux运维之路 Python成长笔记 Web进击之旅 Bug解决之道 文所未闻 音乐墙 关于我">
    <meta name="description" content="听摇滚,但不偏颇;也挺古典,但不安逸">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>DNS域名解析服务配置 | Escape</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Escape</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Escape</div>
        <div class="logo-desc">
            
            听摇滚,但不偏颇;也挺古典,但不安逸
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/EscapeLife" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/EscapeLife" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/images/linux-dns-server.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">DNS域名解析服务配置</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Linux/">
                                <span class="chip bg-color">Linux</span>
                            </a>
                        
                            <a href="/tags/DNS/">
                                <span class="chip bg-color">DNS</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Linux服务部署/" class="post-category">
                                Linux服务部署
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2018-06-24
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-12-08
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    13.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    58 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p><strong>纸上得来终觉浅，绝知此事要躬行。</strong></p>
</blockquote>
<p><img src="/images/linux-dns-server.jpg" alt="DNS域名解析服务配置"></p>
<hr>
<h2 id="1-DNS-服务"><a href="#1-DNS-服务" class="headerlink" title="1. DNS 服务"></a>1. DNS 服务</h2><h3 id="1-1-DNS-服务介绍"><a href="#1-1-DNS-服务介绍" class="headerlink" title="1.1 DNS 服务介绍"></a>1.1 DNS 服务介绍</h3><p><strong><code>DNS</code></strong>（<code>Domain Name System</code>，域名系统），因特网上作为域名和 IP 地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的<code>IP</code>数串。通过主机名，最终得到该主机名对应的<code>IP</code>地址的过程叫做域名解析（或主机名解析）。</p>
<ul>
<li>DNS 协议运行在<code>UDP</code>和<code>TCP</code>之上，使用<code>53</code>号端口</li>
<li>其中在<code>DNS</code>解析查询时用到<code>UDP</code>协议，而在主从传递区域数据库文件时，用到<code>TCP</code>协议</li>
</ul>
<hr>
<h3 id="1-2-互联网域名结构"><a href="#1-2-互联网域名结构" class="headerlink" title="1.2 互联网域名结构"></a>1.2 互联网域名结构</h3><p><strong>一般结构</strong></p>
<ul>
<li><code>主机名.二级域名.顶级域名.根</code></li>
<li><code>www.wsescape.com.</code></li>
</ul>
<p><strong>管理方式</strong></p>
<ul>
<li><code>Internet</code> 的顶级域名由 <code>Internet</code> 网络协会域名注册查询负责网络地址分配的委员会进行登记和管理</li>
<li>它还为 <code>Internet</code> 的每一台主机分配唯一的 <code>IP</code> 地址</li>
</ul>
<p><img src="/images/linux-dns-server-1.png" alt="DNS域名解析服务配置"></p>
<hr>
<h3 id="1-3-DNS-的功能"><a href="#1-3-DNS-的功能" class="headerlink" title="1.3 DNS 的功能"></a>1.3 DNS 的功能</h3><blockquote>
<p>每个 IP 地址都可以有一个主机名，主机名由一个或多个字符串组成，字符串之间用小数点隔开。有了主机名，就不要死记硬背每台 IP 设备的 IP 地址，只要记住相对直观有意义的主机名就行了。</p>
</blockquote>
<p><strong>主机名到 IP 地址映射的两种方式</strong></p>
<ul>
<li><strong>静态映射</strong><ul>
<li><code>/etc/hosts</code>文件</li>
<li>在每台设备上都有主机到<code>IP</code>的映射关系，只供此设备使用</li>
</ul>
</li>
<li><strong>动态映射</strong><ul>
<li><code>/etc/resolv.conf</code>文件</li>
<li>指通过<code>DNS</code>服务器配置主机到<code>IP</code>的映射关系</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># cat /etc/hosts</span>
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

<span class="token comment" spellcheck="true"># cat /etc/resolv.conf</span>
nameserver 172.16.242.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>解析方式</strong> - <code>FQDN</code>(<code>Full Qualified Domain Name</code>)</p>
<ul>
<li>正向 ==&gt; <code>FQDN --&gt; IP</code></li>
<li>反向 ==&gt; <code>IP --&gt; FQDN</code></li>
<li>权威</li>
<li>非权威</li>
</ul>
<p><strong>解析顺序</strong></p>
<ul>
<li>在解析域名时，首先采用<code>静态域名解析</code>的方法，如果静态域名解析不成功，再采用<code>动态域名解析</code>的方法</li>
</ul>
<p><img src="/images/linux-dns-server-2.png" alt="DNS域名解析服务配置"></p>
<p><strong>一次完整的查询请求经过的流程</strong></p>
<p><img src="/images/linux-dns-server-3.png" alt="DNS域名解析服务配置"></p>
<hr>
<h3 id="1-4-技术实现"><a href="#1-4-技术实现" class="headerlink" title="1.4 技术实现"></a>1.4 技术实现</h3><p><strong><code>DNS</code></strong>通过允许一个名称服务器把他的一部分名称服务，众所周知的<code>zone</code>，委托给子服务器而实现了一种层次结构的名称空间，成为<strong>子域授权</strong>机制</p>
<ul>
<li><code>DNS</code>还提供了一些额外的信息，例如系统别名、联系信息以及哪一个主机正在充当系统组或域的邮件枢纽</li>
<li>任何一个使用<code>IP</code>的计算机网络可以使用<code>DNS</code>来实现他自己的<strong>私有名称系统</strong></li>
</ul>
<p><strong>实现 DNS 的软件</strong></p>
<ul>
<li><code>BIND</code></li>
<li><code>DJBDNS</code></li>
<li><code>MaraDNS</code></li>
<li><code>Name Server Daemon</code></li>
<li><code>PowerDNS</code></li>
<li><code>Dnsmasq</code></li>
</ul>
<p><strong>DNS 查询类型</strong></p>
<ul>
<li>迭代查询</li>
<li>递归查询</li>
</ul>
<p><img src="/images/linux-dns-server-4.png" alt="DNS域名解析服务配置"></p>
<p><img src="/images/linux-dns-server-5.png" alt="DNS域名解析服务配置"></p>
<hr>
<h3 id="1-5-DNS-的类型"><a href="#1-5-DNS-的类型" class="headerlink" title="1.5 DNS 的类型"></a>1.5 DNS 的类型</h3><p><strong>（1）<code>Primary DNS Server</code>(Master)</strong></p>
<ul>
<li>一个域的主服务器保存着该域的<code>zone</code>配置文件，该域所有的配置、更改都是在该服务器上进行，本篇随笔要讲解的也是如何配置一个域的主<code>DNS</code>服务器。</li>
</ul>
<p><strong>（2）<code>Secondary DNS Server</code>(Slave)</strong></p>
<ul>
<li>域从服务器一般都是作为冗余负载使用，一个域的从服务器是从该域的主服务器上抓取<code>zone</code>配置文件，从服务器不会进行任何信息的更改，<code>zone</code>配置文件的修改只能在主<code>DNS</code>服务器上进行，所有的修改都有主服务器同步。</li>
</ul>
<p><strong>（3）<code>Caching only Server</code>(Cache)</strong></p>
<ul>
<li><code>DNS</code>缓存服务器不存在任何的<code>zone</code>配置文件，仅仅依靠缓存来为客户端提供服务，通常用于负载均衡及加速访问操作。</li>
</ul>
<p><strong>（4）<code>转发服务器</code></strong></p>
<ul>
<li>只负责转发功能</li>
</ul>
<p><strong>注解说明</strong></p>
<ul>
<li><strong>主 DNS 服务器</strong><ul>
<li>维护所负责解析的区域内解析库服务器</li>
<li>解析库由管理维护，可以是手工也可以是自动的</li>
<li>通知机制</li>
<li>一旦主 DNS 服务器解析库发生改变会立即通知从服务器</li>
</ul>
</li>
<li><strong>从 DNS 服务器</strong><ul>
<li>从主<code>DNS</code>服务器或其他的从<code>DNS</code>服务器那里复制(<strong>区域传送</strong>)一份解析库</li>
<li><code>序列号</code><ul>
<li>来表示解析库的版本号</li>
<li>前提是，主服务器解析库内容发生改变，其序列递增</li>
</ul>
</li>
<li><code>刷新时间</code><ul>
<li>从服务器从主服务器请求同步解析库的时间间隔</li>
</ul>
</li>
<li><code>重试时间</code><ul>
<li>从服务器从服务器请求同步解析库失败的时候，再次尝试的时间间隔</li>
</ul>
</li>
<li><code>过期时长</code><ul>
<li>从服务器始终联系不到主服务器时，多久多后放弃从服务器角度，停止提供服务</li>
</ul>
</li>
</ul>
</li>
<li><strong>区域传送</strong></li>
<li><strong>全量传送</strong><ul>
<li>传送整个解析库</li>
</ul>
</li>
<li><strong>增量传送</strong><ul>
<li>传送解析库变化的那部分内容</li>
</ul>
</li>
</ul>
<hr>
<h3 id="1-6-资源记录类型"><a href="#1-6-资源记录类型" class="headerlink" title="1.6 资源记录类型"></a>1.6 资源记录类型</h3><p><strong>DNS 系统中，常见的资源记录类型：</strong></p>
<ul>
<li><strong>主机记录</strong>（<code>A</code>记录）<ul>
<li><code>FQDN --&gt; IP</code></li>
<li><code>A</code>记录是用于名称解析的重要记录，它将特定的主机名映射到对应主机的<code>IP</code>地址上</li>
</ul>
</li>
<li><strong>指针记录</strong>（<code>PTR</code>记录）<ul>
<li><code>IP --&gt; FQDN</code></li>
<li>引导至一个规范名称（<code>Canonical Name</code>），最常用来运行反向<code>DNS</code>查找</li>
</ul>
</li>
<li><strong>权威记录的起始</strong>（<code>SOA</code>记录）<ul>
<li>一个区域解析库有且仅能有一个<code>SOA</code>记录，而必须为解析库的第一条记录</li>
</ul>
</li>
<li><strong>名称服务器记录</strong>（<code>NS</code>记录）<ul>
<li>专用于标明当前区域的<code>DNS</code>服务器</li>
</ul>
</li>
<li><strong>别名记录</strong>（<code>CNAME</code>记录）<ul>
<li><code>CNAME</code>记录用于将某个别名指向到某个<code>A</code>记录上，这样就不需要再为某个新名字另外创建一条新的<code>A</code>记录</li>
</ul>
</li>
<li><strong>MX 记录</strong>（<code>MX</code>记录）<ul>
<li>引导域名到该域名的邮件传输代理（<code>Message Transfer Agents</code>）列表</li>
</ul>
</li>
<li><strong>IPv6 主机记录</strong>（<code>AAAA</code>记录）<ul>
<li><code>FQDN --&gt; IP</code></li>
<li>与 A 记录对应，用于将特定的主机名映射到一个主机的<code>IPv6</code>地址。</li>
</ul>
</li>
<li><strong>服务位置记录</strong>（<code>SRV</code>记录）<ul>
<li>用于定义提供特定服务的服务器的位置，如主机<code>hostname</code>，端口<code>port</code></li>
</ul>
</li>
<li><strong>NAPTR 记录</strong><ul>
<li>它提供了正则表达式方式去映射一个域名。<code>NAPTR</code>记录非常著名的一个应用是用于<code>ENUM</code>查询。</li>
</ul>
</li>
</ul>
<p><img src="/images/linux-dns-server-6.png" alt="DNS域名解析服务配置"></p>
<hr>
<h3 id="1-7-资源记录格式"><a href="#1-7-资源记录格式" class="headerlink" title="1.7 资源记录格式"></a>1.7 资源记录格式</h3><p><strong>语法</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">name <span class="token punctuation">[</span>TTL<span class="token punctuation">]</span> IN rr_type value<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>(1) <code>TTL</code>如果从全局继承可以省略，为缓存时长</li>
<li>(2)<code>IN</code>表示<code>Internet</code></li>
<li>(3)<code>rr_type</code>表示资源记录类型</li>
<li>(4) <code>@</code>可用于引用当前区域的名字</li>
<li>(5) 同一个名字可以通过多条记录定义多个不同的值，此时<code>DNS</code>服务器会以<code>轮询</code>方式响应</li>
<li>(6) 同一个值也可能有多个不同的定义名字，通过多个不同的名字指向同一个值进行定义，此仅表示通过多个不同的名字可以找到同一个主机而已</li>
</ul>
<p><strong>SOA</strong></p>
<ul>
<li><code>name</code>: 当前区域的名字，例如<code>wsescape.com.</code></li>
<li><code>value</code>: 有多部分组成<ul>
<li>(1) 当前区域的主<code>DNS</code>服务器的<code>FQDN</code>，也可以使用当前区域的名字</li>
<li>(2) 当前区域管理员的邮箱地址，但地址中不能使用<code>@</code>符号，一般用<code>.</code>替换，例如<code>linuxmail.wsescape.com</code></li>
<li>(3) 主从服务协调属性的定义以及否定的答案的统一的<code>TTL</code></li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 86400为TTL值，单位为秒钟</span>
<span class="token comment" spellcheck="true"># 主DNS服务器地址为ns.wsescape.com.</span>
<span class="token comment" spellcheck="true"># 邮箱地址为nsadmin.wsescape.com.</span>
<span class="token comment" spellcheck="true"># 第一版为2016052201，标识版本号</span>
wsescape.com.86400INSOAns.nsadmin.wsescape.com.<span class="token punctuation">(</span>
2016052201  <span class="token punctuation">;</span>序列号
2H          <span class="token punctuation">;</span>刷新时间，2小时
10M<span class="token punctuation">;</span>重试时间，10分钟
1W<span class="token punctuation">;</span>过期时间，一周
1D<span class="token punctuation">;</span>否定答案的TTL值，一天
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>NS</strong></p>
<ul>
<li><code>name</code>: 当前区域的名字</li>
<li><code>value</code>: 当前区域的某<code>DNS</code>服务器的名字，例如<code>ns.wsescape.com.</code></li>
<li><code>注意</code><ul>
<li>(1) 相邻的两个资源记录的<code>name</code>相同时，后续的可省略</li>
<li>(2) 对<code>NS</code>记录而言，任何一个<code>NS</code>记录后面的服务器名字，都应该在后续有一个<code>A</code>记录</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 一个区域可以有多个NS记录</span>
<span class="token comment" spellcheck="true"># ns1.wsescape.com.和ns2.wsescape.com.都应该在后续有一个A记录</span>
wsescape.com.INNS  ns1.wsescape.com.
wsescape.com.INNS  ns2.wsescape.com.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>MX</strong></p>
<ul>
<li><code>name</code>: 当前区域的名字</li>
<li><code>value</code>: 当前区域的某邮件服务器(<code>smtp</code>服务器)的主机名<ul>
<li>一个区域内，<code>MX</code>记录可以有多个</li>
<li>但每个记录的<code>value</code>之前应该有一个数字(<code>0-99</code>)，表示此服务器的优先级</li>
<li>数字越小优先级越高</li>
</ul>
</li>
<li><code>注意</code><ul>
<li>(1) 相邻的两个资源记录的<code>name</code>相同时，后续的可省略</li>
<li>(2) 对<code>MX</code>记录而言，任何一个<code>MX</code>记录后面的服务器名字，都应该在后续有一个<code>A</code>记录</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># mx1.wsescape.com.和mx2.wsescape.com.都应该在后续有一个A记录</span>
wsescape.com.IN  MX  10  mx1.wsescape.com.
INMX  20  mx2.wsescape.com.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>A</strong></p>
<ul>
<li><code>name</code>: 某主机的<code>FQDN</code>，例如<code>www.wsescape.com.</code></li>
<li><code>value</code>: 主机名对应主机的 IP 地址；</li>
<li><code>注意</code><ul>
<li>避免用户写错名称时给错误答案，可通过泛域名解析进行解析至某特定地址</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 轮询</span>
www.wsescape.com.IN  A1.1.1.1
www.wsescape.com.IN  A  1.1.1.2

<span class="token comment" spellcheck="true"># 一个主机有多个名称而已</span>
mx1.wsescape.com.IN    A   1.1.1.3
mx2.wsescape.com.  IN  A   1.1.1.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 避免用户写错名称时给错误答案，可通过泛域名解析进行解析至某特定地址</span>
*.wsescape.com.IN  A  1.1.1.4
wsescape.com.IN  A   1.1.1.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>AAAA</strong></p>
<ul>
<li>与<code>A</code>记录类似，这是只是表示<code>IPv6</code>地址而已</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 轮询</span>
www.wsescape.com.IN  AAAA1.1.1.1
www.wsescape.com.IN  AAAA  1.1.1.2

<span class="token comment" spellcheck="true"># 一个主机有多个名称而已</span>
mx1.wsescape.com.IN    AAAA   1.1.1.3
mx2.wsescape.com.  IN  AAAA   1.1.1.3

<span class="token comment" spellcheck="true"># 避免用户写错名称时给错误答案，可通过泛域名解析进行解析至某特定地址</span>
*.wsescape.com.IN  AAAA  1.1.1.4
wsescape.com.IN  AAAA   1.1.1.4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>PTR</strong></p>
<ul>
<li><code>name</code>: 这里的<code>name</code>表示的是<code>IP</code>地址</li>
<li><code>IP</code>地址有特定格式，把<code>IP</code>地址反过来写，如果是<code>1.2.3.4</code>需要写作<code>4.3.2.1</code></li>
<li>还有特定后缀<code>in-addr.arpa.</code>，完整写法为<code>4.3.2.1.in-addra.arpa.</code></li>
<li><code>value</code>: 这里的<code>value</code>值为<code>FQDN</code></li>
<li><code>注意</code><ul>
<li>网络地址及后缀可省略，主机地址依然需要反着写</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 实例</span>
4.3.2.1.in-addr.arpa.INPTRwww.wsescape.com.

<span class="token comment" spellcheck="true"># 如果3.2.1是网络地址简写成为</span>
4   IN  PTRwww.wsescape.com.

<span class="token comment" spellcheck="true"># 如果2.1是网络地址简写成为</span>
4.3  IN  PTRwww.wsescape.com.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>CNAME</strong></p>
<ul>
<li><code>name</code>: 别名的<code>FQDN</code></li>
<li><code>value</code>: 正工名字的<code>FQDN</code></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">web.escapelife.com.IN  CNAME  www.escapelife.com.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<hr>
<h3 id="1-8-个人使用"><a href="#1-8-个人使用" class="headerlink" title="1.8 个人使用"></a>1.8 个人使用</h3><blockquote>
<p>子域授权就是每个域的名称服务器，都是通过其上级名称服务器在解析库进行授权</p>
</blockquote>
<p><strong>类似根域授权<code>tld</code></strong></p>
<pre class="line-numbers language-bash"><code class="language-bash">.com.INNS     ns1.com.
.com.   IN    NSns2.com.
ns1.com.INA   2.2.2.1
ns2.com.      INA2.2.2.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>这里以<code>wsescape.com</code>为例</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># wsescape.com. 在.com的名称服务器上，解析库中添加资源记录</span>
wsescape.com.INNSns1.wsescape.com.
wsescape.com.INNSns2.wsescape.com.
wsescape.com.INNSns3.wsescape.com.
ns1.wsescape.com.INA  3.3.3.1
ns2.wsescape.com.INA  3.3.3.2
ns3.wsescape.com.INA  3.3.3.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>域名注册</strong></p>
<ul>
<li>代理商</li>
<li>万网</li>
<li>新网</li>
<li><code>godaddy</code></li>
</ul>
<p><strong>绑定服务器</strong></p>
<ul>
<li>注册完成以后，想自己用专用服务来解析？</li>
<li>管理后台，把 NS 记录指向的服务器名称和 A 记录指向的服务器地址</li>
</ul>
<hr>
<h2 id="2-常用命令"><a href="#2-常用命令" class="headerlink" title="2. 常用命令"></a>2. 常用命令</h2><h3 id="2-1-dig命令"><a href="#2-1-dig命令" class="headerlink" title="2.1 dig命令"></a>2.1 <code>dig</code>命令</h3><p><strong><code>dig</code></strong>用于测试<code>dns</code>系统，因此不会查询<code>hosts</code>文件进行解析</p>
<ul>
<li>用于询问  <code>DNS</code>  域名服务器的灵活的工具</li>
<li>除非被告知请求特定域名服务器，<code>dig</code>将尝试  <code>/etc/resolv.conf</code>中列举的任何服务器</li>
<li>当未指定任何命令行参数或选项时，<code>dig</code>将对<code>.</code>（根）执行<code>NS</code>查询</li>
</ul>
<p><strong>格式</strong></p>
<ul>
<li><code>dig [-t type] name [@SERVER] [query options]</code></li>
</ul>
<p><strong>语法</strong></p>
<ul>
<li>类型查询<ul>
<li><code>dig -t NS wsescape.com @172.16.242.178</code></li>
<li><code>dig -t MX wsescape.com @172.16.242.178</code></li>
<li><code>dig -t A www.baidu.com</code></li>
</ul>
</li>
<li>查询选项：<ul>
<li><code>+[no]trace</code>：跟踪解析过程</li>
<li><code>+[no]recurse</code>：进行递归解析</li>
<li>测试反向解析：</li>
<li><code>dig -x IP @SERVER</code></li>
<li><code>dig -x 172.16.100.11 @172.16.242.178</code></li>
</ul>
</li>
<li>模拟区域传送：<ul>
<li><code>dig -t axfr ZONE_NAME @SERVER</code></li>
<li><code>dig -t axfr wsescape.com @172.16.242.178</code></li>
</ul>
</li>
</ul>
<hr>
<h3 id="2-2-host命令"><a href="#2-2-host命令" class="headerlink" title="2.2 host命令"></a>2.2 <code>host</code>命令</h3><p><strong><code>host</code></strong>命令用于查询<code>DNS</code>的工具</p>
<ul>
<li>它通过常转换指定主机名称的主机名称为 IP 地址</li>
<li>当不指定参数时，它显示<code>host</code>命令的帮助信息</li>
</ul>
<p><strong>格式</strong></p>
<ul>
<li><code>host [-t type] name [SERVER]</code></li>
</ul>
<p><strong>语法</strong></p>
<ul>
<li><code>-a</code><ul>
<li>等同于<code>-v -t</code></li>
</ul>
</li>
<li><code>-C</code><ul>
<li>在需要认证的域名服务器上查找 SOA 记录</li>
</ul>
</li>
<li><code>-l</code><ul>
<li>列出一个域内所有的主机</li>
</ul>
</li>
<li><code>-i</code><ul>
<li>反向查找</li>
</ul>
</li>
<li><code>-r</code><ul>
<li>不使用递归处理</li>
</ul>
</li>
<li><code>-v</code><ul>
<li>运行时显示详细的处理信息</li>
</ul>
</li>
<li><code>-4</code><ul>
<li>用于 IPv4 的查询</li>
</ul>
</li>
<li><code>-6</code><ul>
<li>用于 IPv6 的查询</li>
</ul>
</li>
<li><code>-t &lt;类型&gt;</code><ul>
<li>指定类型，包括<code>a</code>、<code>all</code>、<code>mx</code>、<code>ns</code>等</li>
</ul>
</li>
</ul>
<p><strong>实例展示</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># host -t A www.wsescape.com 172.16.242.178</span>
Using domain server:
Name: 172.16.242.178
Address: 172.16.242.178<span class="token comment" spellcheck="true">#53</span>
Aliases:
www.wsescape.com has address 172.16.100.11
www.wsescape.com has address 172.16.100.12

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># host -t A www.wsescape.com 172.16.242.178</span>
Using domain server:
Name: 172.16.242.178
Address: 172.16.242.178<span class="token comment" spellcheck="true">#53</span>
Aliases:
www.wsescape.com has address 172.16.100.12
www.wsescape.com has address 172.16.100.11<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># host --help</span>
host: illegal option -- -
Usage: host <span class="token punctuation">[</span>-aCdlriTwv<span class="token punctuation">]</span> <span class="token punctuation">[</span>-c class<span class="token punctuation">]</span> <span class="token punctuation">[</span>-N ndots<span class="token punctuation">]</span> <span class="token punctuation">[</span>-t type<span class="token punctuation">]</span> <span class="token punctuation">[</span>-W time<span class="token punctuation">]</span>
            <span class="token punctuation">[</span>-R number<span class="token punctuation">]</span> <span class="token punctuation">[</span>-m flag<span class="token punctuation">]</span> <span class="token function">hostname</span> <span class="token punctuation">[</span>server<span class="token punctuation">]</span>
       -a is equivalent to -v -t ANY
       -c specifies query class <span class="token keyword">for</span> non-IN data
       -C compares SOA records on authoritative nameservers
       -d is equivalent to -v
       -l lists all hosts <span class="token keyword">in</span> a domain, using AXFR
       -i IP6.INT reverse lookups
       -N changes the number of dots allowed before root lookup is <span class="token keyword">done</span>
       -r disables recursive processing
       -R specifies number of retries <span class="token keyword">for</span> UDP packets
       -s a SERVFAIL response should stop query
       -t specifies the query <span class="token function">type</span>
       -T enables TCP/IP mode
       -v enables verbose output
       -w specifies to <span class="token function">wait</span> forever <span class="token keyword">for</span> a reply
       -W specifies how long to <span class="token function">wait</span> <span class="token keyword">for</span> a reply
       -4 use IPv4 query transport only
       -6 use IPv6 query transport only
       -m <span class="token keyword">set</span> memory debugging flag <span class="token punctuation">(</span>trace<span class="token operator">|</span>record<span class="token operator">|</span>usage<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="2-3-nslookup命令"><a href="#2-3-nslookup命令" class="headerlink" title="2.3 nslookup命令"></a>2.3 <code>nslookup</code>命令</h3><blockquote>
<p><code>nslookup</code>  命令用于查找域名服务器的程序，有两种模式为互交和非互交</p>
</blockquote>
<p><strong>格式</strong></p>
<ul>
<li><code>nslookup [-option] [name | -] [server]</code></li>
</ul>
<p><strong>语法</strong></p>
<ul>
<li>非交互模式</li>
<li>直接查询即可</li>
<li>交互式模式</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">nslookup<span class="token operator">></span>
server IP: 指明使用哪个DNS server进行查询；
<span class="token keyword">set</span> q<span class="token operator">=</span>RR_TYPE: 指明查询的资源记录类型；
NAME: 要查询的名称；<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>实例展示</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nslookup</span>
<span class="token operator">></span> server 172.16.242.178
Default server: 172.16.242.178
Address: 172.16.242.178<span class="token comment" spellcheck="true">#53</span>
<span class="token operator">></span> <span class="token keyword">set</span> q<span class="token operator">=</span>A
<span class="token operator">></span> www.wsescape.com
Server:172.16.242.178
Address:172.16.242.178<span class="token comment" spellcheck="true">#53</span>

Name:www.wsescape.com
Address: 172.16.100.11
Name:www.wsescape.com
Address: 172.16.100.12
<span class="token operator">></span> <span class="token keyword">set</span> q<span class="token operator">=</span>NS
<span class="token operator">></span> wsescape.com
Server:172.16.242.178
Address:172.16.242.178<span class="token comment" spellcheck="true">#53</span>

wsescape.comnameserver <span class="token operator">=</span> ns2.wsescape.com.
wsescape.comnameserver <span class="token operator">=</span> ns1.wsescape.com.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 非交互模式查询</span>
<span class="token punctuation">[</span>root@rudder ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nslookup baidu.com</span>
Server:         8.8.8.8
Address:        8.8.8.8<span class="token comment" spellcheck="true">#53</span>

Non-authoritative answer:
Name:   baidu.com
Address: 123.125.114.144
Name:   baidu.com
Address: 220.181.111.85
Name:   baidu.com
Address: 220.181.111.86<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 非交互模式查询</span>
<span class="token punctuation">[</span>root@rudder ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># nslookup</span>
<span class="token operator">></span> www.baidu.com
Server:172.17.0.254
Address:172.17.0.254<span class="token comment" spellcheck="true">#53</span>

Non-authoritative answer:     <span class="token comment" spellcheck="true">#非权威答案，表明是在缓存中读取的</span>
www.baidu.comcanonical name <span class="token operator">=</span> www.a.shifen.com.
Name:www.a.shifen.com
Address: 61.135.169.105       <span class="token comment" spellcheck="true">#返回第一个IP地址</span>
Name:www.a.shifen.com
Address: 61.135.169.125       <span class="token comment" spellcheck="true">#返回第二个IP地址</span>
<span class="token operator">></span> server 8.8.8.8              <span class="token comment" spellcheck="true">#设置域名服务器为 8.8.8.8</span>
Default server: 8.8.8.8
Address: 8.8.8.8<span class="token comment" spellcheck="true">#53</span>
<span class="token operator">></span> www.baidu.com               <span class="token comment" spellcheck="true">#再次请求百度的IP地址</span>
Server:8.8.8.8
Address:8.8.8.8<span class="token comment" spellcheck="true">#53</span>

Non-authoritative answer:
www.baidu.comcanonical name <span class="token operator">=</span> www.a.shifen.com.
Name:www.a.shifen.com
Address: 220.181.111.147      <span class="token comment" spellcheck="true">#不同的DNS获取的IP地址是不同的。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="2-4-rndc命令"><a href="#2-4-rndc命令" class="headerlink" title="2.4 rndc命令"></a>2.4 <code>rndc</code>命令</h3><blockquote>
<p><strong><code>rndc</code></strong>客户端是通过建立套接字连接服务端，监听在<code>TCP</code>的<code>953</code>端口，来对服务端的<code>named</code>进行修改操作，但由于安全考虑，所以<code>rndc</code>的客户端和服务端安装在同一台主机之上。</p>
</blockquote>
<p><strong>语法 1</strong></p>
<ul>
<li><code>-b</code><ul>
<li><code>source-address</code>  使用  <code>source-address</code>  作为连接服务器的源地址允许多个实例设置  <code>IPv4</code>  和  <code>IPv6</code>  源地址</li>
</ul>
</li>
<li><code>-c config-file</code><ul>
<li>使用<code>config-file</code>  作为缺省的配置文件<code>/etc/rndc.conf</code>  的替代</li>
</ul>
</li>
<li><code>-k key-file</code><ul>
<li>使用  <code>key-file</code>  作为缺省的密钥文件<code>/etc/rndc.key</code>  的替代</li>
<li>如果<code>config-file</code>  不存在，<code>/etc/rndc.key</code>  中的密钥将用于认证发向服务器的命令</li>
</ul>
</li>
<li><code>-s server server</code><ul>
<li>是与<code>rndc</code>的配置文件中<code>server</code>语句匹配的服务器的名字或地址</li>
<li>如果命令行没有提供服务器，会使用<code>rndc</code>配置文件中<code>options</code>语句中的<code>default-server</code>子句所命名的主机</li>
</ul>
</li>
<li><code>-p port</code><ul>
<li>发送命令到<code>TCP</code>端口<code>port</code>，以取代<code>BIND 9</code>的缺省控制通道端口  <code>953</code></li>
</ul>
</li>
<li><code>-V</code><ul>
<li>打开冗余日志</li>
</ul>
</li>
<li><code>-y key_id</code><ul>
<li>使用配置文件中的密钥<code>key_id</code></li>
</ul>
</li>
</ul>
<p><strong>语法 2</strong></p>
<ul>
<li><code>reload</code><ul>
<li>重载主配置文件和区域解析库文件</li>
</ul>
</li>
<li><code>reload zone</code><ul>
<li>重重载区域解析库文件</li>
</ul>
</li>
<li><code>refresh zone</code><ul>
<li>安排区域的立即维护</li>
</ul>
</li>
<li><code>retransfer zone</code><ul>
<li>手动启动区域传送过程，而不管序列号是否增加</li>
</ul>
</li>
<li><code>notify zone</code><ul>
<li>重新对区域传送发通知</li>
</ul>
</li>
<li><code>reconfig</code><ul>
<li>重载主配置文件</li>
</ul>
</li>
<li><code>status</code><ul>
<li>将服务器统计信息写入统计文件中</li>
</ul>
</li>
<li><code>querylog</code><ul>
<li>开启或关闭查询日志</li>
<li>建议调试的时候开启，否则日志消耗太多性能</li>
</ul>
</li>
<li><code>dumpdb</code><ul>
<li>将高速缓存转储到转储文件 (<code>named_dump.db</code>)</li>
</ul>
</li>
<li><code>stop</code><ul>
<li>将暂挂更新保存到主文件并停止服务器</li>
</ul>
</li>
<li><code>halt</code><ul>
<li>停止服务器，但不保存暂挂更新</li>
</ul>
</li>
<li><code>trace</code><br>将调试级别增加一级<ul>
<li>建议调试的时候开启，否则日志消耗太多性能</li>
</ul>
</li>
<li><code>trace level</code><ul>
<li>更改调试级别</li>
</ul>
</li>
<li><code>notrace</code><ul>
<li>将调试级别设置为<code>0</code></li>
</ul>
</li>
<li><code>flush</code><ul>
<li>刷新服务器的所有高速缓存</li>
</ul>
</li>
<li><code>status</code><ul>
<li>显示服务器的状态</li>
</ul>
</li>
<li><code>restart</code><ul>
<li>重新启动服务器</li>
</ul>
</li>
</ul>
<p><strong>实例展示</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># rndc工具能够帮助我们输出系统信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc status</span>
version: 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6
CPUs found: 1
worker threads: 1
number of zones: 20
debug level: 0
xfers running: 0
xfers deferred: 0
soa queries <span class="token keyword">in</span> progress: 0
query logging is OFF
recursive clients: 0/0/1000
tcp clients: 0/100
server is up and running

<span class="token comment" spellcheck="true"># rndc不重启加载区域文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="3-BIND的安装配置"><a href="#3-BIND的安装配置" class="headerlink" title="3. BIND的安装配置"></a>3. <code>BIND</code>的安装配置</h2><blockquote>
<p><strong>DNS</strong>服务，程序包名<code>bind</code>，程序名<code>named</code>。</p>
</blockquote>
<h3 id="3-1-程序包"><a href="#3-1-程序包" class="headerlink" title="3.1 程序包"></a>3.1 程序包</h3><p>只需要安装<code>bind</code>、<code>bind-libs</code>和<code>bind-utils</code>即可</p>
<ul>
<li><code>bind</code><ul>
<li>主包</li>
</ul>
</li>
<li><code>bind-libs</code><ul>
<li>依赖的库文件，包括 32 位和 64 位</li>
</ul>
</li>
<li><code>bind-utils</code><ul>
<li>提供客户端工具，例如<code>dig</code>、<code>host</code>、<code>nslookup</code>和<code>nsupdate</code></li>
</ul>
</li>
<li><code>bind-chroot</code><ul>
<li>建立不要安装，很容易被入侵</li>
</ul>
</li>
<li><code>bind-chroot</code>包的作用是提高安全性，将 DNS 服务的配置文件<code>/etc/named.conf</code>  等，创建一个硬链接转到<code>/var/named/chroot/etc/</code>  文件夹下面，而且使用服务帐号登录，不使用<code>root</code>用户登录</li>
<li>注意，修改配置文件要修改<code>/etc/</code>下面的，这样会自动同步到<code>chroot</code>下面的链接文件中<ul>
<li><code>bind-sdb</code></li>
<li><code>bind-dyndb-ldap</code></li>
<li>以上这两种方式，是将解析库文件放在不同的数据库中进行存储</li>
</ul>
</li>
</ul>
<hr>
<h3 id="3-2-BIND配置文件"><a href="#3-2-BIND配置文件" class="headerlink" title="3.2 BIND配置文件"></a>3.2 <code>BIND</code>配置文件</h3><p><strong>配置文件</strong></p>
<ul>
<li><strong>服务启动脚本</strong><ul>
<li>在<code>CentOS6</code>下</li>
<li><code>/etc/rc.d/init.d/named</code></li>
</ul>
</li>
<li><strong>主配置文件</strong><ul>
<li><code>/etc/named.conf</code></li>
<li><code>/etc/rndc.key</code></li>
<li>为<code>rndc</code>的秘钥共享文件，提供认证用的</li>
</ul>
</li>
<li><code>rndc</code>是什么？<ul>
<li>远程名称控制器</li>
<li>默认与<code>bind</code>安装在同一主机，且只能通过本地回环地址<code>127.0.0.1</code>来连接<code>named</code>进程</li>
<li>提供辅助性的管理功能，如查看解析状态等</li>
<li>默认工作在 953/tcp 端口上</li>
<li><code>/etc/named.rfc1912.zones</code></li>
<li>请求注解文档</li>
</ul>
</li>
<li><strong>解析库文件</strong><ul>
<li><code>/var/named/ZONE_NAME.ZONE</code></li>
<li>在<code>/var/named/</code>目录下存在多个解析库文件<ul>
<li><code>/var/named/named.ca</code></li>
</ul>
</li>
<li>指向根<code>DNS</code>该文件不需要管理员更改，而是系统自带<ul>
<li><code>/var/named/named.local</code></li>
</ul>
</li>
<li>本地子域解析，将<code>localhost</code>反向解析为<code>127.0.0.1</code></li>
</ul>
</li>
<li><strong>注意</strong><ul>
<li>(1) 一台物理服务器可同时为多个区域提供解析</li>
<li>(2) 必须要有根区域文件，在<code>named.ca</code>中包含<code>13</code>根节点地址，由<code>dig</code>命令生成而来的</li>
<li>(3) 应该有两个(如果包括<code>ipv6</code>的，应该更多)实现<code>localhost</code>和<code>本地回环地址</code>的解析库</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#  在CentOS6下</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rpm -ql bind | less</span>
/etc/NetworkManager/dispatcher.d/13-named
/etc/logrotate.d/named
/etc/named
/etc/named.conf
/etc/named.iscdlv.key
/etc/named.rfc1912.zones
/etc/named.root.key
/etc/portreserve/named
/etc/rc.d/init.d/named
/etc/rndc.conf
/etc/rndc.key
/etc/sysconfig/named
/usr/lib64/bind
/usr/sbin/arpaname
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># @表示当前区域的区域名称，在主配置文件/etc/named.conf中定义的</span>
<span class="token comment" spellcheck="true"># TTL的值没写，因为定义了宏$TTL 1D，直接继承</span>
<span class="token comment" spellcheck="true"># rname.invalid.表示管理员的邮箱地址</span>
<span class="token comment" spellcheck="true"># 后面的如NS、A等缺省，因为继承前者的</span>

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat /var/named/named.localhost</span>
<span class="token variable">$TTL</span> 1D
@IN SOA@ rname.invalid. <span class="token punctuation">(</span>
0<span class="token punctuation">;</span> serial
1D<span class="token punctuation">;</span> refresh
1H<span class="token punctuation">;</span> retry
1W<span class="token punctuation">;</span> expire
3H <span class="token punctuation">)</span><span class="token punctuation">;</span> minimum
NS@
A127.0.0.1
AAAA::1

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat /var/named/named.loopback</span>
<span class="token variable">$TTL</span> 1D
@IN SOA@ rname.invalid. <span class="token punctuation">(</span>
0<span class="token punctuation">;</span> serial
1D<span class="token punctuation">;</span> refresh
1H<span class="token punctuation">;</span> retry
1W<span class="token punctuation">;</span> expire
3H <span class="token punctuation">)</span><span class="token punctuation">;</span> minimum
NS@
A127.0.0.1
AAAA::1
PTRlocalhost.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>主配置文件</strong></p>
<ul>
<li><strong>全局配置</strong><ul>
<li><code>options {}</code></li>
</ul>
</li>
<li><strong>日志子系统配置</strong><ul>
<li><code>logging {}</code></li>
</ul>
</li>
<li><strong>区域定义</strong><ul>
<li>本机能够为哪些<code>zone</code>进行解析，就要定义哪些<code>zone</code></li>
<li>如<code>zone "ZONE_NAME" IN {}</code></li>
</ul>
</li>
<li><strong>注意</strong><ul>
<li>任何服务程序如果期望其能够通过网络被其它主机访问，至少应该监听在一个能与外部主机通信的<code>IP</code>地址上</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat /etc/named.conf</span>
options <span class="token punctuation">{</span>
listen-on port 53 <span class="token punctuation">{</span> 127.0.0.1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
listen-on-v6 port 53 <span class="token punctuation">{</span> ::1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
directory<span class="token string">"/var/named"</span><span class="token punctuation">;</span>
dump-file<span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>
        statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>
        memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>
allow-query     <span class="token punctuation">{</span> localhost<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
recursion <span class="token function">yes</span><span class="token punctuation">;</span>

dnssec-enable <span class="token function">yes</span><span class="token punctuation">;</span>
dnssec-validation <span class="token function">yes</span><span class="token punctuation">;</span>
dnssec-lookaside auto<span class="token punctuation">;</span>

/* Path to ISC DLV key */
bindkeys-file <span class="token string">"/etc/named.iscdlv.key"</span><span class="token punctuation">;</span>

managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

logging <span class="token punctuation">{</span>
        channel default_debug <span class="token punctuation">{</span>
                <span class="token function">file</span> <span class="token string">"data/named.run"</span><span class="token punctuation">;</span>
                severity dynamic<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone <span class="token string">"."</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> hint<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

include <span class="token string">"/etc/named.rfc1912.zones"</span><span class="token punctuation">;</span>
include <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># localhost.localdomain就是区域名称，也就是@</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cat /etc/named.rfc1912.zones</span>
zone <span class="token string">"localhost.localdomain"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.localhost"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone <span class="token string">"localhost"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.localhost"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone <span class="token string">"1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.loopback"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone <span class="token string">"1.0.0.127.in-addr.arpa"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.loopback"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone <span class="token string">"0.in-addr.arpa"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.empty"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="3-3-缓存名称服务器配置"><a href="#3-3-缓存名称服务器配置" class="headerlink" title="3.3 缓存名称服务器配置"></a>3.3 缓存名称服务器配置</h3><p><strong>安装上安装上<code>bind</code>之后，其实就算的上是一个缓存名称服务器，只需要进行少许的配置即可完成</strong></p>
<ul>
<li>修改<code>listen-on port 53</code></li>
<li>修改<code>allow-query</code></li>
<li>修改<code>recursion</code></li>
</ul>
<p><strong>（1）安装</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#yum install bind</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>（2）启动</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named start</span>
Generating /etc/rndc.key:                                  <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
Starting named:                                            <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>（3）查看</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 为了安全，安装上bind之后，默认只会监听本地，不对外提供服务</span>
<span class="token comment" spellcheck="true"># 任何服务程序如果期望其能够通过网络被其它主机访问，至少应该监听在一个能与外部主机通信的`IP`地址上</span>
<span class="token comment" spellcheck="true"># 编辑主配置文件即可</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ss -tunlp | grep :53</span>
udp    UNCONN     0      0              127.0.0.1:53                    *:*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,39822,512<span class="token punctuation">))</span>
udp    UNCONN     0      0                    ::1:53                   :::*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,39822,513<span class="token punctuation">))</span>
tcp    LISTEN     0      3                    ::1:53                   :::*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,39822,21<span class="token punctuation">))</span>
tcp    LISTEN     0      3              127.0.0.1:53                    *:*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,39822,20<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>（4）修改</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 修改之前先备份一下</span>
<span class="token comment" spellcheck="true"># 逗号之前没有内容，默认为前一个的名称，后面为复制的内容</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp /etc/named.conf{,.bak}</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll /etc/named*</span>
-rw-r-----. 1 root named  984 11月 20 2015 /etc/named.conf
-rw-r-----. 1 root root   984 6月  20 21:53 /etc/named.conf.bak<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># //表示单行注释，注释ipv6</span>
<span class="token comment" spellcheck="true"># /**/表示多行注释</span>
<span class="token comment" spellcheck="true"># 修改的时候必须以;结尾且{}的两端必须有空格，否则为语法错误</span>
<span class="token comment" spellcheck="true"># directory用来定义区域解析库文件存放位置</span>

<span class="token comment" spellcheck="true"># 建议关闭dnssec功能</span>
<span class="token comment" spellcheck="true"># 将dnssec-enable和dnssec-validation改为no，并注释key文件即可</span>

<span class="token comment" spellcheck="true"># 把能够以外网进行通信的地址写在listen-on port 53之后，如果有多个可以多个添加，不能省略</span>
<span class="token comment" spellcheck="true"># 如果将listen-on port 53进行注释或者删除，默认是监听在所有</span>
<span class="token comment" spellcheck="true"># 将allow-query注释或改为allow-query { any; };</span>
<span class="token comment" spellcheck="true"># 是否允许递归recursion，必须为yes</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span>
options <span class="token punctuation">{</span>
        listen-on port 53 <span class="token punctuation">{</span> 172.16.242.178<span class="token punctuation">;</span> 127.0.0.1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        listen-on-v6 port 53 <span class="token punctuation">{</span> ::1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        directory       <span class="token string">"/var/named"</span><span class="token punctuation">;</span>
        dump-file       <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>
        statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>
        memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>
//      allow-query     <span class="token punctuation">{</span> localhost<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        recursion <span class="token function">yes</span><span class="token punctuation">;</span>
        dnssec-enable no<span class="token punctuation">;</span>
        dnssec-validation no<span class="token punctuation">;</span>
        /* Path to ISC DLV key */
//      bindkeys-file <span class="token string">"/etc/named.iscdlv.key"</span><span class="token punctuation">;</span>
//      managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>（5）重启生效</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 重启之后才能生效配置</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named restart</span>
Stopping named: <span class="token keyword">.</span>                                          <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
Starting named:                                            <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ss -tunlp | grep :53</span>
udp    UNCONN     0      0         172.16.242.178:53                    *:*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,40086,513<span class="token punctuation">))</span>
udp    UNCONN     0      0              127.0.0.1:53                    *:*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,40086,512<span class="token punctuation">))</span>
udp    UNCONN     0      0                    ::1:53                   :::*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,40086,514<span class="token punctuation">))</span>
tcp    LISTEN     0      3                    ::1:53                   :::*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,40086,22<span class="token punctuation">))</span>
tcp    LISTEN     0      3         172.16.242.178:53                    *:*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,40086,21<span class="token punctuation">))</span>
tcp    LISTEN     0      3              127.0.0.1:53                    *:*      users:<span class="token punctuation">((</span><span class="token string">"named"</span>,40086,20<span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="3-4-主-DNS-名称服务器配置"><a href="#3-4-主-DNS-名称服务器配置" class="headerlink" title="3.4 主 DNS 名称服务器配置"></a>3.4 主 DNS 名称服务器配置</h3><blockquote>
<p><strong>主 DNS 名称服务器配置就是在缓存<code>DNS</code>服务器的基础之上增加<code>zone</code>配置文件就可以了</strong></p>
<ul>
<li>在<code>/etc/named.rfc1912.zones</code>添加<code>zone</code>记录</li>
<li>在<code>/var/named/</code>增加<code>zone</code>文件</li>
</ul>
</blockquote>
<p><strong>(1) 在主配置文件中定义区域</strong></p>
<ul>
<li><strong>格式</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># master表示主DNS</span>
<span class="token comment" spellcheck="true"># slave表示从DNS</span>
<span class="token comment" spellcheck="true"># hint表示根</span>
<span class="token comment" spellcheck="true"># forward做转发</span>
<span class="token comment" spellcheck="true"># file使用的是主配置文件directory定义的路径</span>
zone <span class="token string">"ZONE_NAME"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> <span class="token punctuation">{</span>master<span class="token operator">|</span>slave<span class="token operator">|</span>hint<span class="token operator">|</span>forward<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"ZONE_NAME.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>修改配置</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在/etc/named.rfc1912.zones文件内定义域名</span>
<span class="token comment" spellcheck="true"># named-checkconf用来检查语法错误</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"wsescape.com"</span> IN <span class="token punctuation">{</span>
        <span class="token function">type</span> master<span class="token punctuation">;</span>
        <span class="token function">file</span> <span class="token string">"wsescape.com.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkconf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>(2) 定义区域解析库文件</strong></p>
<ul>
<li><strong>格式</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">出现的内容：
宏定义；
资源记录；<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>修改配置</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 这里$TTL用于定义TTL的值，86400为秒，可以使用1D来代替</span>
<span class="token comment" spellcheck="true"># $ORIGIN用于指定域名词尾，如ns以及mx都为缺省了</span>
<span class="token comment" spellcheck="true"># named-checkzone</span>
<span class="token comment" spellcheck="true"># 两个www，在访问的时候会进行轮询操作的</span>
<span class="token comment" spellcheck="true"># 泛域名解析这里的*，表示无论用户输入什么都不报错</span>
<span class="token comment" spellcheck="true"># 或者写成*  IN  A  172.16.100.11，因为CNAME不能输入ip地址</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/named/</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim wsescape.com.zone</span>
<span class="token variable">$TTL</span> 86400
<span class="token variable">$ORIGIN</span> wsescape.com.
@    IN    SOA    ns1.wsescape.com.    admin.wsescape.com <span class="token punctuation">(</span>
2016042201
1H
5M
7D
1D <span class="token punctuation">)</span>
 IN    NS        ns1
 IN    NS        ns2
 IN    MX 10     mx1
 IN    MX 20     mx2
ns1  IN    A172.16.100.11
ns2 IN    A172.16.100.12
mx1 IN    A172.16.100.13
mx2 IN    A172.16.100.14
www IN    A172.16.100.11
www IN    A172.16.100.12
<span class="token function">ftp</span> INCNAMEwww
*    IN CNAME   www

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkzone "wsescape.com" /var/named/wsescape.com.zone</span>
zone wsescape.com/IN: loaded serial 2016042201
OK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>更改权限</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 可以查出进程是以named运行的</span>
<span class="token comment" spellcheck="true"># 其中/etc/named.conf文件的属主为root，属组为named</span>
<span class="token comment" spellcheck="true"># 为了安全起见，对自己创建的文件进行权限修改</span>

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ps -aux | grep named</span>
named     40086  0.0  1.1 160072 11736 ?        Ssl  22:07   0:00 /usr/sbin/named -u named
root      40785  0.0  0.0 103324   864 pts/0    S+   23:19   0:00 <span class="token function">grep</span> named

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll /etc/named.conf</span>
-rw-r-----. 1 root named 1004 6月  20 22:23 /etc/named.conf

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># id named</span>
uid<span class="token operator">=</span>25<span class="token punctuation">(</span>named<span class="token punctuation">)</span> gid<span class="token operator">=</span>25<span class="token punctuation">(</span>named<span class="token punctuation">)</span> 组<span class="token operator">=</span>25<span class="token punctuation">(</span>named<span class="token punctuation">)</span>

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll</span>
总用量 32
drwxrwx---. 2 named named 4096 6月  20 21:45 data
drwxrwx---. 2 named named 4096 6月  20 21:45 dynamic
-rw-r-----. 1 root  named 3171 1月  11 22:12 named.ca
-rw-r-----. 1 root  named  152 12月 15 2009 named.empty
-rw-r-----. 1 root  named  152 6月  21 2007 named.localhost
-rw-r-----. 1 root  named  168 12月 15 2009 named.loopback
drwxrwx---. 2 named named 4096 5月  11 07:07 slaves
-rw-r--r--. 1 root  root   408 6月  20 22:53 wsescape.com.zone

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod 640 wsescape.com.zone</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chown :named wsescape.com.zone</span>

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ll</span>
总用量 32
drwxrwx---. 2 named named 4096 6月  20 21:45 data
drwxrwx---. 2 named named 4096 6月  20 21:45 dynamic
-rw-r-----. 1 root  named 3171 1月  11 22:12 named.ca
-rw-r-----. 1 root  named  152 12月 15 2009 named.empty
-rw-r-----. 1 root  named  152 6月  21 2007 named.localhost
-rw-r-----. 1 root  named  168 12月 15 2009 named.loopback
drwxrwx---. 2 named named 4096 5月  11 07:07 slaves
-rw-r-----. 1 root  named  408 6月  20 22:53 wsescape.com.zone<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>重启生效</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named restart</span>
Stopping named: <span class="token keyword">.</span>                                          <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>
Starting named:                                            <span class="token punctuation">[</span>  OK  <span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># 使用dig命令来帮助我们验证信息</span>
<span class="token comment" spellcheck="true"># 因为之前的配置，这里会进行轮询操作</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A wsescape.com @172.16.242.178</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="3-5-反向区域"><a href="#3-5-反向区域" class="headerlink" title="3.5 反向区域"></a>3.5 反向区域</h3><blockquote>
<p><strong>反向解析和正向解析各为独立的系统，所以可以部署在不同的或者是相同的机器之上，都是可以</strong></p>
<ul>
<li>一个区域只能有一个主服务器，无论是正向还是反向</li>
<li>一个主服务器可以有多个从服务器</li>
</ul>
<p>根据配置文件中定义的主机地址，来确定网络地址</p>
<ul>
<li>如果都为<code>172.16.100</code>内的主机，那么网络地址就是<code>172.16.100.</code></li>
<li>存在多种地址，如<code>172.16.100.12</code>、<code>172.16.200.121</code>等，那么网络地址就是<code>172.16.</code></li>
<li>以此类推</li>
</ul>
</blockquote>
<p><strong>什么是反向区域</strong></p>
<ul>
<li>不变的部分用来当做区域名称，变化的部分用来当做实现解析时候的<code>name</code></li>
</ul>
<p><strong>格式</strong></p>
<ul>
<li><strong>区域名称</strong>：<code>网络地址反写.in-addr.arpa.</code></li>
<li>如<code>172.16.100\. ==&gt; 100.16.172.in-addr.arpa.</code></li>
</ul>
<p><strong>如何定义反向区域</strong></p>
<ul>
<li><strong>(1) 定义区域</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># file同样是一个相对路径，/var/named/</span>
<span class="token comment" spellcheck="true"># 如果有多个正向域对应同一个网络的话，多个区域就重名了，所以这里的网络地址其实自己可以随意定义，如"网络地址1.zone"、"网络地址2.zone"等</span>
<span class="token comment" spellcheck="true"># 如果只有一个反向区域的话，就只需要书写一个反向解析库，就可以"网络地址.zone"这样命名了</span>
zone <span class="token string">"ZONE_NAME"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> <span class="token punctuation">{</span>master<span class="token operator">|</span>slave<span class="token operator">|</span>forward<span class="token punctuation">}</span>；
<span class="token function">file</span> <span class="token string">"网络地址.zone"</span>；
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 因为172.16.242.178和我们的其他服务器(172.16.100.12/172.16.100.11),所以只能写成"16.172.in-addr.arpa"和"172.16.zone"</span>
<span class="token comment" spellcheck="true"># 最后添加如下内容</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"16.172.in-addr.arpa"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master；
<span class="token function">file</span> <span class="token string">"172.16.zone"</span>；
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>(2) 区域解析库文件</strong><ul>
<li>以<code>PTR</code>记录为主</li>
<li>不需要<code>MX</code>和<code>A</code>以及<code>AAAA</code>记录</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># $TTL表示宏定义的TTL值</span>
<span class="token comment" spellcheck="true"># $ORIGIN这里表示反向区域的名称</span>
<span class="token comment" spellcheck="true"># 反向的主机名称不能省略</span>
<span class="token comment" spellcheck="true"># 这里的11和12会自动补充上16.172.in-addr.arpa.</span>
<span class="token comment" spellcheck="true"># 别名记录不用反解，所以ftp没有书写反向解析</span>
<span class="token comment" spellcheck="true"># 这里可以使用vim -o wsescape.com.zone 16.172.zone来同时编辑两个文件的</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/named/</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim 100.16.zone</span>
<span class="token variable">$TTL</span> 86400
<span class="token variable">$ORIGIN</span> 16.172.in-addr.arpa.
@IN  SOAns1.wsescape.com. admin.wsescape.com. <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
IN  NSns1.wsescape.com.
IN    NSns2.wsescape.com.
11.100IN  PTRns1.wsescape.com.
11.100IN  PTRwww.wsescape.com.
12.100IN  PTRmx1.wsescape.com.
12.100IN  PTRwww.wsescape.com.
13.100IN  PTRmx2.wsescape.com.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 反向解析如果没有$ORIGIN的情况下，也可以这样写</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim 100.16.zone</span>
<span class="token variable">$TTL</span> 86400
@IN  SOAns1.wsescape.com. admin.wsescape.com. <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
16.172.in-addr.arpa.IN  NSns1.wsescape.com.
IN    NSns2.wsescape.com.
11.100IN  PTRns1.wsescape.com.
11.100IN  PTRwww.wsescape.com.
12.100IN  PTRmx1.wsescape.com.
12.100IN  PTRwww.wsescape.com.
13.100IN  PTRmx2.wsescape.com.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>(3) 修改权限并重启</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod 640 16.172.zone</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod :named 16.172.zone</span>

<span class="token comment" spellcheck="true"># 语法</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkconf</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkzone "16.172.inaddr-addr" 16.172.zone</span>
ok
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named reload</span>

<span class="token comment" spellcheck="true"># 检测</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># host -t PRT 172.16.100.12 172.16.242.178</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -x 172.16.100.12 @172.16.242.178</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="3-6-从-DNS-名称服务器配置"><a href="#3-6-从-DNS-名称服务器配置" class="headerlink" title="3.6 从 DNS 名称服务器配置"></a>3.6 从 DNS 名称服务器配置</h3><blockquote>
<p><strong>定义从 DNS 服务器就是在缓存服务器的基础上，进行修改配置</strong></p>
<ul>
<li>在<code>/etc/named.rfc1912.zones</code>添加<code>zone</code>记录</li>
</ul>
</blockquote>
<p><strong>主从复制</strong></p>
<ul>
<li>（1）应该为一台独立的名称服务器</li>
<li>（2）主服务器的区域解析库文件中必须有一条 NS 记录是指向从服务器</li>
<li>（3）从服务器只需要定义区域，而无须提供解析库文件；解析库文件应该放置于<code>/var/named/slaves/</code>目录中</li>
<li>（4）主服务器得允许从服务器作区域传送</li>
<li>（5）主从服务器时间应该同步，可通过<code>ntp</code>进行</li>
<li>（6）<code>bind</code>程序的版本应该保持一致；否则，应该<strong>从高主低</strong></li>
</ul>
<p><strong>定义从区域的方法</strong></p>
<ul>
<li><strong>正向从服务器格式</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 从服务器同步主服务器的解析文件会放在/var/named/slaves/中</span>
zone <span class="token string">"ZONE_NAME"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> slave<span class="token punctuation">;</span>
masters <span class="token punctuation">{</span> MASTER_IP<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"slaves/ZONE_NAME.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>反向从服务器格式</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 从服务器同步主服务器的解析文件会放在/var/named/slaves/中</span>
zone <span class="token string">"Reverse_Net_Addr.in-addr.arpa"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"SOMEFILE.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>（1）正向从服务器的实例</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 注意这里的从DNS服务器，需要在主DNS服务器中定义上NS记录</span>
<span class="token comment" spellcheck="true"># 这样才能在主DNS的解析库发生改变的时候通知从DNS服务器进行同步，否则不会同步的</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"wsescape.com"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> slave<span class="token punctuation">;</span>
masters <span class="token punctuation">{</span> 172.16.242.178<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"slaves/wsescape.com.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># 重起服务即可成效</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span>

<span class="token comment" spellcheck="true"># 可以通过log进行查看</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tail /var/log/messages</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>（2）反向从服务器的实例</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 注意这里的从DNS服务器，需要在主DNS服务器中定义上NS记录</span>
<span class="token comment" spellcheck="true"># 这样才能在主DNS的解析库发生改变的时候通知从DNS服务器进行同步，否则不会同步的</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"16.172.in-addr.arpa"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> slave<span class="token punctuation">;</span>
masters <span class="token punctuation">{</span> 172.16.242.178<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"slaves/172.16.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># 重起服务即可成效</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span>

<span class="token comment" spellcheck="true"># 可以通过log进行查看</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tail /var/log/messages</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="4-高级功能之子域授权"><a href="#4-高级功能之子域授权" class="headerlink" title="4. 高级功能之子域授权"></a>4. 高级功能之子域授权</h2><h3 id="4-1-子域授权的特点"><a href="#4-1-子域授权的特点" class="headerlink" title="4.1 子域授权的特点"></a>4.1 子域授权的特点</h3><blockquote>
<p><strong>子域授权</strong>其实就是在你有域名的情况下，进行细分的状况。比如说，你注册了<code>wsescap.com</code>这个域名，由于业务关系等，你需要分开为<code>ops</code>部门和<code>fin</code>部门，分别使用自己的<code>DNS</code>服务器，这个时候你就需要进行子域授权了。</p>
</blockquote>
<p><strong>特点</strong></p>
<ul>
<li>分布式数据库</li>
<li>正向解析区域的子域授权比较常见，而反向的相对来说比较难做</li>
</ul>
<hr>
<h3 id="4-2-子域授权的方法"><a href="#4-2-子域授权的方法" class="headerlink" title="4.2 子域授权的方法"></a>4.2 子域授权的方法</h3><p><strong>正向解析区域子域方法</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 定义一个子区域</span>
<span class="token comment" spellcheck="true"># 在/var/named/下的指定文件中进行配置，如这里的/var/named/wsescape.com.zone</span>
<span class="token comment" spellcheck="true"># 在我们授权了wsescape.com的前提下，定义两个子域，分别为ops和fin两个</span>

ops.wsescape.com.INNSns1.ops.wsescape.com.
ops.wsescape.com.INNSns2.ops.wsescape.com.
ns1.ops.wsescape.com.INA1.1.1.1
ns2.ops.wsescape.com.INA1.1.1.2

fin.wsescape.com.INNSns1.fin.wsescape.com.
fin.wsescape.com.INNSns2.fin.wsescape.com.
ns1.fin.wsescape.com.INA3.1.1.1
ns2.fin.wsescape.com.INA3.1.1.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="4-3-解析方式"><a href="#4-3-解析方式" class="headerlink" title="4.3 解析方式"></a>4.3 解析方式</h3><blockquote>
<p><strong>前提：</strong>如果<code>在wsescape.com</code>下，定义了一个子域为<code>ops</code>，并在<code>ops</code>下创建了一个<code>www</code>的服务。</p>
</blockquote>
<p><strong>外部解析</strong></p>
<p>（1）当<code>www.test.org</code>中的一台主机需要访问<code>ops</code>下的<code>www</code>主机时，就需要进过以下几个阶段：</p>
<ul>
<li>先找根(<code>.</code>)，根说你去找<code>com</code></li>
<li>再找<code>com</code>，<code>com</code>说你去找<code>wsescape</code></li>
<li>再找<code>wsescape</code>，<code>wsescape</code>说你去找<code>ops</code></li>
<li>最后<code>ops</code>返回需要的信息</li>
</ul>
<p><strong>内部解析</strong></p>
<p>（1）当<code>wsescape.com</code>下的一台主机需要访问<code>ops</code>下的<code>www</code>主机时，虽然<code>wsescape.com</code>的<code>DNS</code>主机不给于解析，但是它知道子域的位置，所以会立即指向<code>ops</code>的<code>DNS</code>服务器。<br>（2）当<code>ops</code>下的一台主机需要访问<code>wsescape.com</code>下的<code>www</code>主机时，就需要进过以下几个阶段：</p>
<ul>
<li>先找<code>ops</code>，<code>ops</code>说你找根</li>
<li>再找根(<code>.</code>)，根说你去找<code>com</code></li>
<li>再找<code>com</code>，<code>com</code>说你去找<code>wsescape</code></li>
<li>最后<code>wsescape</code>返回需要的信息</li>
</ul>
<p>我们会发现这个饶了一大圈，为了避免这样的问题，就需要定义转发服务器。</p>
<hr>
<h3 id="4-4-定义转发服务器"><a href="#4-4-定义转发服务器" class="headerlink" title="4.4 定义转发服务器"></a>4.4 定义转发服务器</h3><p><strong>注意</strong></p>
<ul>
<li>（1）关闭<code>dnssec</code>功能<ul>
<li><code>dnssec-enable no</code></li>
<li><code>dnssec-validation no</code></li>
</ul>
</li>
<li>（2）被转发的服务器需要能够为请求者做<code>递归</code>，否则转发请求不予进行</li>
<li>（3）即定义了全局转发有定义了区域转发，<code>优先级</code>为能够精确匹配到的先通过区域转发，不能再通过全局转发</li>
</ul>
<p><strong>转发模式</strong></p>
<ul>
<li><strong>(1) 全局转发</strong><ul>
<li>凡是对非本机所有负责解析的区域的请求，统统转发给指定的服务器</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># forward定义转发模式</span>
<span class="token comment" spellcheck="true"># first表示先转发给指定解析服务器，如无响应的话再找根服务器，即先递归在迭代</span>
<span class="token comment" spellcheck="true"># only表示金转发给指定解析服务器，仅仅递归</span>
<span class="token comment" spellcheck="true"># fowwarders定义转发给谁</span>

Options <span class="token punctuation">{</span>
forward <span class="token punctuation">{</span> first<span class="token operator">|</span>only <span class="token punctuation">}</span><span class="token punctuation">;</span>
forwarders<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>(2) 区域转发</strong><ul>
<li>仅转发对特定的区域的请求至某服务器</li>
<li>需要自己定义区域和区域类型等信息</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># forward定义转发模式</span>
<span class="token comment" spellcheck="true"># first表示先转发给指定解析服务器，如无响应的话再找根服务器，即先递归在迭代</span>
<span class="token comment" spellcheck="true"># only表示金转发给指定解析服务器，仅仅递归</span>
<span class="token comment" spellcheck="true"># fowwarders定义转发给谁</span>

zone <span class="token string">"ZONE_NAME"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> forward<span class="token punctuation">;</span>
forward <span class="token punctuation">{</span> first<span class="token operator">|</span>only <span class="token punctuation">}</span><span class="token punctuation">;</span>
forwarders<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="4-5-子域父域配置"><a href="#4-5-子域父域配置" class="headerlink" title="4.5 子域父域配置"></a>4.5 子域父域配置</h3><p><strong>前提：</strong></p>
<ul>
<li>父域<code>IP</code>地址 ==&gt; <code>172.16.100.11</code></li>
<li>子域<code>IP</code>地址 ==&gt; <code>172.16.100.12</code></li>
<li>能访问互联网的<code>IP</code>地址 ==&gt; <code>172.16.0.1</code></li>
</ul>
<p><strong>（1）父域服务器配置</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 一台独立的主机，这里配置父域就是在主服务器配置的基础上，添加子域而已</span>
<span class="token comment" spellcheck="true"># 注释的话，默认监听所有</span>
<span class="token comment" spellcheck="true"># 如果发现测试无法成功，查看/etc/named.conf中的dnssec改为no而非注释掉，否则导致本地客户端不接受</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum installl -y bind</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span>
options <span class="token punctuation">{</span>
//      listen-on port 53 <span class="token punctuation">{</span> 172.16.242.178<span class="token punctuation">;</span> 127.0.0.1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
//      listen-on-v6 port 53 <span class="token punctuation">{</span> ::1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        directory       <span class="token string">"/var/named"</span><span class="token punctuation">;</span>
        dump-file       <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>
        statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>
        memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>
//      allow-query     <span class="token punctuation">{</span> localhost<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        recursion <span class="token function">yes</span><span class="token punctuation">;</span>
        dnssec-enable no<span class="token punctuation">;</span>
        dnssec-validation no<span class="token punctuation">;</span>
        /* Path to ISC DLV key */
//      bindkeys-file <span class="token string">"/etc/named.iscdlv.key"</span><span class="token punctuation">;</span>
//      managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named start</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ss -tunl | grep :53</span>
udp    UNCONN     0      0              127.0.0.1:53                    *:*
udp    UNCONN     0      0                    ::1:53                   :::*
tcp    LISTEN     0      3                    ::1:53                   :::*
tcp    LISTEN     0      3              127.0.0.1:53                    *:*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"wsescape.com"</span> IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"wsescape.com.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ops、ns2.ops和ns1.ops都会自动补全wsescape.com.</span>
<span class="token comment" spellcheck="true"># 这里没有定义ns2.ops的A记录，是因为ns2.ops我们没有配置主机</span>
<span class="token comment" spellcheck="true"># 如果父域需要查找子域的时候，可能会跑到我们这个没有配置的机器上，导致服务解析，所以这就是没有定义的原因</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /var/named/wsescape.com.zone</span>
<span class="token variable">$TTL</span> 1D
<span class="token variable">$ORIGIN</span> wsescape.com.
@    IN    SOA    ns1.wsescape.com.    admin.wsescape.com <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
   IN    NS   ns1
   IN    NS   ns2
ns1    IN    A    172.16.100.11
ns2    IN    A    172.16.100.18
www    IN A    172.16.100.11
*      IN    A    172.16.100.11
ops    IN    NS   ns1.ops
ops    IN    NS   ns2.ops
ns1.ops    IN    A    172.16.100.12<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/named/</span>

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chown :named wsescape.com.zone</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod 640 wsescape.com.zone</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span>
server reload successful

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tail /var/log/messages</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>（2）子域服务器配置</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 配置子域服务器，即一台独立的主机，和父域配置没什么大的差别</span>
<span class="token comment" spellcheck="true"># 注释的话，默认监听所有</span>
<span class="token comment" spellcheck="true"># 如果发现测试无法成功，查看/etc/named.conf中的dnssec改为no而非注释掉，否则导致本地客户端不接受</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum installl -y bind</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span>
options <span class="token punctuation">{</span>
//      listen-on port 53 <span class="token punctuation">{</span> 172.16.242.178<span class="token punctuation">;</span> 127.0.0.1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
//      listen-on-v6 port 53 <span class="token punctuation">{</span> ::1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        directory       <span class="token string">"/var/named"</span><span class="token punctuation">;</span>
        dump-file       <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>
        statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>
        memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>
//      allow-query     <span class="token punctuation">{</span> localhost<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        recursion <span class="token function">yes</span><span class="token punctuation">;</span>
        dnssec-enable no<span class="token punctuation">;</span>
        dnssec-validation no<span class="token punctuation">;</span>
        /* Path to ISC DLV key */
//      bindkeys-file <span class="token string">"/etc/named.iscdlv.key"</span><span class="token punctuation">;</span>
//      managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named start</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ss -tunl | grep :53</span>
udp    UNCONN     0      0              127.0.0.1:53                    *:*
udp    UNCONN     0      0                    ::1:53                   :::*
tcp    LISTEN     0      3                    ::1:53                   :::*
tcp    LISTEN     0      3              127.0.0.1:53                    *:*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"ops.wsescape.com"</span>  IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"ops.wsescape.com.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># ns1和ns2都会自动补全ops.wsescape.com.</span>
<span class="token comment" spellcheck="true"># 这里也省略了ns2的定义，因为没有这里机器，如果父域需要查找子域的时候</span>
<span class="token comment" spellcheck="true"># 可能会跑到我们这个没有配置的机器上，导致服务解析，所以这就是没有定义的原因</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /var/named/ops.wsescape.com.zone</span>
<span class="token variable">$TTL</span> 1D
<span class="token variable">$ORIGIN</span> ops.wsescape.com.
@    IN    SOA    ns1.ops.wsescape.com.    admin.ops.wsescape.com <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
   IN    NS   ns1
   IN    NS   ns2
ns1    IN    A    172.16.100.12
www    IN A    172.16.100.20
*      IN    A    172.16.100.20<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/named/</span>

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chown :named wsescape.com.zone</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod 640 wsescape.com.zone</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span>
server reload successful

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tail /var/log/messages</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>（3）测试配置</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 当这里，我们会发现如下问题</span>

<span class="token comment" spellcheck="true"># 在子域服务器中，执行命令后可以查看ops的信息</span>
<span class="token comment" spellcheck="true"># 172.16.100.12为子域服务器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.ops.wsescape.com @172.16.100.12</span>

<span class="token comment" spellcheck="true"># 在子域服务器中，执行命令后在无网络的情况下不能查看父域的信息，在有网的情况下会根据根返回的信息来定位父域信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.12</span>

<span class="token comment" spellcheck="true"># 在父域服务器中，执行命令后可以查看子域ops的信息</span>
<span class="token comment" spellcheck="true"># 这里dig命令默认执行一个递归操作，所以这里需要加上+norecurse非递归即可</span>
<span class="token comment" spellcheck="true"># 172.16.100.11为父域服务器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A ops.wsescape.com @172.16.100.11 +norecurse</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.ops.wsescape.com @172.16.100.11 +norecurse</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="4-6-定义转发域"><a href="#4-6-定义转发域" class="headerlink" title="4.6 定义转发域"></a>4.6 定义转发域</h3><p><strong>注意</strong></p>
<ul>
<li>如果发现测试无法成功，查看<code>/etc/named.conf</code>中的<code>dnssec</code>改为<code>no</code>而非注释掉，否则导致本地客户端不接受</li>
<li>如果测试应该为不能解析但是还是解析了，可能需要清空缓存<code>rndc flush</code></li>
</ul>
<p><strong>服务配置</strong></p>
<ul>
<li><strong>（1）全局转发</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在父域中配置</span>
<span class="token comment" spellcheck="true"># 全局转发，就是通通转发给172.16.0.1来查询</span>
<span class="token comment" spellcheck="true"># 在父域服务器上编辑/etc/named.conf，在options添加如下信息</span>
<span class="token comment" spellcheck="true"># 由于上述的机器没有连接互联网，所以可以通过172.16.0.1进行解析</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span>
Options <span class="token punctuation">{</span>
forward first<span class="token punctuation">;</span>
forwarders <span class="token punctuation">{</span> 172.16.0.1； <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span>
server reload successful

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tail /val/log/messages</span>

<span class="token comment" spellcheck="true"># 父域中测试可以</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.baidu.com @172.16.100.11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>（2）区域转发</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在子域中配置</span>
<span class="token comment" spellcheck="true"># 区域转发，就是将wsescape.com这个域内的查询转发给172.16.100.11来查询</span>
<span class="token comment" spellcheck="true"># 在子域服务器上编辑/etc/named.rfc1912.zones最后添加一个zone</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"wsescape.com"</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> forword<span class="token punctuation">;</span>
forward only<span class="token punctuation">;</span>
forwarders <span class="token punctuation">{</span> 172.16.100.11<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span>
server reload successful

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tail /val/log/messages</span>

<span class="token comment" spellcheck="true"># 子域中测试可以，成功</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>（3）测试配置</strong></li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 父域中测试，成功</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.ops.wsescape.com @172.16.100.11</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.baidu.com @172.16.100.11</span>

<span class="token comment" spellcheck="true"># 子域中测试，子域知道父域在哪里，成功</span>
<span class="token comment" spellcheck="true"># 在子域中还是无法解析，因为指定要了定义区域wsescape.com可以解析</span>
<span class="token comment" spellcheck="true"># 如果在子域中，即定义了全局转发有定义了区域转发，优先级为能够精确匹配到的先通过区域转发，不能再通过全局转发</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.12</span>
<span class="token comment" spellcheck="true"># 子域解析失败</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.baidu.com @172.16.100.12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="5-高级功能之view视图"><a href="#5-高级功能之view视图" class="headerlink" title="5. 高级功能之view视图"></a>5. 高级功能之<code>view</code>视图</h2><h3 id="5-1-BIND中基础的安全相关的配置"><a href="#5-1-BIND中基础的安全相关的配置" class="headerlink" title="5.1 BIND中基础的安全相关的配置"></a>5.1 <code>BIND</code>中基础的安全相关的配置</h3><p><strong>（1）<code>acl</code>机制</strong></p>
<ul>
<li>把一个或多个地址归并为一个集合，并通过一个统一的名称调用</li>
<li>只能<code>先定义后使用</code>，其一般定义在配置文件中<code>options</code>的前面</li>
</ul>
<p><strong>（2）<code>acl</code>格式</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># acl表示关键字，acl_name表示自定义名称</span>
<span class="token comment" spellcheck="true"># ip表示单个的IP地址，net表示网络，意思就是单个IP和网络都可以定义</span>
acl acl_name <span class="token punctuation">{</span>
ip<span class="token punctuation">;</span>
ip<span class="token punctuation">;</span>
net/prelen<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>（3）四个内置的<code>acl</code></strong></p>
<p>因为这四个是内置的<code>acl</code>，所以在我们自己定义的时候不能使用这几个名称，否则会导致误用发生。</p>
<ul>
<li><code>none</code> ==&gt; 没有一个主机</li>
<li><code>any</code> ==&gt; 任意主机</li>
<li><code>local</code> ==&gt; 本机</li>
<li><code>localnet</code> ==&gt; 本机的<code>IP</code>同掩码运算后得到的网络地址</li>
</ul>
<p><strong>（4）访问控制的指令</strong></p>
<p>以下的这几个指令，可以用在<code>/etc/named.conf</code>中表示全局生效，也可以用在<code>/etc/named.rfc1912.zones</code>中，定义在单独的<code>zone</code>中表示局部生效。同时，<code>{}</code>内可以包含定义的<code>acl</code>或者主机<code>IP</code>地址，包括内置的和我们自己定义的。</p>
<ul>
<li><code>allow-query {}</code> ==&gt; 允许查询的主机，即白名单</li>
<li><code>allow-transfer {}</code> ==&gt; 允许区域传送的主机，即白名单</li>
<li><code>allow-recursion {}</code> ==&gt; 允许递归的主机</li>
<li><code>allow-update {}</code> ==&gt; 允许更新区域数据库中的内容，建议设置为<code>none</code></li>
</ul>
<p><strong>（5）演示示例</strong></p>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 这里我们定义的acl，可以在主配置文件/etc/named.conf中的option中使用，可以在`/etc/named.rfc1912.zones`中使用</span>
<span class="token comment" spellcheck="true"># 定义自己的acl</span>
acl mynet <span class="token punctuation">{</span>
172.16.1.100<span class="token punctuation">;</span>
172.16.0.0/16<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在/etc/named.conf中的option中使用</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span>
acl mynet <span class="token punctuation">{</span>
172.16.1.100<span class="token punctuation">;</span>
172.16.0.0/16<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
options <span class="token punctuation">{</span>
//      listen-on port 53 <span class="token punctuation">{</span> 172.16.242.178<span class="token punctuation">;</span> 127.0.0.1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        directory       <span class="token string">"/var/named"</span><span class="token punctuation">;</span>
        dump-file       <span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span>
        statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span>
        memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span>
        allow-query     <span class="token punctuation">{</span> mynet<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        recursion <span class="token function">yes</span><span class="token punctuation">;</span>
        dnssec-enable no<span class="token punctuation">;</span>
        dnssec-validation no<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在`/etc/named.rfc1912.zones`中使用</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
zone <span class="token string">"wsescape.com"</span>  IN <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"wsescape.com.zone"</span><span class="token punctuation">;</span>
allow-query <span class="token punctuation">{</span> mynet<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="5-2-BIND-view"><a href="#5-2-BIND-view" class="headerlink" title="5.2 BIND view"></a>5.2 <code>BIND view</code></h3><blockquote>
<p><strong>用途</strong>：主要适用于对于用户的分类，提高网站访问效率。</p>
<ul>
<li>如按照内、外网指定不同访问方式来访问网站</li>
<li>如按照运营商类型制定不同用户访问指定的服务器来访问网站</li>
<li>其实  <code>BIND view</code>就是实现分布式缓存，类似于<code>CDN</code>的一直方式</li>
</ul>
<p><strong>解析过程</strong></p>
<ul>
<li>当一个用户请求接收之后，首先判断用户的来源，然后自上而下逐个与各个<code>view</code>自己的用户节系列表进行匹配，最终来确定<code>view</code>系统解析功能，返回指定的区域解析库文件</li>
<li>一般用<code>view1</code>匹配第一个网络， 用<code>view2</code>匹配第二个网络， 用<code>view3</code>匹配其余网络，保证不会有缺漏</li>
</ul>
</blockquote>
<p><strong>（1）视图</strong></p>
<ul>
<li>一个<code>bind</code>服务器可定义多个<code>view</code>，每个<code>view</code>中可定义一个或多个<code>zone</code>区域</li>
<li>每个<code>view</code>用一来匹配一组请求的客户端</li>
<li>多个<code>view</code>内可能需要对同一个区域进行解析，但使用不同的区域解析库文件</li>
</ul>
<p><strong>（2）格式</strong></p>
<ul>
<li><code>view</code>是自上而下，逐一匹配</li>
<li>大多数用在<code>option</code>中的指令，都可以用在<code>view</code>中</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash">view VIEW_NAME <span class="token punctuation">{</span>
match-clients <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>（3）注意</strong></p>
<ul>
<li>（1）一旦启用了<code>view</code>，所有的<code>zone</code>都只能定义在<code>view</code>中，一个都不允许例外</li>
<li>（2） 仅有必要在匹配到允许递归请求的客户所在<code>view</code>中定义<code>根</code>区域</li>
<li>（3）客户端请求到达时是自上而下检查每个<code>view</code>所服务的客户端列表</li>
</ul>
<p><strong>（4）实验演示</strong></p>
<p><img src="/images/linux-dns-server-7.png" alt="DNS域名解析服务配置"></p>
<ul>
<li>将来自<code>172.16</code>网络并访问<code>www.wsescape.com</code>的用户，使用<code>172.16.100.11</code>这个<code>DNS</code>服务器来指定<code>www</code>服务器的地址</li>
<li>将非来自<code>172.16</code>网络并访问<code>www.wsescape.com</code>的用户，使用公网<code>2.2.2.1</code>这个<code>DNS</code>服务器来指定<code>www</code>服务器的地址</li>
</ul>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在172.16.100.11的主机中</span>
<span class="token comment" spellcheck="true"># 定义acl并将/etc/named.conf中定义的根zone删除</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.conf</span>

<span class="token comment" spellcheck="true"># 删除如下根zone</span>
zone  <span class="token string">"."</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> hint<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># 添加acl</span>
acl mynet  <span class="token punctuation">{</span>
172.16.0.0/16<span class="token punctuation">;</span>
127.0.0.0/8<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在172.16.100.11的主机中</span>
<span class="token comment" spellcheck="true"># 将根移到/etc/named.rfc1912.zones中，并将所有的zone包含在view中</span>
<span class="token comment" spellcheck="true"># 并添加内部访问配置internal</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>

<span class="token comment" spellcheck="true"># 添加view，限制mynet用户可以访问并允许递归</span>
view  internal  <span class="token punctuation">{</span>
match-chlients <span class="token punctuation">{</span> mynet<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
allow-recursion <span class="token punctuation">{</span> mynet<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># 添加根</span>
zone  <span class="token string">"."</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> hint<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true"># 由于之前的设置，这里是有wsescape.com，并配置了wsescape.com.zone文件</span>
zone  <span class="token string">"wsescape.com"</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"wsescape.com.zone"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在172.16.100.11的主机中</span>
<span class="token comment" spellcheck="true"># 如果我们在/etc/named.conf中增加192.168.0.0/24网络，就可以在192.168.0.13中可以解析，这里没有添加进去</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named-checkconf</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named restart</span>

<span class="token comment" spellcheck="true"># 在172.16.100.11主机上，成功</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.11</span>

<span class="token comment" spellcheck="true"># 如果配置了，在192.168.0.13主机上，成功</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在172.16.100.11的主机中</span>
<span class="token comment" spellcheck="true"># 在/etc/named.rfc1912.zones中，添加外部访问配置</span>
<span class="token comment" spellcheck="true"># 这里对没有匹配到的主机，不进行递归，所以在external就没有添加根域</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named.rfc1912.zones</span>
view external <span class="token punctuation">{</span>
match-clents <span class="token punctuation">{</span> any<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
zone <span class="token string">"wsescape.com"</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"wsescape.com.external"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/named/</span>

<span class="token comment" spellcheck="true"># 归档复制</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp -a wsescape.com.zone wsescape.com.external</span>

<span class="token comment" spellcheck="true"># 这里的2.2.2.1表示的是wsescape.com网站的公网DNS服务器</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim wsescape.com.external</span>
<span class="token variable">$TTL</span> 1D
<span class="token variable">$ORIGIN</span> wsescape.com.
@    IN    SOA    ns1.wsescape.com.    admin.wsescape.com <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
   IN    NS   ns1
   IN    NS   ns2
ns1    IN    A    172.16.100.11
ns2    IN    A    172.16.100.18
www    IN A    2.2.2.1
*      IN    A    2.2.2.1
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># service named restart</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 在172.16.100.11主机上，成功来自172.16.100.11</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.11</span>

<span class="token comment" spellcheck="true"># 在192.168.0.13主机上，成功来自2.2.2.1</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="6-高级功能之编译安装BIND"><a href="#6-高级功能之编译安装BIND" class="headerlink" title="6. 高级功能之编译安装BIND"></a>6. 高级功能之编译安装<code>BIND</code></h2><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 最小化安装机器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># yum  groupinstall "Development Tools" "Server Platform Development"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 去官网isc.org下载安装包，bind-9.10.1-P1.tar.gz</span>
<span class="token comment" spellcheck="true"># bind9和bind10的区别很大，而且bind10还在测试阶段</span>
<span class="token comment" spellcheck="true"># 创建named用户和组</span>
<span class="token comment" spellcheck="true"># 安装在同一目录下/usr/local/bind9，系统文件放在/etc/named/</span>
<span class="token comment" spellcheck="true"># 禁用IPv6功能，禁用chroot功能，启动线程多核工作</span>

<span class="token comment" spellcheck="true"># 自己手动编译安装bind可能会出现的问题</span>
<span class="token comment" spellcheck="true"># （1）在/etc/named/没有配置文件或者为空，需要自己创建</span>
<span class="token comment" spellcheck="true"># （2）没有任何区域解析库文件，即/var/named，所以也没有13个根节点，需要自己创建</span>
<span class="token comment" spellcheck="true"># （3）没有rndc的配置文件，需要自己创建</span>
<span class="token comment" spellcheck="true"># （4）没有启动脚本，没有/etc/init.d/named文件</span>
<span class="token comment" spellcheck="true"># 这里由于自定义安装到了/usr/local/bind9中，所以像dig、host等工具不能直接调用，需要完整路径</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># tar xf bind-9.10.1-P1.tar.gz</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd bind-9.10.1-P1</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># groupadd -r -g 53 named</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># useradd -r -u 53 -g 53 named</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ./configure --prefix=/usr/local/bind9 --sysconfdir=/etc/named/ --disable-ipv6 --disable-chroot --enable-threads</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># make</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># make install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 添加环境变量，就可以调用相关命令</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/profile.d/named.sh</span>
<span class="token function">export</span> PATH<span class="token operator">=</span>/usr/local/bind9/bin:/usr/local/bind9/sbin:<span class="token variable">$PATH</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># . /etc/profile.d/named.sh</span>

<span class="token comment" spellcheck="true"># 导出库文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/ld.so.conf.d/named.conf</span>
/usr/loacl/bind9/lib

<span class="token comment" spellcheck="true"># 重新载入库文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ldconfig -v</span>

<span class="token comment" spellcheck="true"># 如果有头文件，导出头文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ln -sv /usr/local/bind9/include /usr/include/named</span>

<span class="token comment" spellcheck="true"># 之后就可以使用/usr/include/named来访问/usr/local/bind9/中的头文件了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ls /usr/include/named</span>

<span class="token comment" spellcheck="true"># 在/usr/local/bind9/下有share的帮助文件，添加MANPATH将其放入man中</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/man.conf</span>
MANPATH /usr/local/bind9/share/man<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 添加主配置文件，这里只添加directory就可以了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named/named.conf</span>
option  <span class="token punctuation">{</span>
directory <span class="token string">"/var/named"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone  <span class="token string">"."</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> hint<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone  <span class="token string">"localhost"</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"localhost.zone"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

zone  <span class="token string">"0.0.127.in-addr.arpa"</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"named.local"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># mkdir /var/named/{named.ca, localhost.zone, named.local}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 使用dig命令来生成13个根节点，172.16.0.1为网关地址，可以帮助我们连接外网的地址，获取13个根节点</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t NS . @172.16.0.1 > /var/named/named.ca</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /var/named/localhost.zone</span>
<span class="token variable">$TTL</span> 1D
@    IN    SOA    localhost.    admin.localhost. <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
   IN    NS   localhost.
localhost.    IN    A    172.0.0.1

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /var/named/named.local</span>
<span class="token variable">$TTL</span> 1D
@    IN    SOA    localhost.    admin.localhost. <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
   IN    NS   localhost.
1    IN    PRT    localhost.

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cd /var/named/</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod 640 ./*</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chown :named *</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod 640 /etc/named/named.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 查看帮助文档</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># man named</span>

<span class="token comment" spellcheck="true"># 启动named服务，调试</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named -u named -f -g -d 3</span>

<span class="token comment" spellcheck="true"># 启动named服务，不调试</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named -u named</span>

<span class="token comment" spellcheck="true"># 查看是否启动</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ss -tunl named | grep :53</span>

<span class="token comment" spellcheck="true"># 关闭named服务</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># killall named</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 添加解析区域</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /etc/named/named.conf</span>
zone  <span class="token string">"wsescape.com"</span>  IN  <span class="token punctuation">{</span>
<span class="token function">type</span> master<span class="token punctuation">;</span>
<span class="token function">file</span> <span class="token string">"wsescape.com.zone"</span><span class="token punctuation">;</span>
allow-update <span class="token punctuation">{</span> none<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim /var/named/wsescape.com.zone</span>
<span class="token variable">$TTL</span> 1D
<span class="token variable">$ORIGIN</span> wsescape.com.
@    IN    SOA    ns.wsescape.com.    admin.wsescape.com. <span class="token punctuation">(</span>
  2016042201
  1H
  5M
  7D
  1D <span class="token punctuation">)</span>
   IN    NS   ns
ns     IN    A    172.16.100.11
www    IN    A    172.16.100.11

<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chmod 640 wsescape.com.zone</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># chown :named wsescape.com.zone</span>

<span class="token comment" spellcheck="true"># 启动</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># named -u named</span>

<span class="token comment" spellcheck="true"># 解析正常</span>
<span class="token punctuation">[</span>root@localhost named<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># dig -t A www.wsescape.com @172.16.100.11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 当我们使用rndc reload等的时候，会提示我们没有配置文件</span>
<span class="token comment" spellcheck="true"># 想让rndc可用，使用rndc-confgen来生成配置文件</span>
<span class="token comment" spellcheck="true"># 如果使用rndc-confgen发生堵塞，可以使用rndc-confgen -r /dev/urandom来生成随机数</span>
<span class="token comment" spellcheck="true"># 用rndc-confgen生成的文件，将#Start和#End之间的配置文件放到/etc/named/rndc.conf中，之后根据提示将后续的内容放到/etc/named/named.conf中</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc-confgen</span>
<span class="token comment" spellcheck="true"># Start of rndc.conf</span>
key <span class="token string">"rndc-key"</span> <span class="token punctuation">{</span>
algorithm hmac-md5<span class="token punctuation">;</span>
secret <span class="token string">"ZeE7NXZTprjARrGN/KRANQ=="</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

options <span class="token punctuation">{</span>
default-key <span class="token string">"rndc-key"</span><span class="token punctuation">;</span>
default-server 127.0.0.1<span class="token punctuation">;</span>
default-port 953<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true"># End of rndc.conf</span>

<span class="token comment" spellcheck="true"># Use with the following in named.conf, adjusting the allow list as needed:</span>
<span class="token comment" spellcheck="true"># key "rndc-key" {</span>
<span class="token comment" spellcheck="true">#algorithm hmac-md5;</span>
<span class="token comment" spellcheck="true">#secret "ZeE7NXZTprjARrGN/KRANQ==";</span>
<span class="token comment" spellcheck="true"># };</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># controls {</span>
<span class="token comment" spellcheck="true">#inet 127.0.0.1 port 953</span>
<span class="token comment" spellcheck="true">#allow { 127.0.0.1; } keys { "rndc-key"; };</span>
<span class="token comment" spellcheck="true"># };</span>
<span class="token comment" spellcheck="true"># End of named.conf</span>

<span class="token comment" spellcheck="true"># 现在rndc reload可以使用了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># rndc reload</span>
<span class="token comment" spellcheck="true"># 之后就只需要给提供一个脚本来像service一样，启动和关闭服务，不难的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 编译安装，在bind-9.10.1-P1源码目录下，有一个contrib目录</span>
<span class="token comment" spellcheck="true"># 其中包含的是第三方贡献的补充增强bind的功能</span>
<span class="token comment" spellcheck="true"># 其中有一个目录为scripts包含一些脚本，我们可以参考</span>

<span class="token comment" spellcheck="true"># 还有一个目录为queryperf来评估查询性能的，做压测的，需要编译安装才能使用</span>
<span class="token comment" spellcheck="true"># 编译安装queryperf，只需要在其目录下执行./configure和make即可完成</span>
<span class="token comment" spellcheck="true"># 就会生成一个queryperf的可执行文件，执行下列操作就可以直接使用了</span>
<span class="token punctuation">[</span>root@localhost queryperf<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># cp queryperf /usr/local/bind9/bin/</span>

<span class="token comment" spellcheck="true"># 在测试的时候，需要指定一个测试的文件，如test</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># vim test</span>
www.wsescape.com A
wsescape.com NS

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># queryperf -d test -s 172.16.100.11</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Escape</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://escapelife.github.io/posts/531caad6.html">https://escapelife.github.io/posts/531caad6.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Escape</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Linux/">
                                    <span class="chip bg-color">Linux</span>
                                </a>
                            
                                <a href="/tags/DNS/">
                                    <span class="chip bg-color">DNS</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/f26f0748.html">
                    <div class="card-image">
                        
                        <img src="/images/python-debug.png" class="responsive-img" alt="Python调试方法简介">
                        
                        <span class="card-title">Python调试方法简介</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2018-06-25
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python入门基础/" class="post-category">
                                    Python入门基础
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/a5250f19.html">
                    <div class="card-image">
                        
                        <img src="/images/python-exception.png" class="responsive-img" alt="Python错误和异常">
                        
                        <span class="card-title">Python错误和异常</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2018-06-23
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Python入门基础/" class="post-category">
                                    Python入门基础
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python/">
                        <span class="chip bg-color">Python</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('4'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="764454432"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='none'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2017-2020</span>
            
            <span id="year">2017</span>
            <a href="/about" target="_blank">Escape</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">1000.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2017";
                    var startMonth = "2";
                    var startDate = "14";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/EscapeLife" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:wenpanhappy@126.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
